<!doctype html>
<html data-n-head-ssr lang="en" data-n-head="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head >
    <title>ImageEngine custom loaders for Next.js</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width, initial-scale=1"><meta data-n-head="ssr" data-hid="description" name="description" content=""><meta data-n-head="ssr" name="format-detection" content="telephone=no"><meta data-n-head="ssr" data-hid="charset" charset="utf-8"><meta data-n-head="ssr" data-hid="mobile-web-app-capable" name="mobile-web-app-capable" content="yes"><meta data-n-head="ssr" data-hid="og:type" name="og:type" property="og:type" content="website"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" rel="preconnect" href="https://fonts.gstatic.com"><link data-n-head="ssr" rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&amp;display=swap"><link data-n-head="ssr" data-hid="shortcut-icon" rel="shortcut icon" href="/_nuxt/icons/icon_64x64.e3e9fb.png"><link data-n-head="ssr" data-hid="apple-touch-icon" rel="apple-touch-icon" href="/_nuxt/icons/icon_512x512.e3e9fb.png" sizes="512x512"><link data-n-head="ssr" rel="manifest" href="/_nuxt/manifest.f9c56d04.json" data-hid="manifest"><link rel="preload" href="/_nuxt/548109a.js" as="script"><link rel="preload" href="/_nuxt/84567ea.js" as="script"><link rel="preload" href="/_nuxt/ad2e88f.js" as="script"><link rel="preload" href="/_nuxt/a9b0fbe.js" as="script"><link rel="preload" href="/_nuxt/c3ddcce.js" as="script"><style data-vue-ssr-id="54b08540:0 a57b151a:0 1239d49d:0 bc0f4dfc:0 59be0982:0 4d321698:0 3c003464:0 6cfba90a:0">/*! tailwindcss v2.2.16 | MIT License | https://tailwindcss.com*/

/*! modern-normalize v1.1.0 | MIT License | https://github.com/sindresorhus/modern-normalize */

/*
Document
========
*/

/**
Use a better box model (opinionated).
*/

*,
::before,
::after {
  box-sizing: border-box;
}

/**
Use a more readable tab size (opinionated).
*/

html {
  -moz-tab-size: 4;
  -o-tab-size: 4;
     tab-size: 4;
}

/**
1. Correct the line height in all browsers.
2. Prevent adjustments of font size after orientation changes in iOS.
*/

html {
  line-height: 1.15; /* 1 */
  -webkit-text-size-adjust: 100%; /* 2 */
}

/*
Sections
========
*/

/**
Remove the margin in all browsers.
*/

body {
  margin: 0;
}

/**
Improve consistency of default fonts in all browsers. (https://github.com/sindresorhus/modern-normalize/issues/3)
*/

body {
  font-family:
		system-ui,
		-apple-system, /* Firefox supports this but not yet `system-ui` */
		'Segoe UI',
		Roboto,
		Helvetica,
		Arial,
		sans-serif,
		'Apple Color Emoji',
		'Segoe UI Emoji';
}

/*
Grouping content
================
*/

/**
1. Add the correct height in Firefox.
2. Correct the inheritance of border color in Firefox. (https://bugzilla.mozilla.org/show_bug.cgi?id=190655)
*/

hr {
  height: 0; /* 1 */
  color: inherit; /* 2 */
}

/*
Text-level semantics
====================
*/

/**
Add the correct text decoration in Chrome, Edge, and Safari.
*/

abbr[title] {
  -webkit-text-decoration: underline dotted;
          text-decoration: underline dotted;
}

/**
Add the correct font weight in Edge and Safari.
*/

b,
strong {
  font-weight: bolder;
}

/**
1. Improve consistency of default fonts in all browsers. (https://github.com/sindresorhus/modern-normalize/issues/3)
2. Correct the odd 'em' font sizing in all browsers.
*/

code,
kbd,
samp,
pre {
  font-family:
		ui-monospace,
		SFMono-Regular,
		Consolas,
		'Liberation Mono',
		Menlo,
		monospace; /* 1 */
  font-size: 1em; /* 2 */
}

/**
Add the correct font size in all browsers.
*/

small {
  font-size: 80%;
}

/**
Prevent 'sub' and 'sup' elements from affecting the line height in all browsers.
*/

sub,
sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}

sub {
  bottom: -0.25em;
}

sup {
  top: -0.5em;
}

/*
Tabular data
============
*/

/**
1. Remove text indentation from table contents in Chrome and Safari. (https://bugs.chromium.org/p/chromium/issues/detail?id=999088, https://bugs.webkit.org/show_bug.cgi?id=201297)
2. Correct table border color inheritance in all Chrome and Safari. (https://bugs.chromium.org/p/chromium/issues/detail?id=935729, https://bugs.webkit.org/show_bug.cgi?id=195016)
*/

table {
  text-indent: 0; /* 1 */
  border-color: inherit; /* 2 */
}

/*
Forms
=====
*/

/**
1. Change the font styles in all browsers.
2. Remove the margin in Firefox and Safari.
*/

button,
input,
optgroup,
select,
textarea {
  font-family: inherit; /* 1 */
  font-size: 100%; /* 1 */
  line-height: 1.15; /* 1 */
  margin: 0; /* 2 */
}

/**
Remove the inheritance of text transform in Edge and Firefox.
1. Remove the inheritance of text transform in Firefox.
*/

button,
select { /* 1 */
  text-transform: none;
}

/**
Correct the inability to style clickable types in iOS and Safari.
*/

button,
[type='button'],
[type='submit'] {
  -webkit-appearance: button;
}

/**
Remove the inner border and padding in Firefox.
*/

/**
Restore the focus styles unset by the previous rule.
*/

/**
Remove the additional ':invalid' styles in Firefox.
See: https://github.com/mozilla/gecko-dev/blob/2f9eacd9d3d995c937b4251a5557d95d494c9be1/layout/style/res/forms.css#L728-L737
*/

/**
Remove the padding so developers are not caught out when they zero out 'fieldset' elements in all browsers.
*/

legend {
  padding: 0;
}

/**
Add the correct vertical alignment in Chrome and Firefox.
*/

progress {
  vertical-align: baseline;
}

/**
Correct the cursor style of increment and decrement buttons in Safari.
*/

/**
1. Correct the odd appearance in Chrome and Safari.
2. Correct the outline style in Safari.
*/

[type='search'] {
  -webkit-appearance: textfield; /* 1 */
  outline-offset: -2px; /* 2 */
}

/**
Remove the inner padding in Chrome and Safari on macOS.
*/

/**
1. Correct the inability to style clickable types in iOS and Safari.
2. Change font properties to 'inherit' in Safari.
*/

/*
Interactive
===========
*/

/*
Add the correct display in Chrome and Safari.
*/

summary {
  display: list-item;
}

/**
 * Manually forked from SUIT CSS Base: https://github.com/suitcss/base
 * A thin layer on top of normalize.css that provides a starting point more
 * suitable for web applications.
 */

/**
 * Removes the default spacing and border for appropriate elements.
 */

blockquote,
dl,
dd,
h1,
h2,
h3,
h4,
h5,
h6,
hr,
figure,
p,
pre {
  margin: 0;
}

button {
  background-color: transparent;
  background-image: none;
}

fieldset {
  margin: 0;
  padding: 0;
}

ol,
ul {
  list-style: none;
  margin: 0;
  padding: 0;
}

/**
 * Tailwind custom reset styles
 */

/**
 * 1. Use the user's configured `sans` font-family (with Tailwind's default
 *    sans-serif font stack as a fallback) as a sane default.
 * 2. Use Tailwind's default "normal" line-height so the user isn't forced
 *    to override it to ensure consistency even when using the default theme.
 */

html {
  font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"; /* 1 */
  line-height: 1.5; /* 2 */
}

/**
 * Inherit font-family and line-height from `html` so users can set them as
 * a class directly on the `html` element.
 */

body {
  font-family: inherit;
  line-height: inherit;
}

/**
 * 1. Prevent padding and border from affecting element width.
 *
 *    We used to set this in the html element and inherit from
 *    the parent element for everything else. This caused issues
 *    in shadow-dom-enhanced elements like <details> where the content
 *    is wrapped by a div with box-sizing set to `content-box`.
 *
 *    https://github.com/mozdevs/cssremedy/issues/4
 *
 *
 * 2. Allow adding a border to an element by just adding a border-width.
 *
 *    By default, the way the browser specifies that an element should have no
 *    border is by setting it's border-style to `none` in the user-agent
 *    stylesheet.
 *
 *    In order to easily add borders to elements by just setting the `border-width`
 *    property, we change the default border-style for all elements to `solid`, and
 *    use border-width to hide them instead. This way our `border` utilities only
 *    need to set the `border-width` property instead of the entire `border`
 *    shorthand, making our border utilities much more straightforward to compose.
 *
 *    https://github.com/tailwindcss/tailwindcss/pull/116
 */

*,
::before,
::after {
  box-sizing: border-box; /* 1 */
  border-width: 0; /* 2 */
  border-style: solid; /* 2 */
  border-color: currentColor; /* 2 */
}

/*
 * Ensure horizontal rules are visible by default
 */

hr {
  border-top-width: 1px;
}

/**
 * Undo the `border-style: none` reset that Normalize applies to images so that
 * our `border-{width}` utilities have the expected effect.
 *
 * The Normalize reset is unnecessary for us since we default the border-width
 * to 0 on all elements.
 *
 * https://github.com/tailwindcss/tailwindcss/issues/362
 */

img {
  border-style: solid;
}

textarea {
  resize: vertical;
}

input::-moz-placeholder, textarea::-moz-placeholder {
  opacity: 1;
  color: #9ca3af;
}

input:-ms-input-placeholder, textarea:-ms-input-placeholder {
  opacity: 1;
  color: #9ca3af;
}

input::placeholder,
textarea::placeholder {
  opacity: 1;
  color: #9ca3af;
}

button {
  cursor: pointer;
}

/**
 * Override legacy focus reset from Normalize with modern Firefox focus styles.
 *
 * This is actually an improvement over the new defaults in Firefox in our testing,
 * as it triggers the better focus styles even for links, which still use a dotted
 * outline in Firefox by default.
 */

table {
  border-collapse: collapse;
}

h1,
h2,
h3,
h4,
h5,
h6 {
  font-size: inherit;
  font-weight: inherit;
}

/**
 * Reset links to optimize for opt-in styling instead of
 * opt-out.
 */

a {
  color: inherit;
  text-decoration: inherit;
}

/**
 * Reset form element properties that are easy to forget to
 * style explicitly so you don't inadvertently introduce
 * styles that deviate from your design system. These styles
 * supplement a partial reset that is already applied by
 * normalize.css.
 */

button,
input,
optgroup,
select,
textarea {
  padding: 0;
  line-height: inherit;
  color: inherit;
}

/**
 * Use the configured 'mono' font family for elements that
 * are expected to be rendered with a monospace font, falling
 * back to the system monospace stack if there is no configured
 * 'mono' font family.
 */

pre,
code,
kbd,
samp {
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
}

/**
 * 1. Make replaced elements `display: block` by default as that's
 *    the behavior you want almost all of the time. Inspired by
 *    CSS Remedy, with `svg` added as well.
 *
 *    https://github.com/mozdevs/cssremedy/issues/14
 * 
 * 2. Add `vertical-align: middle` to align replaced elements more
 *    sensibly by default when overriding `display` by adding a
 *    utility like `inline`.
 *
 *    This can trigger a poorly considered linting error in some
 *    tools but is included by design.
 * 
 *    https://github.com/jensimmons/cssremedy/issues/14#issuecomment-634934210
 */

img,
svg,
video,
canvas,
audio,
iframe,
embed,
object {
  display: block; /* 1 */
  vertical-align: middle; /* 2 */
}

/**
 * Constrain images and videos to the parent width and preserve
 * their intrinsic aspect ratio.
 *
 * https://github.com/mozdevs/cssremedy/issues/14
 */

img,
video {
  max-width: 100%;
  height: auto;
}

/**
 * Ensure the default browser behavior of the `hidden` attribute.
 */

[hidden] {
  display: none;
}

*, ::before, ::after{
  --tw-border-opacity:1;
  border-color:rgba(229, 231, 235, var(--tw-border-opacity));
}

.container{
  width:100%;
}

@media (min-width: 640px){
  .container{
    max-width:640px;
  }
}

@media (min-width: 768px){
  .container{
    max-width:768px;
  }
}

@media (min-width: 1024px){
  .container{
    max-width:1024px;
  }
}

@media (min-width: 1280px){
  .container{
    max-width:1280px;
  }
}

@media (min-width: 1536px){
  .container{
    max-width:1536px;
  }
}

.static{
  position:static;
}

.absolute{
  position:absolute;
}

.relative{
  position:relative;
}

.top-1\/2{
  top:50%;
}

.left-1\/2{
  left:50%;
}

.m-4{
  margin:1rem;
}

.mx-auto{
  margin-left:auto;
  margin-right:auto;
}

.my-2{
  margin-top:0.5rem;
  margin-bottom:0.5rem;
}

.my-4{
  margin-top:1rem;
  margin-bottom:1rem;
}

.mt-4{
  margin-top:1rem;
}

.mt-6{
  margin-top:1.5rem;
}

.mr-1{
  margin-right:0.25rem;
}

.mr-2{
  margin-right:0.5rem;
}

.mr-1\.5{
  margin-right:0.375rem;
}

.-mr-2{
  margin-right:-0.5rem;
}

.mb-3{
  margin-bottom:0.75rem;
}

.mb-4{
  margin-bottom:1rem;
}

.mb-6{
  margin-bottom:1.5rem;
}

.ml-2{
  margin-left:0.5rem;
}

.ml-4{
  margin-left:1rem;
}

.ml-10{
  margin-left:2.5rem;
}

.-ml-0{
  margin-left:0px;
}

.-ml-0\.5{
  margin-left:-0.125rem;
}

.block{
  display:block;
}

.flex{
  display:flex;
}

.inline-flex{
  display:inline-flex;
}

.table{
  display:table;
}

.hidden{
  display:none;
}

.h-2{
  height:0.5rem;
}

.h-4{
  height:1rem;
}

.h-6{
  height:1.5rem;
}

.h-8{
  height:2rem;
}

.h-12{
  height:3rem;
}

.h-16{
  height:4rem;
}

.w-2{
  width:0.5rem;
}

.w-6{
  width:1.5rem;
}

.w-8{
  width:2rem;
}

.w-12{
  width:3rem;
}

.w-64{
  width:16rem;
}

.w-1\/2{
  width:50%;
}

.w-3\/4{
  width:75%;
}

.w-full{
  width:100%;
}

.max-w-xs{
  max-width:20rem;
}

.max-w-sm{
  max-width:24rem;
}

.max-w-7xl{
  max-width:80rem;
}

.max-w-screen-md{
  max-width:768px;
}

.max-w-screen-xl{
  max-width:1280px;
}

.flex-1{
  flex:1 1 0%;
}

.flex-shrink-0{
  flex-shrink:0;
}

.transform{
  --tw-translate-x:0;
  --tw-translate-y:0;
  --tw-rotate:0;
  --tw-skew-x:0;
  --tw-skew-y:0;
  --tw-scale-x:1;
  --tw-scale-y:1;
  transform:translateX(var(--tw-translate-x)) translateY(var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));
}

.-translate-x-1\/2{
  --tw-translate-x:-50%;
}

.-translate-y-1\/2{
  --tw-translate-y:-50%;
}

@-webkit-keyframes spin{
  to{
    transform:rotate(360deg);
  }
}

@keyframes spin{
  to{
    transform:rotate(360deg);
  }
}

@-webkit-keyframes ping{
  75%, 100%{
    transform:scale(2);
    opacity:0;
  }
}

@keyframes ping{
  75%, 100%{
    transform:scale(2);
    opacity:0;
  }
}

@-webkit-keyframes pulse{
  50%{
    opacity:.5;
  }
}

@keyframes pulse{
  50%{
    opacity:.5;
  }
}

@-webkit-keyframes bounce{
  0%, 100%{
    transform:translateY(-25%);
    -webkit-animation-timing-function:cubic-bezier(0.8,0,1,1);
            animation-timing-function:cubic-bezier(0.8,0,1,1);
  }

  50%{
    transform:none;
    -webkit-animation-timing-function:cubic-bezier(0,0,0.2,1);
            animation-timing-function:cubic-bezier(0,0,0.2,1);
  }
}

@keyframes bounce{
  0%, 100%{
    transform:translateY(-25%);
    -webkit-animation-timing-function:cubic-bezier(0.8,0,1,1);
            animation-timing-function:cubic-bezier(0.8,0,1,1);
  }

  50%{
    transform:none;
    -webkit-animation-timing-function:cubic-bezier(0,0,0.2,1);
            animation-timing-function:cubic-bezier(0,0,0.2,1);
  }
}

.appearance-none{
  -webkit-appearance:none;
     -moz-appearance:none;
          appearance:none;
}

.flex-col{
  flex-direction:column;
}

.flex-wrap{
  flex-wrap:wrap;
}

.items-center{
  align-items:center;
}

.items-baseline{
  align-items:baseline;
}

.justify-start{
  justify-content:flex-start;
}

.justify-center{
  justify-content:center;
}

.justify-between{
  justify-content:space-between;
}

.space-x-4 > :not([hidden]) ~ :not([hidden]){
  --tw-space-x-reverse:0;
  margin-right:calc(1rem * var(--tw-space-x-reverse));
  margin-left:calc(1rem * calc(1 - var(--tw-space-x-reverse)));
}

.space-y-1 > :not([hidden]) ~ :not([hidden]){
  --tw-space-y-reverse:0;
  margin-top:calc(0.25rem * calc(1 - var(--tw-space-y-reverse)));
  margin-bottom:calc(0.25rem * var(--tw-space-y-reverse));
}

.space-y-3 > :not([hidden]) ~ :not([hidden]){
  --tw-space-y-reverse:0;
  margin-top:calc(0.75rem * calc(1 - var(--tw-space-y-reverse)));
  margin-bottom:calc(0.75rem * var(--tw-space-y-reverse));
}

.rounded{
  border-radius:0.25rem;
}

.rounded-md{
  border-radius:0.375rem;
}

.rounded-lg{
  border-radius:0.5rem;
}

.rounded-xl{
  border-radius:0.75rem;
}

.rounded-2xl{
  border-radius:1rem;
}

.rounded-full{
  border-radius:9999px;
}

.rounded-l-full{
  border-top-left-radius:9999px;
  border-bottom-left-radius:9999px;
}

.border{
  border-width:1px;
}

.border-transparent{
  border-color:transparent;
}

.border-gray-300{
  --tw-border-opacity:1;
  border-color:rgba(209, 213, 219, var(--tw-border-opacity));
}

.hover\:border-white:hover{
  --tw-border-opacity:1;
  border-color:rgba(255, 255, 255, var(--tw-border-opacity));
}

.focus\:border-transparent:focus{
  border-color:transparent;
}

.bg-black{
  --tw-bg-opacity:1;
  background-color:rgba(0, 0, 0, var(--tw-bg-opacity));
}

.bg-white{
  --tw-bg-opacity:1;
  background-color:rgba(255, 255, 255, var(--tw-bg-opacity));
}

.bg-gray-100{
  --tw-bg-opacity:1;
  background-color:rgba(243, 244, 246, var(--tw-bg-opacity));
}

.bg-purple-200{
  --tw-bg-opacity:1;
  background-color:rgba(221, 214, 254, var(--tw-bg-opacity));
}

.hover\:bg-white:hover{
  --tw-bg-opacity:1;
  background-color:rgba(255, 255, 255, var(--tw-bg-opacity));
}

.hover\:bg-gray-500:hover{
  --tw-bg-opacity:1;
  background-color:rgba(107, 114, 128, var(--tw-bg-opacity));
}

.hover\:bg-gray-600:hover{
  --tw-bg-opacity:1;
  background-color:rgba(75, 85, 99, var(--tw-bg-opacity));
}

.hover\:bg-gray-800:hover{
  --tw-bg-opacity:1;
  background-color:rgba(31, 41, 55, var(--tw-bg-opacity));
}

.p-2{
  padding:0.5rem;
}

.p-4{
  padding:1rem;
}

.p-8{
  padding:2rem;
}

.px-2{
  padding-left:0.5rem;
  padding-right:0.5rem;
}

.px-3{
  padding-left:0.75rem;
  padding-right:0.75rem;
}

.px-4{
  padding-left:1rem;
  padding-right:1rem;
}

.px-6{
  padding-left:1.5rem;
  padding-right:1.5rem;
}

.px-8{
  padding-left:2rem;
  padding-right:2rem;
}

.px-2\.5{
  padding-left:0.625rem;
  padding-right:0.625rem;
}

.py-0{
  padding-top:0px;
  padding-bottom:0px;
}

.py-2{
  padding-top:0.5rem;
  padding-bottom:0.5rem;
}

.py-3{
  padding-top:0.75rem;
  padding-bottom:0.75rem;
}

.py-4{
  padding-top:1rem;
  padding-bottom:1rem;
}

.py-8{
  padding-top:2rem;
  padding-bottom:2rem;
}

.py-0\.5{
  padding-top:0.125rem;
  padding-bottom:0.125rem;
}

.pt-2{
  padding-top:0.5rem;
}

.pt-8{
  padding-top:2rem;
}

.pt-10{
  padding-top:2.5rem;
}

.pb-2{
  padding-bottom:0.5rem;
}

.pb-3{
  padding-bottom:0.75rem;
}

.pb-8{
  padding-bottom:2rem;
}

.text-left{
  text-align:left;
}

.text-center{
  text-align:center;
}

.text-right{
  text-align:right;
}

.text-xs{
  font-size:0.75rem;
  line-height:1rem;
}

.text-sm{
  font-size:0.875rem;
  line-height:1.25rem;
}

.text-base{
  font-size:1rem;
  line-height:1.5rem;
}

.text-lg{
  font-size:1.125rem;
  line-height:1.75rem;
}

.text-xl{
  font-size:1.25rem;
  line-height:1.75rem;
}

.text-2xl{
  font-size:1.5rem;
  line-height:2rem;
}

.text-3xl{
  font-size:1.875rem;
  line-height:2.25rem;
}

.text-4xl{
  font-size:2.25rem;
  line-height:2.5rem;
}

.text-5xl{
  font-size:3rem;
  line-height:1;
}

.font-thin{
  font-weight:100;
}

.font-light{
  font-weight:300;
}

.font-medium{
  font-weight:500;
}

.font-semibold{
  font-weight:600;
}

.font-bold{
  font-weight:700;
}

.capitalize{
  text-transform:capitalize;
}

.leading-tight{
  line-height:1.25;
}

.text-black{
  --tw-text-opacity:1;
  color:rgba(0, 0, 0, var(--tw-text-opacity));
}

.text-white{
  --tw-text-opacity:1;
  color:rgba(255, 255, 255, var(--tw-text-opacity));
}

.text-gray-300{
  --tw-text-opacity:1;
  color:rgba(209, 213, 219, var(--tw-text-opacity));
}

.text-gray-400{
  --tw-text-opacity:1;
  color:rgba(156, 163, 175, var(--tw-text-opacity));
}

.text-gray-500{
  --tw-text-opacity:1;
  color:rgba(107, 114, 128, var(--tw-text-opacity));
}

.text-gray-700{
  --tw-text-opacity:1;
  color:rgba(55, 65, 81, var(--tw-text-opacity));
}

.text-gray-800{
  --tw-text-opacity:1;
  color:rgba(31, 41, 55, var(--tw-text-opacity));
}

.text-green-500{
  --tw-text-opacity:1;
  color:rgba(16, 185, 129, var(--tw-text-opacity));
}

.text-purple-500{
  --tw-text-opacity:1;
  color:rgba(139, 92, 246, var(--tw-text-opacity));
}

.hover\:text-white:hover{
  --tw-text-opacity:1;
  color:rgba(255, 255, 255, var(--tw-text-opacity));
}

.hover\:text-gray-300:hover{
  --tw-text-opacity:1;
  color:rgba(209, 213, 219, var(--tw-text-opacity));
}

.hover\:text-gray-800:hover{
  --tw-text-opacity:1;
  color:rgba(31, 41, 55, var(--tw-text-opacity));
}

.placeholder-gray-400::-moz-placeholder{
  --tw-placeholder-opacity:1;
  color:rgba(156, 163, 175, var(--tw-placeholder-opacity));
}

.placeholder-gray-400:-ms-input-placeholder{
  --tw-placeholder-opacity:1;
  color:rgba(156, 163, 175, var(--tw-placeholder-opacity));
}

.placeholder-gray-400::placeholder{
  --tw-placeholder-opacity:1;
  color:rgba(156, 163, 175, var(--tw-placeholder-opacity));
}

.opacity-50{
  opacity:0.5;
}

*, ::before, ::after{
  --tw-shadow:0 0 #0000;
}

.shadow-sm{
  --tw-shadow:0 1px 2px 0 rgba(0, 0, 0, 0.05);
  box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow);
}

.shadow{
  --tw-shadow:0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
  box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow);
}

.shadow-md{
  --tw-shadow:0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow);
}

.shadow-lg{
  --tw-shadow:0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
  box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow);
}

.shadow-xl{
  --tw-shadow:0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
  box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow);
}

.focus\:outline-none:focus{
  outline:2px solid transparent;
  outline-offset:2px;
}

*, ::before, ::after{
  --tw-ring-inset:var(--tw-empty,/*!*/ /*!*/);
  --tw-ring-offset-width:0px;
  --tw-ring-offset-color:#fff;
  --tw-ring-color:rgba(59, 130, 246, 0.5);
  --tw-ring-offset-shadow:0 0 #0000;
  --tw-ring-shadow:0 0 #0000;
}

.focus\:ring-2:focus{
  --tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);
  --tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);
  box-shadow:var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000);
}

.focus\:ring-white:focus{
  --tw-ring-opacity:1;
  --tw-ring-color:rgba(255, 255, 255, var(--tw-ring-opacity));
}

.focus\:ring-gray-400:focus{
  --tw-ring-opacity:1;
  --tw-ring-color:rgba(156, 163, 175, var(--tw-ring-opacity));
}

.focus\:ring-offset-2:focus{
  --tw-ring-offset-width:2px;
}

.focus\:ring-offset-white:focus{
  --tw-ring-offset-color:#fff;
}

.filter{
  --tw-blur:var(--tw-empty,/*!*/ /*!*/);
  --tw-brightness:var(--tw-empty,/*!*/ /*!*/);
  --tw-contrast:var(--tw-empty,/*!*/ /*!*/);
  --tw-grayscale:var(--tw-empty,/*!*/ /*!*/);
  --tw-hue-rotate:var(--tw-empty,/*!*/ /*!*/);
  --tw-invert:var(--tw-empty,/*!*/ /*!*/);
  --tw-saturate:var(--tw-empty,/*!*/ /*!*/);
  --tw-sepia:var(--tw-empty,/*!*/ /*!*/);
  --tw-drop-shadow:var(--tw-empty,/*!*/ /*!*/);
  filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow);
}

.transition-colors{
  transition-property:background-color, border-color, color, fill, stroke;
  transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);
  transition-duration:150ms;
}

.duration-200{
  transition-duration:200ms;
}

@media (min-width: 640px){
  .sm\:px-3{
    padding-left:0.75rem;
    padding-right:0.75rem;
  }

  .sm\:pt-12{
    padding-top:3rem;
  }
}

@media (min-width: 768px){
  .md\:ml-6{
    margin-left:1.5rem;
  }

  .md\:block{
    display:block;
  }

  .md\:flex{
    display:flex;
  }

  .md\:hidden{
    display:none;
  }

  .md\:w-full{
    width:100%;
  }

  .md\:flex-row{
    flex-direction:row;
  }

  .md\:justify-between{
    justify-content:space-between;
  }

  .md\:space-x-3 > :not([hidden]) ~ :not([hidden]){
    --tw-space-x-reverse:0;
    margin-right:calc(0.75rem * var(--tw-space-x-reverse));
    margin-left:calc(0.75rem * calc(1 - var(--tw-space-x-reverse)));
  }

  .md\:space-y-0 > :not([hidden]) ~ :not([hidden]){
    --tw-space-y-reverse:0;
    margin-top:calc(0px * calc(1 - var(--tw-space-y-reverse)));
    margin-bottom:calc(0px * var(--tw-space-y-reverse));
  }

  .md\:p-16{
    padding:4rem;
  }

  .md\:text-center{
    text-align:center;
  }

  .md\:text-3xl{
    font-size:1.875rem;
    line-height:2.25rem;
  }
}

@media (min-width: 1024px){
}

@media (min-width: 1280px){
}

@media (min-width: 1536px){
}
/*purgecss start ignore*/
.nuxt-progress{
  position:fixed;
  top:0;
  left:0;
  right:0;
  height:2px;
  width:0;
  opacity:1;
  transition:width .1s,opacity .4s;
  background-color:#000;
  z-index:999999
}
.nuxt-progress.nuxt-progress-notransition{
  transition:none
}
.nuxt-progress-failed{
  background-color:red
}

/*purgecss end ignore*/
/*purgecss start ignore*/
:root{
  --gray:#666
}
html{
  font-family:"Oxygen"
}
body{
  background:#0f0f0f;
  font-family:"Space Mono";
  color:#fff
}

/*purgecss end ignore*/
/*purgecss start ignore*/

/*purgecss end ignore*/
/*purgecss start ignore*/
.page-wrapper[data-v-3bf13c85]{
  margin:auto;
  padding:1rem
}
.article-content-wrapper[data-v-3bf13c85]{
  display:flex;
  flex-direction:column;
  align-items:center;
  margin:auto auto 2rem
}
.article-content-wrapper .article-block[data-v-3bf13c85]{
  width:100%;
  max-width:880px
}
.article-content-wrapper .aside-username-wrapper[data-v-3bf13c85]{
  max-width:880px;
  width:100%;
  position:relative
}
.article-content-wrapper .aside-username-wrapper .aside-username-block[data-v-3bf13c85]{
  position:-webkit-sticky;
  position:sticky;
  top:1rem
}

/*purgecss end ignore*/
/*purgecss start ignore*/
article[data-v-25febe66]{
  padding:.5rem;
  border-radius:1rem
}
header[data-v-25febe66],header h1[data-v-25febe66]{
  margin-bottom:1rem
}
header .tags[data-v-25febe66]{
  display:flex;
  flex-wrap:wrap;
  margin-bottom:1.5rem
}
header .tags .tag[data-v-25febe66]{
  line-height:1;
  padding:.5rem;
  margin:0 .5rem .5rem 0;
  border-radius:.25rem
}
header .tags .tag[data-v-25febe66]:active{
  background:transparent
}
header .image-wrapper[data-v-25febe66]{
  position:relative;
  padding-bottom:56.25%;
  margin-bottom:1.5rem;
  border-radius:.5rem;
  overflow:hidden
}
header .image-wrapper img[data-v-25febe66]{
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
  -o-object-fit:cover;
     object-fit:cover
}
header .meta[data-v-25febe66]{
  line-height:1;
  text-transform:uppercase;
  display:flex;
  align-items:center;
  justify-content:space-between
}
header .meta .scl[data-v-25febe66]{
  display:flex
}
header .meta .scl span[data-v-25febe66]{
  display:flex;
  align-items:center;
  margin-right:1rem
}
header .meta .scl span svg[data-v-25febe66]{
  margin-right:.25rem
}
header .meta .scl .comments[data-v-25febe66]{
  cursor:pointer
}
[data-v-25febe66] .content .ltag__user{
  display:none
}
[data-v-25febe66] .content iframe{
  max-width:100%
}
[data-v-25febe66] .content h1,[data-v-25febe66] .content h2,[data-v-25febe66] .content h3,[data-v-25febe66] .content h4{
  margin-top:2rem;
  margin-bottom:1rem
}
[data-v-25febe66] .content p{
  margin-bottom:1rem;
  line-height:1.4
}
[data-v-25febe66] .content p code{
  background-color:#d2f3e1;
  border-radius:.25rem;
  padding:.25rem
}
[data-v-25febe66] .content img{
  width:100%;
  border-radius:.5rem
}
[data-v-25febe66] .content .highlight{
  margin-bottom:1rem;
  border-radius:.5rem
}
[data-v-25febe66] .content ul{
  list-style:numeral;
  margin-bottom:1rem
}
[data-v-25febe66] .content ul li p{
  margin-bottom:0
}
[data-v-25febe66] .content ol{
  margin-bottom:1rem
}

/*purgecss end ignore*/
/*purgecss start ignore*/
aside[data-v-29ea5fa2]{
  padding:1rem;
  border-radius:1rem
}
aside .username-heading[data-v-29ea5fa2]{
  display:flex;
  margin-bottom:1rem
}
aside .username-heading img[data-v-29ea5fa2]{
  width:3rem;
  height:3rem;
  border-radius:50%;
  margin-right:1rem
}
aside .username-heading .text[data-v-29ea5fa2]{
  display:flex;
  flex-direction:column;
  justify-content:center
}
aside .username-heading .text a[data-v-29ea5fa2]{
  line-height:1
}
aside .username-heading .text a[data-v-29ea5fa2]:first-child{
  margin-bottom:.25rem
}
aside .username-heading.loading[data-v-29ea5fa2]{
  display:block
}
aside .f-button[data-v-29ea5fa2]{
  display:block;
  width:100%;
  padding:.5rem;
  border-radius:.5rem;
  text-transform:uppercase;
  text-align:center;
  margin-bottom:1rem
}
aside .f-button[data-v-29ea5fa2]:active{
  background:transparent
}
aside .info>div[data-v-29ea5fa2]{
  margin-bottom:.5rem
}
aside .info .title[data-v-29ea5fa2]{
  text-transform:uppercase;
  margin-bottom:.1rem
}
aside .info .content[data-v-29ea5fa2]{
  line-height:1.4
}

/*purgecss end ignore*/
/*purgecss start ignore*/
.add-comment[data-v-54aa1ab4]{
  display:block;
  width:100%;
  padding:.5rem;
  border-radius:.5rem;
  text-transform:uppercase;
  text-align:center;
  margin-bottom:1rem
}
.add-comment[data-v-54aa1ab4]:active{
  background:transparent
}

/*purgecss end ignore*/</style><link rel="preload" href="/_nuxt/static/1634322943/articles/mnussbaumer/722885/state.js" as="script"><link rel="preload" href="/_nuxt/static/1634322943/articles/mnussbaumer/722885/payload.js" as="script"><link rel="preload" href="/_nuxt/static/1634322943/manifest.js" as="script">
  </head>
  <body >
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div><div><nav class="py-4"><div class="max-w-7xl mx-auto px-8"><div class="flex items-center justify-between h-16"><div class="flex items-center"><div class="flex items-center"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 50 62.5" enable-background="new 0 0 50 50" xml:space="preserve"><path fill="#FFFFFF" d="M25,1C11.745,1,1,11.745,1,25s10.745,24,24,24s24-10.745,24-24S38.255,1,25,1z M17.887,38.646  c0.097,0.099,0.097,0.257-0.001,0.354c-0.049,0.049-0.112,0.073-0.176,0.073s-0.128-0.024-0.177-0.073L3.767,25.177  c-0.028-0.028-0.031-0.067-0.042-0.103c-0.008-0.025-0.03-0.047-0.03-0.073s0.022-0.048,0.03-0.073  c0.012-0.036,0.014-0.075,0.042-0.103l13.766-13.823c0.098-0.099,0.256-0.098,0.354-0.001c0.098,0.098,0.098,0.256,0.001,0.354  L4.297,25.001L17.887,38.646z M46.232,25.178c0,0-0.001,0-0.002,0l-13.765,13.82c-0.049,0.049-0.112,0.073-0.177,0.073  c-0.063,0-0.128-0.024-0.177-0.073c-0.098-0.097-0.098-0.255,0-0.354l13.591-13.645L32.112,11.354c-0.098-0.098-0.098-0.256,0-0.354  c0.098-0.097,0.256-0.097,0.354,0.001L46.23,24.823c0.001,0,0.002,0,0.002,0c0.049,0.049,0.073,0.113,0.073,0.177  S46.281,25.129,46.232,25.178z"></path></svg> <h1 class="text-white text-2xl px-2 pb-2">CodeLabs.</h1></div> <div class="hidden md:block"><div class="ml-10 flex items-baseline space-x-4"><a href="/" class="
                  text-gray-300
                  hover:border-white
                  border border-transparent
                  px-3
                  py-2
                  rounded-md
                  text-sm
                  font-medium
                 nuxt-link-active bg-white text-gray-800">Home</a><a href="/articles/mnussbaumer/Articles" class="
                  text-gray-300
                  hover:border-white
                  border border-transparent
                  px-3
                  py-2
                  rounded-md
                  text-sm
                  font-medium
                ">Articles</a><a href="/articles/mnussbaumer/Lessons" class="
                  text-gray-300
                  hover:border-white
                  border border-transparent
                  px-3
                  py-2
                  rounded-md
                  text-sm
                  font-medium
                ">Lessons</a><a href="/articles/mnussbaumer/Courses" class="
                  text-gray-300
                  hover:border-white
                  border border-transparent
                  px-3
                  py-2
                  rounded-md
                  text-sm
                  font-medium
                ">Courses</a><a href="/articles/mnussbaumer/Pricing" class="
                  text-gray-300
                  hover:border-white
                  border border-transparent
                  px-3
                  py-2
                  rounded-md
                  text-sm
                  font-medium
                ">Pricing</a><a href="/articles/mnussbaumer/Sponsor" class="
                  text-gray-300
                  hover:border-white
                  border border-transparent
                  px-3
                  py-2
                  rounded-md
                  text-sm
                  font-medium
                ">Sponsor</a></div></div></div> <div class="block"><div class="ml-4 flex items-center md:ml-6"></div></div> <div class="-mr-2 flex md:hidden"><button class="
              text-white
              hover:bg-white hover:text-gray-300
              inline-flex
              items-center
              justify-center
              p-2
              rounded-md
              focus:outline-none
            "><svg width="20" height="20" fill="currentColor" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg" class="h-8 w-8"><path d="M1664 1344v128q0 26-19 45t-45 19h-1408q-26 0-45-19t-19-45v-128q0-26 19-45t45-19h1408q26 0 45 19t19 45zm0-512v128q0 26-19 45t-45 19h-1408q-26 0-45-19t-19-45v-128q0-26 19-45t45-19h1408q26 0 45 19t19 45zm0-512v128q0 26-19 45t-45 19h-1408q-26 0-45-19t-19-45v-128q0-26 19-45t45-19h1408q26 0 45 19t19 45z"></path></svg></button></div></div></div> <div class="md:hidden hidden"><div class="px-2 pt-2 pb-3 space-y-1 sm:px-3"><a href="/" class="
            text-gray-300
            border border-transparent
            hover:border-white
            block
            px-3
            py-2
            rounded-md
            text-base
            font-medium
           nuxt-link-active text-gray-800 bg-white">Home</a><a href="/articles/mnussbaumer/Articles" class="
            text-gray-300
            border border-transparent
            hover:border-white
            block
            px-3
            py-2
            rounded-md
            text-base
            font-medium
          ">Articles</a><a href="/articles/mnussbaumer/Lessons" class="
            text-gray-300
            border border-transparent
            hover:border-white
            block
            px-3
            py-2
            rounded-md
            text-base
            font-medium
          ">Lessons</a><a href="/articles/mnussbaumer/Courses" class="
            text-gray-300
            border border-transparent
            hover:border-white
            block
            px-3
            py-2
            rounded-md
            text-base
            font-medium
          ">Courses</a><a href="/articles/mnussbaumer/Pricing" class="
            text-gray-300
            border border-transparent
            hover:border-white
            block
            px-3
            py-2
            rounded-md
            text-base
            font-medium
          ">Pricing</a><a href="/articles/mnussbaumer/Sponsor" class="
            text-gray-300
            border border-transparent
            hover:border-white
            block
            px-3
            py-2
            rounded-md
            text-base
            font-medium
          ">Sponsor</a></div></div></nav></div> <div class="page-wrapper" data-v-3bf13c85><div class="article-content-wrapper" data-v-3bf13c85><article data-fetch-key="data-v-25febe66:0" class="article-block" data-v-25febe66 data-v-3bf13c85><header data-v-25febe66><h1 data-v-25febe66>ImageEngine custom loaders for Next.js</h1> <div class="tags" data-v-25febe66><a href="/articles/t/imageengine" class="tag" data-v-25febe66>
          #imageengine
        </a><a href="/articles/t/nextjs" class="tag" data-v-25febe66>
          #nextjs
        </a><a href="/articles/t/vercel" class="tag" data-v-25febe66>
          #vercel
        </a><a href="/articles/t/loader" class="tag" data-v-25febe66>
          #loader
        </a></div> <!----> <div class="meta" data-v-25febe66><div class="scl" data-v-25febe66><span data-v-25febe66><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-25febe66 data-v-25febe66><path d="M16.4444 3C14.6733 3 13.0333 3.94162 12 5.34C10.9667 3.94162 9.32667 3 7.55556 3C4.49222 3 2 5.52338 2 8.625C2 14.8024 11.0267 20.586 11.4122 20.829C11.5922 20.9426 11.7956 21 12 21C12.2044 21 12.4078 20.9426 12.5878 20.829C12.9733 20.586 22 14.8024 22 8.625C22 5.52338 19.5078 3 16.4444 3Z" fill="#FF0000" data-v-25febe66 data-v-25febe66></path></svg>
            7
          </span> <span class="comments" data-v-25febe66><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-25febe66 data-v-25febe66><path d="M6.11765 22H4.94118L5.64706 21.05C6.11765 20.3969 6.41176 19.5656 6.58824 18.5563C3.64706 17.1906 2 14.6375 2 11.3125C2 6.20625 5.82353 3 12 3C18.1765 3 22 6.20625 22 11.3125C22 16.5375 18.2353 19.625 12 19.625H11.5882C10.6471 20.7531 9 22 6.11765 22ZM12 4.1875C6.47059 4.1875 3.17647 6.85937 3.17647 11.3125C3.17647 15.1125 5.47059 16.8938 7.41177 17.6656L7.82353 17.8437L7.76471 18.3187C7.64706 19.2687 7.47059 20.1 7.11765 20.8125C9.05882 20.575 10.1765 19.5656 10.8235 18.7344L11 18.4969H12C19.9412 18.4969 20.8235 13.5094 20.8235 11.3719C20.8235 6.85938 17.5294 4.1875 12 4.1875Z" fill="black" data-v-25febe66 data-v-25febe66></path></svg>
            0
          </span></div> <time data-v-25febe66>Jun 29</time></div></header> <div class="content" data-v-25febe66><p>This article will guide you through writing custom Next.js loaders, specifically for <code>ImageEngine</code>’s distribution, but is applicable to any other situation where you need to customise the loaders. We’ll be building a grid layout image portfolio with the option to view the images in a full window lightbox. You can check the <a href="https://ie-custom-loader.vercel.app">app we’ll be building here</a> and the <a href="https://github.com/mnussbaumer/ie-nextjs-loader">github repo</a>.</p>

<h3>
  <a name="summary" href="#summary">
  </a>
  Summary:
</h3>

<ul>
<li>Intro</li>
<li>Creating a <code>Next.js</code> App</li>
<li>Defining our Layout and Content</li>
<li>Setting up <code>Custom Loaders</code> for use by our <code>Next.js Image</code> components</li>
<li>Deploying on vercel.com</li>
<li>Create a distribution with <code>ImageEngine</code> and set our vercel environment to use it</li>
<li>Conclusion</li>
</ul>

<h3>
  <a name="intro" href="#intro">
  </a>
  Intro
</h3>

<p><a href="https://imageengine.io">ImageEngine</a> has custom image components for <a href="https://www.npmjs.com/package/@imageengine/react">React</a> and <a href="https://www.npmjs.com/package/@imageengine/vue">Vue</a>, and in another post we went through <a href="https://dev.to/mnussbaumer/imageengine-with-nextjs-1dh7">how to use ImageEngine's custom image component</a> in a <code>Next.js</code>.</p>

<p><code>Next.js</code> <code>&lt;Image/&gt;</code> component is a pretty neat tool that is available in any <code>Next.js</code> project you might start. It allows one to set up a system of breakpoints, sizes and settings to apply to our image assets. It takes care of preventing <a href="https://web.dev/cls/">Cumulative Layout Shift</a> on page rendering when provided with the correct size information and optimize our assets according to buckets of resolution/viewport/image sizes. </p>

<p>It’s especially useful if you’re deploying on <a href="https://vercel.com">Vercel</a> as it will be automatically enabled and performant. It works by generating optimized assets in terms of dimensions, and then caching those resources for subsequent requests on their edge servers. This for many cases will be enough and offers a much better experience than unoptimized assets. </p>

<p>On the other hand, if you’re not running on <code>Vercel</code>’s hosting, the performance of initial optimization is not as fast and can take a bit of time. If you’re not doing <code>SSR</code> and instead are deploying a static website build, as of now, you won’t be able to use their <code>Image</code> component at all.</p>

<p>It also works better when the assets you’re serving all fall into horizontal/square ratios, as it uses <code>width</code> to determine the optimized images. So if you have a reasonable mix of vertical and horizontally oriented images then it will be much harder to serve the minimum needed sizes for those vertical images. </p>

<p>If you’re serving image content in very high quantities, even when using <code>Vercel.com</code> then you might be interested in something that allows you to optimize your images up to the single pixel count, doesn’t rely on your server performance nor caching solutions, and offers very fast CDN distributions to deliver the best possible loading and viewing experience to your customers and users.</p>

<p>In this post we’ll review how to setup such a project by designing two different components with two different loaders, one for square thumbnails and one for a full window lightbox. In the process we’ll see how to write a custom <code>Image</code> loader for <code>Next.js</code> and some tricks for layout responsiveness.</p>

<h3>
  <a name="creating-a-raw-nextjs-endraw-app" href="#creating-a-raw-nextjs-endraw-app">
  </a>
  Creating a <code>Next.js</code> App
</h3>

<p>To follow through you'll need to have nodejs and npm installed. The versions used for this tutorial are npm 7.15.1 and node v16.3.0. We’ll also install the <a href="https://vercel.com/cli">vercel CLI</a>.</p>

<p>On the folder where you'll be creating your project run:</p>

<p><code>npx create-next-app</code></p>

<p>Now let's install the <a href="https://www.npmjs.com/package/@imageengine/react">ImageEngine Package</a>:</p>

<p><code>npm i @imageengine/react</code></p>

<p>We should be able to start our app by doing</p>

<p><code>npm run dev</code></p>

<p>And visiting </p>

<p><code>http://localhost:3000</code></p>

<p>This should show us the default page. Let's remove the default templating <code>index.js</code> page has and replace it with:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="k">import</span> <span class="nx">Head</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">next/head</span><span class="dl">"</span><span class="p">;</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">Home</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>

      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">main-container</span><span class="dl">"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">Head</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">ImageEngine</span> <span class="nx">Optimized</span> <span class="nx">Lightbox</span><span class="o">&lt;</span><span class="sr">/title</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">description</span><span class="dl">"</span> <span class="nx">content</span><span class="o">=</span><span class="dl">"</span><span class="s2">Next.js custom image loaders leveraging ImageEngine CDN for highly optimized images</span><span class="dl">"</span> <span class="o">/&gt;</span>
            <span class="o">&lt;</span><span class="nx">link</span> <span class="nx">rel</span><span class="o">=</span><span class="dl">"</span><span class="s2">icon</span><span class="dl">"</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">/favicon.ico</span><span class="dl">"</span> <span class="o">/&gt;</span>
         <span class="o">&lt;</span><span class="sr">/Head</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>And change <code>/pages/_app.js</code> to the following<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="k">import</span> <span class="nx">Head</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">next/head</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="dl">"</span><span class="s2">../styles/globals.css</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">IECustomLoader</span><span class="p">({</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">pageProps</span> <span class="p">})</span> <span class="p">{</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="o">&lt;&gt;</span>
          <span class="o">&lt;</span><span class="nx">Head</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">link</span> <span class="nx">rel</span><span class="o">=</span><span class="dl">"</span><span class="s2">icon</span><span class="dl">"</span> <span class="nx">type</span><span class="o">=</span><span class="dl">"</span><span class="s2">image/png</span><span class="dl">"</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">/favicon.png</span><span class="dl">"</span><span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">viewport</span><span class="dl">"</span> <span class="nx">content</span><span class="o">=</span><span class="dl">"</span><span class="s2">initial-scale=1.0</span><span class="dl">"</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">description</span><span class="dl">"</span> <span class="nx">content</span><span class="o">=</span><span class="dl">"</span><span class="s2">Learn how to use ImageEngine with Nextjs custom loaders to serve highly optimised image assets from your CDN to your users.</span><span class="dl">"</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">property</span><span class="o">=</span><span class="dl">"</span><span class="s2">og:title</span><span class="dl">"</span> <span class="nx">content</span><span class="o">=</span><span class="dl">"</span><span class="s2">ImageEngine with NextJS</span><span class="dl">"</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">property</span><span class="o">=</span><span class="dl">"</span><span class="s2">og:description</span><span class="dl">"</span> <span class="nx">content</span><span class="o">=</span><span class="dl">"</span><span class="s2">Learn how to use ImageEngine with Nextjs custom loaders to serve highly optimised image assets from your CDN to your users.</span><span class="dl">"</span> <span class="o">/&gt;</span>
          <span class="o">&lt;</span><span class="sr">/Head</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="nx">Component</span> <span class="p">{...</span><span class="nx">pageProps</span><span class="p">}</span> <span class="sr">/</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/</span><span class="err">&gt;
</span>    <span class="p">);</span>
<span class="p">};</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">IECustomLoader</span><span class="p">;</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Create a <code>next.config.js</code> on the root of our project and inside it:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">env</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">DISTRIBUTION</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DISTRIBUTION</span>
    <span class="p">},</span>
    <span class="na">images</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">deviceSizes</span><span class="p">:</span> <span class="p">[</span><span class="mi">1920</span><span class="p">,</span> <span class="mi">1500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">300</span><span class="p">],</span>
    <span class="na">imageSizes</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Let's remove the things we don't need, delete <code>pages/api</code> folder, <code>styles/Home.module.css</code> and <code>public/vercel.svg</code>::</p>

<p><code>rm -rf pages/api</code><br>
<code>rm styles/Home.module.css</code><br>
<code>rm public/vercel.svg</code></p>

<p>Create a folder at the root level named <code>components</code>, and inside the <code>public</code> folder create a <code>ie-loader-images</code> folder.</p>

<p>We should now have the following structure:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight plaintext"><code>...
pages /
  _app.js
  index.js

styles /
  global.css

components / 

public /
  favicon.ico
  ie-loader-images
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>You’ll also need to download the files in <a href="https://dev.togithublink">public/ie-loader-images</a> and place them  in <code>/public/ie-loader-images/</code>.</p>

<p>For this web page we’ll need 2 components, a <code>thumbnail</code> component and a <code>lightbox</code> component. Both components will receive a <code>src</code> and <code>alt</code> props for the image, an <code>onClick</code> function and the sizes of the <code>viewport</code>. The <code>lightbox</code> component will additionally receive two functions for moving to the next and previous image.</p>

<p>The CSS is important but to save space it won’t be written here, you can copy it over from <a href="https://github.com/mnussbaumer/ie-nextjs-loader/blob/main/styles/globals.css">globals.css</a>.</p>

<p>As a side note, <code>Next.js</code> <code>Image</code> component fixes the size of the image to prevent <code>Cumulative Layout Shift</code>, but since we establish fixed size containers in CSS, that would have been addressed as well. The other interesting bit there is the small CSS trickery to get the <code>hover</code> effect to display the labels without JS. The remaining is basic styling.</p>

<h3>
  <a name="thumbnail-component" href="#thumbnail-component">
  </a>
  Thumbnail Component
</h3>

<p>Create a file <code>components/thumbnail.js</code> with:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="k">import</span> <span class="nx">Image</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">next/image</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">constructUrl</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@imageengine/react/build/utils/index.js</span><span class="dl">"</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">useState</span><span class="p">,</span> <span class="nx">useEffect</span><span class="p">,</span> <span class="nx">createRef</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">thumbnail_loader</span><span class="p">({</span> <span class="nx">src</span><span class="p">,</span> <span class="nx">quality</span><span class="p">,</span> <span class="nx">distribution</span><span class="p">,</span> <span class="nx">width</span> <span class="p">})</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">distribution</span> <span class="o">+</span> <span class="nx">src</span><span class="p">,</span>
    <span class="nx">directives</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">width</span><span class="p">:</span> <span class="nx">width</span><span class="p">,</span>
        <span class="na">height</span><span class="p">:</span> <span class="nx">width</span><span class="p">,</span>
        <span class="na">fitMethod</span><span class="p">:</span> <span class="dl">"</span><span class="s2">cropbox</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">compression</span><span class="p">:</span> <span class="mi">100</span> <span class="o">-</span> <span class="nx">quality</span><span class="p">,</span>
        <span class="na">sharpness</span><span class="p">:</span> <span class="mi">10</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="nx">constructUrl</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">directives</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">Thumbnail</span><span class="p">({</span> <span class="nx">onClick</span><span class="p">,</span> <span class="nx">src</span><span class="p">,</span> <span class="nx">alt</span><span class="p">,</span> <span class="nx">window_sizes</span> <span class="p">})</span> <span class="p">{</span>

    <span class="kd">let</span> <span class="nx">thumbnail_ref</span> <span class="o">=</span> <span class="nx">createRef</span><span class="p">(),</span>
    <span class="p">[</span><span class="nx">width</span><span class="p">,</span> <span class="nx">set_width</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">),</span>
    <span class="p">[</span><span class="nx">initial_size</span><span class="p">,</span> <span class="nx">set_initial_size</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

    <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">window_sizes</span><span class="p">)</span> <span class="p">{</span>

        <span class="kd">let</span> <span class="nx">dimensions</span> <span class="o">=</span> <span class="nx">thumbnail_ref</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">(),</span>
        <span class="nx">n_width</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">dimensions</span><span class="p">.</span><span class="nx">width</span><span class="p">);</span>


        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">initial_size</span><span class="p">)</span> <span class="p">{</span> <span class="nx">set_initial_size</span><span class="p">(</span><span class="nx">n_width</span><span class="p">);</span> <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">initial_size</span> <span class="o">&gt;=</span> <span class="nx">n_width</span><span class="p">)</span> <span class="p">{</span> <span class="nx">set_width</span><span class="p">(</span><span class="nx">initial_size</span><span class="p">);</span> <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>

        <span class="nx">set_initial_size</span><span class="p">(</span><span class="nx">n_width</span><span class="p">);</span>
        <span class="nx">set_width</span><span class="p">(</span><span class="nx">n_width</span><span class="p">);</span>

        <span class="p">}</span>
    <span class="p">}</span>
    <span class="p">},</span> <span class="p">[</span><span class="nx">window_sizes</span><span class="p">]);</span>

    <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">image-thumbnail</span><span class="dl">"</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClick</span><span class="p">}</span> <span class="nx">ref</span><span class="o">=</span><span class="p">{</span><span class="nx">thumbnail_ref</span><span class="p">}</span><span class="o">&gt;</span>
      <span class="p">{</span><span class="nx">width</span> <span class="p">?</span>
          <span class="o">&lt;</span><span class="nx">Image</span>
            <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="nx">src</span><span class="p">}</span>
            <span class="nx">alt</span><span class="o">=</span><span class="p">{</span><span class="nx">alt</span><span class="p">}</span>
            <span class="nx">sizes</span><span class="o">=</span><span class="p">{</span><span class="s2">`(max-width: 320px) 300px, (max-width: 500px) 500px, (max-width: 1000) 1000px, (max-width: 1500) 1500px, </span><span class="p">${</span><span class="nx">width</span><span class="p">}</span><span class="s2">px`</span><span class="p">}</span>
            <span class="nx">layout</span><span class="o">=</span><span class="dl">"</span><span class="s2">responsive</span><span class="dl">"</span>
            <span class="nx">objectFit</span><span class="o">=</span><span class="dl">"</span><span class="s2">cover</span><span class="dl">"</span>
            <span class="nx">objectPosition</span><span class="o">=</span><span class="dl">"</span><span class="s2">center</span><span class="dl">"</span>
            <span class="nx">width</span><span class="o">=</span><span class="p">{</span><span class="nx">width</span><span class="p">}</span>
            <span class="nx">height</span><span class="o">=</span><span class="p">{</span><span class="nx">width</span><span class="p">}</span>
            <span class="nx">loader</span><span class="o">=</span><span class="p">{</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DISTRIBUTION</span> <span class="p">?</span> <span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">thumbnail_loader</span><span class="p">({...</span><span class="nx">args</span><span class="p">,</span> <span class="na">distribution</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DISTRIBUTION</span><span class="p">})</span> <span class="p">:</span> <span class="kc">undefined</span><span class="p">}</span>
            <span class="nx">quality</span><span class="o">=</span><span class="p">{</span><span class="mi">80</span><span class="p">}</span><span class="sr">/&gt; : nul</span><span class="err">l
</span>        <span class="p">}</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">image-details</span><span class="dl">"</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">alt</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/p</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">);</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>Let’s go through the component part first. We receive 4 props <code>onClick, src, alt, window_sizes</code>. We create a <code>DOM ref</code> that we can use to get the actual HTML element of our wrapper, and we set two <code>useState</code>’s, one to store the current width, and another the store the initial width. Most times these will be the same. </p>

<p>Then we use <code>useEffect</code> with a dependency on the value of <code>window_sizes</code>. Meaning this will run on mount once and then any time the prop <code>window_sizes</code> changes. Inside this hook if the <code>window_sizes</code> has a value, we use the <code>ref</code> for getting the wrapper component dimensions, we round the value, set the <code>initial_size</code> if it’s not set yet, and, then, if the new width is bigger than the the <code>initial_size</code> we set both <code>initial</code> and <code>width</code> to this new size, and if not we keep the <code>initial_size</code> and set it as our <code>width</code> value. </p>

<p>The reason we do this is because if we have already fetched an image with bigger dimensions than the new size there’s no point in fetching the smaller one, since the bigger one can be displayed just as correctly and has more quality. On the other hand, if the window resize resulted in a thumbnail that is bigger than initially, we want to fetch a bigger image to keep the quality at a higher size. We’ll also replace the initial whenever that’s the case, so that resizing smaller and back into bigger won’t retrigger a new image.</p>

<p>Then our component itself is a wrapper with a property of <code>onClick</code> set to the handler passed down as a prop (that will open the <code>lightbox</code>) and the <code>ref</code> we created, so that we can use the <code>ref</code> to get the wrapper width.</p>

<p>Inside the wrapper we have the <code>Next.js</code> <code>Image</code> component, and we set <code>src</code>, <code>alt</code>, <code>sizes</code> (for the breakpoints), <code>layout</code> as responsive (so that it fetches new images if the width and sizes change), <code>objectFit</code> and <code>objectPosition</code> so that it forces the image to be displayed covering the full “square” and centered, <code>quality</code>, and in case there’s an environment variable <code>DISTRIBUTION</code> set, we use the specific loader, an anonymous function that calls the <code>thumbnails_loader</code> we defined at the top of the file with an additional argument, the<code>distribution</code> url, otherwise we set it as null so the default one will be used.</p>

<p>When <code>DISTRIBUTION</code> is set that loader will be used to provide the actual <code>url</code> the <code>Image</code> component will use. By default the loader has access to 3 params provided by <code>Next.js</code>, the original <code>src</code>, <code>quality</code> value and <code>width</code>. In this case since it’s a square image, the <code>width</code> is enough, but we still need the <code>distribution</code> url, so that we can generate the right source for our image.</p>

<p>By using the <code>constructUrl</code> provided by <a href="https://www.npmjs.com/package/@imageengine/react">@imageengine/react</a> we can pass an object with properties that dictate how the CDN will provide the images. Here we pass <code>width</code>, <code>height</code>, <code>fitMethod</code>, <code>compression</code> (it’s the inverse scale from the quality) and <code>sharpness</code> to apply a small amount of sharpness to the final image.</p>

<p><strong>note</strong> as of now, <code>constructUrl</code> isn’t directly exported by the package - which means that although probably unlikely, it’s place in the lib might change - nonetheless it will probably be made public in a future release, but otherwise, you can always either copy the specific logic for it, or use <a href="https://support.imageengine.io/hc/en-us/articles/360058880672-directives">directives</a> directly and build your own url.</p>

<p>Notice that this will generate the same url for all <code>srcset sizes</code> entries, and that is fine since the url codifies the needed settings itself, but when using <code>ImageEngine</code> we don’t really need to rely on <code>srcset</code> since we can generate exactly the sizes we want on-the-fly.</p>

<h3>
  <a name="lightbox-component" href="#lightbox-component">
  </a>
  Lightbox Component
</h3>

<p>Now let's move to the <code>lightbox</code>component, create the file <code>components/lightbox.js</code>:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="k">import</span> <span class="nx">Image</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">next/image</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">constructUrl</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@imageengine/react/build/utils/index.js</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">lightbox_loader</span><span class="p">({</span> <span class="nx">src</span><span class="p">,</span> <span class="nx">quality</span><span class="p">,</span> <span class="nx">distribution</span><span class="p">,</span> <span class="nx">w</span><span class="p">,</span> <span class="nx">h</span> <span class="p">})</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">distribution</span> <span class="o">+</span> <span class="nx">src</span><span class="p">,</span>
    <span class="nx">directives</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">width</span><span class="p">:</span> <span class="nx">w</span><span class="p">,</span>
        <span class="na">height</span><span class="p">:</span> <span class="nx">h</span><span class="p">,</span>
        <span class="na">fitMethod</span><span class="p">:</span> <span class="dl">"</span><span class="s2">box</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">compression</span><span class="p">:</span> <span class="mi">100</span> <span class="o">-</span> <span class="nx">quality</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="nx">constructUrl</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">directives</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">Lighbox</span><span class="p">({</span> <span class="nx">onClick</span><span class="p">,</span> <span class="nx">src</span><span class="p">,</span> <span class="nx">alt</span><span class="p">,</span> <span class="nx">window_sizes</span><span class="p">,</span> <span class="nx">previous</span><span class="p">,</span> <span class="nx">next</span> <span class="p">})</span> <span class="p">{</span>

    <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">lightbox</span><span class="dl">"</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">onClick</span><span class="p">}</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">previous</span><span class="dl">"</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">previous</span><span class="p">}</span><span class="sr">/</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">image-lightbox</span><span class="dl">"</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="nx">window_sizes</span> <span class="p">?</span> <span class="o">&lt;</span><span class="nx">Image</span>
                  <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="nx">src</span><span class="p">}</span>
                  <span class="nx">alt</span><span class="o">=</span><span class="p">{</span><span class="nx">alt</span><span class="p">}</span>
                  <span class="nx">sizes</span><span class="o">=</span><span class="p">{</span><span class="s2">`(max-width: 320px) 300px, (max-width: 500px) 500px, (max-width: 1000) 1000px, (max-width: 1500) 1500px, </span><span class="p">${</span><span class="nx">window_sizes</span><span class="p">.</span><span class="nx">w</span><span class="p">}</span><span class="s2">px`</span><span class="p">}</span>
                  <span class="nx">objectFit</span><span class="o">=</span><span class="dl">"</span><span class="s2">contain</span><span class="dl">"</span>
                  <span class="nx">objectPosition</span><span class="o">=</span><span class="dl">"</span><span class="s2">center</span><span class="dl">"</span>
                  <span class="nx">width</span><span class="o">=</span><span class="p">{</span><span class="nx">window_sizes</span><span class="p">.</span><span class="nx">w</span><span class="p">}</span>
                  <span class="nx">height</span><span class="o">=</span><span class="p">{</span><span class="nx">window_sizes</span><span class="p">.</span><span class="nx">h</span><span class="p">}</span>
                  <span class="nx">loader</span><span class="o">=</span><span class="p">{</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DISTRIBUTION</span> <span class="p">?</span> <span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">lightbox_loader</span><span class="p">({...</span><span class="nx">args</span><span class="p">,</span> <span class="p">...</span><span class="nx">window_sizes</span><span class="p">,</span> <span class="na">distribution</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DISTRIBUTION</span><span class="p">})</span> <span class="p">:</span> <span class="kc">undefined</span><span class="p">}</span>
          <span class="nx">quality</span><span class="o">=</span><span class="p">{</span><span class="mi">90</span><span class="p">}</span>
          <span class="sr">/&gt;  : null</span><span class="err">}
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="nx">button</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">next</span><span class="dl">"</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">next</span><span class="p">}</span><span class="sr">/</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">);</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>You’ll notice that this is very similar to the thumbnail  component, but that we use instead the <code>w</code> and <code>h</code> values directly from the <code>window_sizes</code> prop, and we use a different <code>objectFit</code> and <code>quality</code>.</p>

<p>The reason we pass <code>width</code> and <code>height</code> to our loader is that since we want the image to fit the viewport, with both those values and the <code>box</code> fit, <code>ImageEngine</code> will be able to generate perfectly sized images for them, especially when they’re vertical.</p>

<p>In the intro I mentioned that cases where the image orientation is not horizontal, that <code>ImageEngine</code> can provide better optimisations and the reason is related to how the <code>Next.js</code> <code>Image</code> component works. </p>

<p>When we set <code>deviceSizes: [1920, 1500, 1000, 500, 300]</code> on our <code>next.config.js</code> what we’re saying is, we’ll have 5 buckets of width sizes we want to allow. By using the <code>sizes</code> property on the <code>Image</code> component we can make it so that given a certain <code>width</code> the browser will try to match it with the smallest possible <code>srcset</code> that covers that <code>width</code>. For horizontal or square images this works fine, as there’s a direct match between the max width and the bucket. But when the image is vertical, this no longer matches neatly. So if you open the lightbox with a vertical image and the viewport size is <code>1800px</code> wide, but only <code>750px</code> high, the image that will be retrieved will be the one matching the <code>1920</code> entry. This is actually a bigger image since it’s vertical, it’s width to match <code>1920</code> will make it quite bigger than it needs to be. </p>

<p>When using <code>ImageEngine</code>, in the same situation, with a <a href="https://support.imageengine.io/hc/en-us/articles/360058880672-Directives">fitMethod of box</a>, <code>ImageEngine</code>’s engine will actually be smart enough to see that the image needs to be <code>750px</code> high at most, and will resize it by that axis. So the result might be a <code>400px X 750px</code> image, instead of <code>1920px X 3000px</code> for instance. </p>

<p>If we had exact information for both width and height of the actual images, we could try to work around that limitation of the <code>Next.js</code> optimizer, by doing ourselves the calculations of what width would correspond to that maximum height - but since this isn’t normally available we usually can’t. Plus, that would need to change whenever we had changes on layout, styling, or on the source images.</p>

<p>With <code>ImageEngine</code> we don’t need to worry about that, since it’s always going to be the perfect fit for the dimensions we give it. Plus, in the case of the thumbnails, if we changed the size of the wrappers in CSS, it would still work automatically, whereas with the default <code>Image</code> component we might need to change our <code>deviceSizes</code> or do small adjustments. We could even make the <code>thumbnail</code> element be completely future proof if instead of providing only the <code>width</code> (as it was a square) we also provided the <code>height</code> of the wrapper, so that even if we changed the styling to a different ratio it would still work correctly. Since it’s a demo, we’re using only one side but there’s no reason to not use both as we already have the DOM element from which we can extract the height as well.</p>

<p>The last part is to define our main <code>index.js</code> file.</p>

<h3>
  <a name="indexjs-entry-point" href="#indexjs-entry-point">
  </a>
  index.js entry point
</h3>

<p>Let’s replace the contents of <code>pages/index.js</code>:<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight javascript"><code><span class="k">import</span> <span class="nx">Head</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">next/head</span><span class="dl">"</span><span class="p">;</span>

<span class="k">import</span> <span class="nx">Thumbnail</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../components/thumbnail.js</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">Lightbox</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">../components/lightbox.js</span><span class="dl">"</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">useEffect</span><span class="p">,</span> <span class="nx">useState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">IMAGES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="dl">"</span><span class="s2">/ie-loader-images/h-lightbox-1.jpeg</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Harvested field with hay bales - Alentejo, Portugal © Micael Nussbaumer</span><span class="dl">"</span><span class="p">],</span>
    <span class="p">[</span><span class="dl">"</span><span class="s2">/ie-loader-images/h-lightbox-2.jpeg</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Family cycling and skating in abandoned Tempelhof Airport lane - Berlin, Germany © Micael Nussbaumer</span><span class="dl">"</span><span class="p">],</span>
    <span class="p">[</span><span class="dl">"</span><span class="s2">/ie-loader-images/h-lightbox-8.jpeg</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Group of hindu and muslim kids posing for a photo - New Delhi, India © Micael Nussbaumer</span><span class="dl">"</span><span class="p">],</span>
    <span class="p">[</span><span class="dl">"</span><span class="s2">/ie-loader-images/v-lightbox-4.jpeg</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Buddhist Monk Portrait with a statue of the buddhist mythological Seven Headed Naga  serving as background - Siem Reap, Cambodia © Micael Nussbaumer</span><span class="dl">"</span><span class="p">],</span>
    <span class="p">[</span><span class="dl">"</span><span class="s2">/ie-loader-images/h-lightbox-5.jpeg</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Traditional Nepalase Hindu Temple in one of the many lively city squares of Kathmandu, Nepal © Micael Nussbaumer</span><span class="dl">"</span><span class="p">],</span>
    <span class="p">[</span><span class="dl">"</span><span class="s2">/ie-loader-images/v-lightbox-6.jpeg</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Woman in traditional Nepalese clothing sitting in a valley in Pokhara, Nepal © Micael Nussbaumer</span><span class="dl">"</span><span class="p">],</span>
    <span class="p">[</span><span class="dl">"</span><span class="s2">/ie-loader-images/h-lightbox-7.jpeg</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Geometric pattern on a ceiling inside the Red Fort - New Delhi, India © Micael Nussbaumer</span><span class="dl">"</span><span class="p">],</span>
    <span class="p">[</span><span class="dl">"</span><span class="s2">/ie-loader-images/h-lightbox-3.jpeg</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Kids silhuetes in the sea near-shore close to sunset - Phu Quoc Island, Vietnam © Micael Nussbaumer</span><span class="dl">"</span><span class="p">],</span>
    <span class="p">[</span><span class="dl">"</span><span class="s2">/ie-loader-images/h-lightbox-9.jpeg</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Portrait of four man sitting during a pause in their badminton game - Hanoi, Vietnam © Micael Nussbaumer</span><span class="dl">"</span><span class="p">]</span>
<span class="p">];</span>


<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">Home</span><span class="p">()</span> <span class="p">{</span>

    <span class="kd">let</span> <span class="p">[</span><span class="nx">opened</span><span class="p">,</span> <span class="nx">set_opened</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
    <span class="kd">let</span> <span class="p">[</span><span class="nx">window_sizes</span><span class="p">,</span> <span class="nx">set_window_sizes</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
    <span class="kd">let</span> <span class="nx">resize_timer</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">get_window_sizes</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">doc</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">{</span><span class="na">w</span><span class="p">:</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">clientWidth</span><span class="p">,</span> <span class="na">h</span><span class="p">:</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">};</span>
    <span class="p">};</span>

    <span class="kd">const</span> <span class="nx">previous</span> <span class="o">=</span> <span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">evt</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">opened</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="nx">set_opened</span><span class="p">(</span><span class="nx">opened</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span> <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span> <span class="nx">set_opened</span><span class="p">(</span><span class="nx">IMAGES</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span> <span class="p">}</span>
    <span class="p">};</span>

    <span class="kd">const</span> <span class="nx">next</span> <span class="o">=</span> <span class="p">(</span><span class="nx">evt</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">evt</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">opened</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nx">IMAGES</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span> <span class="nx">set_opened</span><span class="p">(</span><span class="nx">opened</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span> <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span> <span class="nx">set_opened</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="p">}</span>
    <span class="p">};</span>

    <span class="kd">const</span> <span class="nx">set_timing</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">resize_timer</span><span class="p">)</span> <span class="p">{</span> <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">resize_timer</span><span class="p">);</span> <span class="p">}</span>
    <span class="nx">resize_timer</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span>
        <span class="p">()</span> <span class="o">=&gt;</span>  <span class="p">{</span>
<span class="nx">set_window_sizes</span><span class="p">(</span><span class="nx">get_window_sizes</span><span class="p">());</span>
<span class="nx">resize_timer</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">},</span> <span class="mi">2000</span>
    <span class="p">);</span>
    <span class="p">};</span>

    <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">resize</span><span class="dl">"</span><span class="p">,</span> <span class="nx">set_timing</span><span class="p">);</span>
    <span class="nx">set_window_sizes</span><span class="p">(</span><span class="nx">get_window_sizes</span><span class="p">());</span>

    <span class="k">return</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nb">window</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">resize</span><span class="dl">"</span><span class="p">,</span> <span class="nx">set_timing</span><span class="p">);</span>
    <span class="p">},</span> <span class="p">[]);</span>

    <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="s2">`main-container </span><span class="p">${</span><span class="nx">opened</span> <span class="o">||</span> <span class="nx">opened</span> <span class="o">===</span> <span class="mi">0</span> <span class="p">?</span> <span class="dl">"</span><span class="s2">no-overflow</span><span class="dl">"</span> <span class="p">:</span> <span class="dl">""</span><span class="p">}</span><span class="s2">`</span><span class="p">}</span> <span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">Head</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">ImageEngine</span> <span class="nx">Optimized</span> <span class="nx">Lightbox</span><span class="o">&lt;</span><span class="sr">/title</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">description</span><span class="dl">"</span> <span class="nx">content</span><span class="o">=</span><span class="dl">"</span><span class="s2">Next.js custom image loaders leveraging ImageEngine CDN for highly optimized images</span><span class="dl">"</span> <span class="o">/&gt;</span>
            <span class="o">&lt;</span><span class="nx">link</span> <span class="nx">rel</span><span class="o">=</span><span class="dl">"</span><span class="s2">icon</span><span class="dl">"</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">/favicon.ico</span><span class="dl">"</span> <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="sr">/Head</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="nx">main</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="nx">IMAGES</span><span class="p">.</span><span class="nx">map</span><span class="p">(([</span><span class="nx">path</span><span class="p">,</span> <span class="nx">alt</span><span class="p">],</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">&lt;</span><span class="nx">Thumbnail</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="s2">`image-thumb-</span><span class="p">${</span><span class="nx">index</span><span class="p">}</span><span class="s2">`</span><span class="p">}</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="nx">path</span><span class="p">}</span> <span class="nx">alt</span><span class="o">=</span><span class="p">{</span><span class="nx">alt</span><span class="p">}</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{(</span><span class="nx">_evt</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">set_opened</span><span class="p">(</span><span class="nx">index</span><span class="p">)}</span> <span class="nx">window_sizes</span><span class="o">=</span><span class="p">{</span><span class="nx">window_sizes</span><span class="p">}</span><span class="sr">/&gt; </span><span class="err">;
</span>          <span class="p">})</span>
          <span class="p">}</span>
      <span class="o">&lt;</span><span class="sr">/main</span><span class="err">&gt;
</span>      <span class="p">{</span><span class="nx">opened</span> <span class="o">||</span> <span class="nx">opened</span> <span class="o">===</span> <span class="mi">0</span> <span class="p">?</span> <span class="o">&lt;</span><span class="nx">Lightbox</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="nx">IMAGES</span><span class="p">[</span><span class="nx">opened</span><span class="p">][</span><span class="mi">0</span><span class="p">]}</span> <span class="nx">alt</span><span class="o">=</span><span class="p">{</span><span class="nx">IMAGES</span><span class="p">[</span><span class="nx">opened</span><span class="p">][</span><span class="mi">1</span><span class="p">]}</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{(</span><span class="nx">_evt</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">set_opened</span><span class="p">(</span><span class="kc">null</span><span class="p">)}</span> <span class="nx">window_sizes</span><span class="o">=</span><span class="p">{</span><span class="nx">window_sizes</span><span class="p">}</span> <span class="nx">previous</span><span class="o">=</span><span class="p">{</span><span class="nx">previous</span><span class="p">}</span> <span class="nx">next</span><span class="o">=</span><span class="p">{</span><span class="nx">next</span><span class="p">}</span><span class="sr">/&gt; : null</span><span class="err">}
</span>        <span class="o">&lt;</span><span class="nx">footer</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">https://imageengine.io</span><span class="dl">"</span> <span class="nx">target</span><span class="o">=</span><span class="dl">"</span><span class="s2">_blank</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">ImageEngine</span><span class="o">&lt;</span><span class="sr">/a</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">https://micaelnussbaumer.com</span><span class="dl">"</span> <span class="nx">target</span><span class="o">=</span><span class="dl">"</span><span class="s2">_blank</span><span class="dl">"</span><span class="o">&gt;</span><span class="err">©</span> <span class="nx">Micael</span> <span class="nx">Nussbaumer</span> <span class="mi">2021</span><span class="o">&lt;</span><span class="sr">/a</span><span class="err">&gt;
</span>
          <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">https://nextjs.org</span><span class="dl">"</span> <span class="nx">target</span><span class="o">=</span><span class="dl">"</span><span class="s2">_blank</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Next</span><span class="p">.</span><span class="nx">js</span><span class="o">&lt;</span><span class="sr">/a</span><span class="err">&gt;
</span>          <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">https://vercel.com</span><span class="dl">"</span> <span class="nx">target</span><span class="o">=</span><span class="dl">"</span><span class="s2">_blank</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Vercel</span><span class="o">&lt;</span><span class="sr">/a</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/footer</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">);</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>In our <code>index.js</code> file we define an <code>IMAGES</code> array, that contains the images we’ll show. The contents are mostly straightforward. We use <code>useState</code> to set both the window size and if the lightbox is open. We define functions for getting the window size, for moving forward and backwards across the images, and to control any possible resizing of the viewport.</p>

<p>On first mount, we <code>useEffect</code> to set a listener on the <code>window resize</code> event and we set the original window sizes. Although we only have one page in our <code>Next.js</code> app, we also set a cleanup function on the <code>useEffect</code> by returning an anonymous function to remove the <code>eventListener</code> we added previously. This is just good form, because if you’re using React as a SPA with multiple pages and you don’t clean-up your useEffects, you might end with memory-leaks or multiple listeners being triggered (and most likely throwing exceptions since what they’ll be referring to won’t be around anymore).</p>

<p>Regarding the <code>resize</code> event we use a <code>setTimeout</code> and a control variable <code>resize_timer</code>. This is so that we don’t trigger multiple <code>window_sizes</code> changes - as that would trickle down to our components and trigger multiple fetches for different image sources as the dimensions changed, for instance if resizing the window on a desktop manually. At the same time, listening to resize events and updating the <code>window_sizes</code> takes care of refetching the correct size in case a user is seeing the website on a mobile and changes the display from vertical to horizontal for instance. </p>

<p>The <code>JSX</code> contents are pretty regular, we map our <code>IMAGES</code> array into <code>Thumbnail</code>’s components passing <code>src</code>, <code>alt</code>, <code>window_sizes</code> and a <code>onClick</code> handle.</p>

<p>Then when clicking one of the thumbnails, the <code>opened</code> state is updated to the index of that image in our array and we use that to both display our <code>Lightbox</code> component and to read the correct data for our image. On the <code>Lightbox</code> we pass the same props plus the <code>previous</code> and <code>next</code> functions.<br>
Lastly we have a few <code>footer</code> items.<br>
And that’s it.</p>

<h3>
  <a name="setting-up-imageengine" href="#setting-up-imageengine">
  </a>
  Setting up ImageEngine
</h3>

<p>With this we can already host our page in <code>vercel</code>, by using their CLI from our project’s root folder executing:</p>

<p><code>vercel</code> </p>

<p>And setting up the project settings, followed by:</p>

<p><code>vercel --prod</code></p>

<p>...to deploy. </p>

<p>You’ll now be able to see the website online. Take note of your production server url.<br>
Once that is done it’s time to setup the <code>ImageEngine</code> distribution.</p>

<p>You can follow this video on how to easily signup for a trial</p>

<p><iframe src="https://player.vimeo.com/video/552953993" width="710" height="399" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen loading="lazy">
</iframe>
<br>
<a href="https://imageengine.io">imageengine.io</a></p>

<p>After following those steps, take note of the delivery address, because we'll use it when building our project. We can do it through the <code>Vercel</code> dashboard for our project, or through the <code>CLI</code> when deploying:</p>

<p><code>vercel --build-env DISTRIBUTION=”https://our_ie_address.imgeng.in” --prod</code></p>

<p>With that, our custom loaders will be enabled, and if we visit our website and inspect the HTML source we should see that it’s now using our <code>ImageEngine</code> distribution for the images!</p>

<h3>
  <a name="conclusion" href="#conclusion">
  </a>
  Conclusion
</h3>

<p>While <code>Next.js</code>’s <code>Image</code> component along with <code>vercel</code>’s automated infrastructure is really a great improvement over using non-optimized assets and will work well for many types of websites, there’s a few cases where <strong>ImageEngine is a better option overall</strong>. </p>

<p>Those include websites with very high traffic and image content. The more targeted, and almost pixel precise, sizes it allows one to deliver, can lower significantly the sizes of images being transferred. Websites with mixed orientation content in any significant quantity also benefit widely from it. </p>

<p>Another situation is, if you’re using <code>Next.js</code> but not deploying on <code>vercel</code> then you’ll probably want to use it too - the <code>Image</code> component works the best possible in <code>vercel</code> as its infrastructure is prepared to handle it specifically (they’re the authors of <code>Next.js</code>) but if you’re deploying on your own server then it’s a different matter and having it stored, prepared and cached over a very fast external CDN will help you achieve the best performance for your website. </p>

<p>Lastly, as we saw, by taking some measures when writing the logic for the loader, we can make it so that our components are automatically able to handle changes in layout, styling or structure without any tweaking or re-doing of the app settings or components logic while keeping the exact needed sizes for any dimensions we decide to use. This is important as it removes one friction point when contemplating a re-styling of the whole or parts of the app.</p>

</div></article> <div class="aside-username-wrapper" data-v-3bf13c85><aside class="aside-username-block" data-v-29ea5fa2 data-v-3bf13c85><div class="username-heading loading" data-v-29ea5fa2><div class="vue-content-placeholders vue-content-placeholders-is-animated" data-v-29ea5fa2><div class="vue-content-placeholders-heading" data-v-29ea5fa2><div class="vue-content-placeholders-heading__img"></div> <div class="vue-content-placeholders-heading__content"><div class="vue-content-placeholders-heading__title"></div> <div class="vue-content-placeholders-heading__subtitle"></div></div></div></div></div> <div class="info" data-v-29ea5fa2><div class="vue-content-placeholders vue-content-placeholders-is-animated" data-v-29ea5fa2><div class="vue-content-placeholders-text" data-v-29ea5fa2><div class="vue-content-placeholders-text__line"></div><div class="vue-content-placeholders-text__line"></div><div class="vue-content-placeholders-text__line"></div></div></div></div></aside></div></div> <div class="comments-block" data-v-54aa1ab4 data-v-3bf13c85><!----> <a href="https://dev.to/mnussbaumer/image-engine-custom-loaders-for-next-js-2oe5" target="_blank" rel="nofollow noopener noreferer" class="add-comment" data-v-54aa1ab4>
    Add comment
  </a></div></div> <footer class="w-full py-8"><div class="max-w-screen-xl mx-auto px-4"><ul class="
        max-w-screen-md
        mx-auto
        text-lg
        font-light
        md:flex flex-wrap
        md:justify-between

      "><li class="my-2"><a href="#" class="
            text-gray-400
            hover:text-gray-800
            dark:text-gray-300 dark:hover:text-white
            transition-colors
            duration-200
          ">
          FAQ
        </a></li> <li class="my-2"><a href="#" class="
            text-gray-400
            hover:text-gray-800
            dark:text-gray-300 dark:hover:text-white
            transition-colors
            duration-200
          ">
          Configuration
        </a></li> <li class="my-2"><a href="#" class="
            text-gray-400
            hover:text-gray-800
            dark:text-gray-300 dark:hover:text-white
            transition-colors
            duration-200
          ">
          Github
        </a></li> <li class="my-2"><a href="#" class="
            text-gray-400
            hover:text-gray-800
            dark:text-gray-300 dark:hover:text-white
            transition-colors
            duration-200
          ">
          LinkedIn
        </a></li></ul> <div class="pt-8 flex max-w-xs mx-auto items-center justify-between"><a href="#" class="
          text-gray-400
          hover:text-gray-800
          dark:hover:text-white
          transition-colors
          duration-200
        "><svg width="20" height="20" fill="currentColor" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg" class="
            text-xl
            hover:text-gray-800
            dark:hover:text-white
            transition-colors
            duration-200
          "><path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759h-306v-759h-255v-296h255v-218q0-186 104-288.5t277-102.5q147 0 228 12z"></path></svg></a> <a href="#" class="
          text-gray-400
          hover:text-gray-800
          dark:hover:text-white
          transition-colors
          duration-200
        "><svg width="20" height="20" fill="currentColor" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg" class="
            text-xl
            hover:text-gray-800
            dark:hover:text-white
            transition-colors
            duration-200
          "><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5t-115.5 248.5-184.5 210.5-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5t-114-159.5q33 5 61 5 43 0 85-11-112-23-185.5-111.5t-73.5-205.5v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5t371.5 99.5q-8-38-8-74 0-134 94.5-228.5t228.5-94.5q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"></path></svg></a> <a href="#" class="
          text-gray-400
          hover:text-gray-800
          dark:hover:text-white
          transition-colors
          duration-200
        "><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 1792 1792" class="
            text-xl
            hover:text-gray-800
            dark:hover:text-white
            transition-colors
            duration-200
          "><path d="M896 128q209 0 385.5 103t279.5 279.5 103 385.5q0 251-146.5 451.5t-378.5 277.5q-27 5-40-7t-13-30q0-3 .5-76.5t.5-134.5q0-97-52-142 57-6 102.5-18t94-39 81-66.5 53-105 20.5-150.5q0-119-79-206 37-91-8-204-28-9-81 11t-92 44l-38 24q-93-26-192-26t-192 26q-16-11-42.5-27t-83.5-38.5-85-13.5q-45 113-8 204-79 87-79 206 0 85 20.5 150t52.5 105 80.5 67 94 39 102.5 18q-39 36-49 103-21 10-45 15t-57 5-65.5-21.5-55.5-62.5q-19-32-48.5-52t-49.5-24l-20-3q-21 0-29 4.5t-5 11.5 9 14 13 12l7 5q22 10 43.5 38t31.5 51l10 23q13 38 44 61.5t67 30 69.5 7 55.5-3.5l23-4q0 38 .5 88.5t.5 54.5q0 18-13 30t-40 7q-232-77-378.5-277.5t-146.5-451.5q0-209 103-385.5t279.5-279.5 385.5-103zm-477 1103q3-7-7-12-10-3-13 2-3 7 7 12 9 6 13-2zm31 34q7-5-2-16-10-9-16-3-7 5 2 16 10 10 16 3zm30 45q9-7 0-19-8-13-17-6-9 5 0 18t17 7zm42 42q8-8-4-19-12-12-20-3-9 8 4 19 12 12 20 3zm57 25q3-11-13-16-15-4-19 7t13 15q15 6 19-6zm63 5q0-13-17-11-16 0-16 11 0 13 17 11 16 0 16-11zm58-10q-2-11-18-9-16 3-14 15t18 8 14-14z"></path></svg></a> <a href="#" class="
          text-gray-400
          hover:text-gray-800
          dark:hover:text-white
          transition-colors
          duration-200
        "><svg width="20" height="20" fill="currentColor" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg" class="
            text-xl
            hover:text-gray-800
            dark:hover:text-white
            transition-colors
            duration-200
          "><path d="M477 625v991h-330v-991h330zm21-306q1 73-50.5 122t-135.5 49h-2q-82 0-132-49t-50-122q0-74 51.5-122.5t134.5-48.5 133 48.5 51 122.5zm1166 729v568h-329v-530q0-105-40.5-164.5t-126.5-59.5q-63 0-105.5 34.5t-63.5 85.5q-11 30-11 81v553h-329q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5 114.5-15.5q171 0 275 113.5t104 332.5z"></path></svg></a> <a href="#" class="
          text-gray-400
          hover:text-gray-800
          dark:hover:text-white
          transition-colors
          duration-200
        "><svg width="20" height="20" fill="currentColor" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg" class="
            text-xl
            hover:text-gray-800
            dark:hover:text-white
            transition-colors
            duration-200
          "><path d="M1551 1476q15-6 26-3t11 17.5-15 33.5q-13 16-44 43.5t-95.5 68-141 74-188 58-229.5 24.5q-119 0-238-31t-209-76.5-172.5-104-132.5-105-84-87.5q-8-9-10-16.5t1-12 8-7 11.5-2 11.5 4.5q192 117 300 166 389 176 799 90 190-40 391-135zm207-115q11 16 2.5 69.5t-28.5 102.5q-34 83-85 124-17 14-26 9t0-24q21-45 44.5-121.5t6.5-98.5q-5-7-15.5-11.5t-27-6-29.5-2.5-35 0-31.5 2-31 3-22.5 2q-6 1-13 1.5t-11 1-8.5 1-7 .5h-10l-3-.5-2-1.5-1.5-3q-6-16 47-40t103-30q46-7 108-1t76 24zm-394-443q0 31 13.5 64t32 58 37.5 46 33 32l13 11-227 224q-40-37-79-75.5t-58-58.5l-19-20q-11-11-25-33-38 59-97.5 102.5t-127.5 63.5-140 23-137.5-21-117.5-65.5-83-113-31-162.5q0-84 28-154t72-116.5 106.5-83 122.5-57 130-34.5 119.5-18.5 99.5-6.5v-127q0-65-21-97-34-53-121-53-6 0-16.5 1t-40.5 12-56 29.5-56 59.5-48 96l-294-27q0-60 22-119t67-113 108-95 151.5-65.5 190.5-24.5q100 0 181 25t129.5 61.5 81 83 45 86 12.5 73.5v589zm-672 21q0 86 70 133 66 44 139 22 84-25 114-123 14-45 14-101v-162q-59 2-111 12t-106.5 33.5-87 71-32.5 114.5z"></path></svg></a></div> <div class="
        text-center
        pt-10
        sm:pt-12
        font-light
        flex
        items-center
        justify-center
      "><form class="
          flex flex-col
          md:flex-row
          w-3/4
          md:w-full
          max-w-sm
          md:space-x-3
          space-y-3
          md:space-y-0
          justify-center
        "><div class="relative"><input type="text" id=""form-subscribe-Subscribe" placeholder="Email" class="
              rounded-lg
              border-transparent
              flex-1
              appearance-none
              border border-gray-300
              w-full
              py-2
              px-4
              bg-white
              text-gray-700
              placeholder-gray-400
              shadow-sm
              text-base
              focus:outline-none
              focus:ring-2
              focus:ring-gray-400
              focus:border-transparent
            "></div> <button type="submit" class="
            flex-shrink-0
            px-4
            py-2
            text-black
            font-semibold
            bg-white
            rounded-lg
            shadow-md
            hover:bg-gray-800 hover:text-white
            focus:outline-none
            focus:ring-2
            focus:ring-white
            focus:ring-offset-2
            focus:ring-offset-white
          ">
          Subscribe
        </button></form></div> <div class="
        text-center text-gray-500
        dark:text-gray-200
        pt-10
        sm:pt-12
        font-light
        flex
        items-center
        justify-center
      ">
      Created by Samar
    </div></div></footer></div></div></div><script defer src="/_nuxt/static/1634322943/articles/mnussbaumer/722885/state.js"></script><script src="/_nuxt/548109a.js" defer></script><script src="/_nuxt/c3ddcce.js" defer></script><script src="/_nuxt/84567ea.js" defer></script><script src="/_nuxt/ad2e88f.js" defer></script><script src="/_nuxt/a9b0fbe.js" defer></script>
  </body>
</html>
