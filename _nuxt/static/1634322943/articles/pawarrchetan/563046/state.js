window.__NUXT__=(function(a,b,c,d,e){return {staticAssetsBase:"\u002F_nuxt\u002Fstatic\u002F1634322943",layout:"default",error:a,state:{currentArticle:{type_of:"article",id:563046,title:"Securing APIs with AWS Amplify and Cognito",description:"Securing APIs with AWS Amplify and Cognito              Overview   AWS Amplify is one of the...",readable_publish_date:"Jan 6",slug:"securing-apis-with-aws-amplify-and-cognito-27g2",path:"\u002Fpawarrchetan\u002Fsecuring-apis-with-aws-amplify-and-cognito-27g2",url:c,comments_count:0,public_reactions_count:d,collection_id:a,published_timestamp:b,positive_reactions_count:d,cover_image:"https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--DWdlzIBA--\u002Fc_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000\u002Fhttps:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fi\u002Fcto7t0lpwkgc308tvvs0.jpg",social_image:"https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--zvVCsKNr--\u002Fc_imagga_scale,f_auto,fl_progressive,h_500,q_auto,w_1000\u002Fhttps:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fi\u002Fcto7t0lpwkgc308tvvs0.jpg",canonical_url:c,created_at:"2021-01-06T09:35:02Z",edited_at:"2021-01-06T09:39:18Z",crossposted_at:a,published_at:b,last_comment_at:b,reading_time_minutes:6,tag_list:"restapi, amplify, cognito, aws",tags:["restapi","amplify","cognito","aws"],body_html:"\u003Ch1\u003E\n  \u003Ca name=\"securing-apis-with-aws-amplify-and-cognito\" href=\"#securing-apis-with-aws-amplify-and-cognito\" class=\"anchor\"\u003E\n  \u003C\u002Fa\u003E\n  Securing APIs with AWS Amplify and Cognito\n\u003C\u002Fh1\u003E\n\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fepilot.cloud\u002Fen\u002Fcareer-engineering\u002F\"\u003E\u003Cimg src=\"https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--dSwHqH7P--\u002Fc_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\u002Fhttps:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fi\u002Ffnbppwjezekl7t56nfxz.png\" alt=\"We are hiring!\" loading=\"lazy\"\u003E\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\n\u003Ch2\u003E\n  \u003Ca name=\"overview\" href=\"#overview\" class=\"anchor\"\u003E\n  \u003C\u002Fa\u003E\n  Overview\n\u003C\u002Fh2\u003E\n\n\u003Cp\u003EAWS Amplify is one of the fastest ways to help front-end web and mobile developers build full stack applications, hosted in AWS.\u003C\u002Fp\u003E\n\n\u003Cp\u003EIn the \u003Ca href=\"https:\u002F\u002Fcloudychetan.medium.com\u002Fusing-amplify-for-rest-apis-and-web-hosting-f27ad2867908\"\u003Efirst part\u003C\u002Fa\u003E of this blog series, \u003Ca href=\"https:\u002F\u002Fcloudychetan.medium.com\u002Fusing-amplify-for-rest-apis-and-web-hosting-f27ad2867908\"\u003EUsing Amplify for REST APIs and Web hosting\u003C\u002Fa\u003E we built an API using AWS Amplify to quickly setup and host an API with minimal coding.\u003C\u002Fp\u003E\n\n\u003Cp\u003EIn this part we build an authentication system for the API using \u003Ca href=\"https:\u002F\u002Faws.amazon.com\u002Fcognito\u002F\"\u003EAmazon Cognito\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\n\u003Cp\u003EAmazon Cognito lets us add user sign-up, sign-in, and access control to our web and mobile apps quickly and easily. It is highly scaleable and supports sign-in with social identity providers, such as Facebook, Google, and Amazon, and enterprise identity providers via SAML 2.0.\u003C\u002Fp\u003E\n\n\u003Ch2\u003E\n  \u003Ca name=\"advantages\" href=\"#advantages\" class=\"anchor\"\u003E\n  \u003C\u002Fa\u003E\n  Advantages\n\u003C\u002Fh2\u003E\n\n\u003Cul\u003E\n\u003Cli\u003E\u003Cp\u003ESecure and scalable user directory\u003C\u002Fp\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cp\u003EStandards-based authentication\u003C\u002Fp\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cp\u003ESecurity for your apps and users\u003C\u002Fp\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cp\u003EEasy integration with our App\u003C\u002Fp\u003E\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Ch2\u003E\n  \u003Ca name=\"what-to-build-\" href=\"#what-to-build-\" class=\"anchor\"\u003E\n  \u003C\u002Fa\u003E\n  What to Build ?\n\u003C\u002Fh2\u003E\n\n\u003Cp\u003EIn this Blog we quickly build an authentication system for a simple REST API using AWS Amplify CLI.\u003C\u002Fp\u003E\n\n\u003Cp\u003EWe will build\u003C\u002Fp\u003E\n\n\u003Cul\u003E\n\u003Cli\u003EAn authenticated ExpressJS server that returns a random number\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Ch2\u003E\n  \u003Ca name=\"prerequisites\" href=\"#prerequisites\" class=\"anchor\"\u003E\n  \u003C\u002Fa\u003E\n  Pre-requisites\n\u003C\u002Fh2\u003E\n\n\u003Cul\u003E\n\u003Cli\u003E\u003Cp\u003EAmplify CLI — Open terminal and run npm install -g @aws-amplify\u002Fclito update to the latest Amplify CLI.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cp\u003EAmplify CLI configured — If you have not configured the Amplify CLI yet, follow \u003Ca href=\"https:\u002F\u002Fdocs.amplify.aws\u002Fcli\u002Fstart\u002Finstall#configure-the-amplify-cli\"\u003Ethis guide\u003C\u002Fa\u003E in the documentation.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Ch2\u003E\n  \u003Ca name=\"setup-a-new-amplify-project\" href=\"#setup-a-new-amplify-project\" class=\"anchor\"\u003E\n  \u003C\u002Fa\u003E\n  Setup a new Amplify project\n\u003C\u002Fh2\u003E\n\n\u003Cul\u003E\n\u003Cli\u003ERun the following command to create a new Amplify project called “amplify-rest-containerized” or if you already have an existing Amplify project skip to the next section.\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight plaintext\"\u003E\u003Ccode\u003Emkdir amplify-rest-containerized\ncd amplify-rest-containerized\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" viewbox=\"0 0 448 512\" class=\"highlight-action highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath fill=\"#fff\" d=\"M0 180V56c0-13.3 10.7-24 24-24h124c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H64v84c0 6.6-5.4 12-12 12H12c-6.6 0-12-5.4-12-12zM288 44v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12V56c0-13.3-10.7-24-24-24H300c-6.6 0-12 5.4-12 12zm148 276h-40c-6.6 0-12 5.4-12 12v84h-84c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24V332c0-6.6-5.4-12-12-12zM160 468v-40c0-6.6-5.4-12-12-12H64v-84c0-6.6-5.4-12-12-12H12c-6.6 0-12 5.4-12 12v124c0 13.3 10.7 24 24 24h124c6.6 0 12-5.4 12-12z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" viewbox=\"0 0 448 512\" class=\"highlight-action highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath fill=\"#fff\" d=\"M436 192H312c-13.3 0-24-10.7-24-24V44c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v84h84c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm-276-24V44c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v84H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24zm0 300V344c0-13.3-10.7-24-24-24H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-84h84c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12H312c-13.3 0-24 10.7-24 24v124c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cul\u003E\n\u003Cli\u003EInitialize an Amplify project by running:\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight plaintext\"\u003E\u003Ccode\u003E    amplify init\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" viewbox=\"0 0 448 512\" class=\"highlight-action highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath fill=\"#fff\" d=\"M0 180V56c0-13.3 10.7-24 24-24h124c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H64v84c0 6.6-5.4 12-12 12H12c-6.6 0-12-5.4-12-12zM288 44v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12V56c0-13.3-10.7-24-24-24H300c-6.6 0-12 5.4-12 12zm148 276h-40c-6.6 0-12 5.4-12 12v84h-84c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24V332c0-6.6-5.4-12-12-12zM160 468v-40c0-6.6-5.4-12-12-12H64v-84c0-6.6-5.4-12-12-12H12c-6.6 0-12 5.4-12 12v124c0 13.3 10.7 24 24 24h124c6.6 0 12-5.4 12-12z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" viewbox=\"0 0 448 512\" class=\"highlight-action highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath fill=\"#fff\" d=\"M436 192H312c-13.3 0-24-10.7-24-24V44c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v84h84c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm-276-24V44c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v84H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24zm0 300V344c0-13.3-10.7-24-24-24H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-84h84c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12H312c-13.3 0-24 10.7-24 24v124c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003EFor a quick implementation, we can just accept the default values in the amplify init workflow console.\u003C\u002Fp\u003E\n\n\u003Ch2\u003E\n  \u003Ca name=\"enable-container-based-deployments\" href=\"#enable-container-based-deployments\" class=\"anchor\"\u003E\n  \u003C\u002Fa\u003E\n  Enable container based deployments\n\u003C\u002Fh2\u003E\n\n\u003Cul\u003E\n\u003Cli\u003EContainer-based deployments need to be explicitly enabled. Run \u003Cstrong\u003Eamplify configure project\u003C\u002Fstrong\u003E to review your project configuration:\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight plaintext\"\u003E\u003Ccode\u003E    amplify configure project\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" viewbox=\"0 0 448 512\" class=\"highlight-action highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath fill=\"#fff\" d=\"M0 180V56c0-13.3 10.7-24 24-24h124c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H64v84c0 6.6-5.4 12-12 12H12c-6.6 0-12-5.4-12-12zM288 44v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12V56c0-13.3-10.7-24-24-24H300c-6.6 0-12 5.4-12 12zm148 276h-40c-6.6 0-12 5.4-12 12v84h-84c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24V332c0-6.6-5.4-12-12-12zM160 468v-40c0-6.6-5.4-12-12-12H64v-84c0-6.6-5.4-12-12-12H12c-6.6 0-12 5.4-12 12v124c0 13.3 10.7 24 24 24h124c6.6 0 12-5.4 12-12z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" viewbox=\"0 0 448 512\" class=\"highlight-action highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath fill=\"#fff\" d=\"M436 192H312c-13.3 0-24-10.7-24-24V44c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v84h84c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm-276-24V44c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v84H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24zm0 300V344c0-13.3-10.7-24-24-24H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-84h84c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12H312c-13.3 0-24 10.7-24 24v124c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cul\u003E\n\u003Cli\u003EAccept the defaults and answer \u003Cstrong\u003EYes\u003C\u002Fstrong\u003E when asked if you want to enable container-based deployments:\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight plaintext\"\u003E\u003Ccode\u003E    ...\n    ? Do you want to enable container-based deployments? Yes\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" viewbox=\"0 0 448 512\" class=\"highlight-action highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath fill=\"#fff\" d=\"M0 180V56c0-13.3 10.7-24 24-24h124c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H64v84c0 6.6-5.4 12-12 12H12c-6.6 0-12-5.4-12-12zM288 44v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12V56c0-13.3-10.7-24-24-24H300c-6.6 0-12 5.4-12 12zm148 276h-40c-6.6 0-12 5.4-12 12v84h-84c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24V332c0-6.6-5.4-12-12-12zM160 468v-40c0-6.6-5.4-12-12-12H64v-84c0-6.6-5.4-12-12-12H12c-6.6 0-12 5.4-12 12v124c0 13.3 10.7 24 24 24h124c6.6 0 12-5.4 12-12z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" viewbox=\"0 0 448 512\" class=\"highlight-action highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath fill=\"#fff\" d=\"M436 192H312c-13.3 0-24-10.7-24-24V44c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v84h84c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm-276-24V44c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v84H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24zm0 300V344c0-13.3-10.7-24-24-24H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-84h84c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12H312c-13.3 0-24 10.7-24 24v124c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Ch2\u003E\n  \u003Ca name=\"add-an-authenticated-containerbased-expressjs-api\" href=\"#add-an-authenticated-containerbased-expressjs-api\" class=\"anchor\"\u003E\n  \u003C\u002Fa\u003E\n  Add an authenticated container-based ExpressJS API\n\u003C\u002Fh2\u003E\n\n\u003Cp\u003EFor the demo, let’s quickly create a REST API. More detailed explanation can be found \u003Ca href=\"https:\u002F\u002Fcloudychetan.medium.com\u002Fusing-amplify-for-rest-apis-and-web-hosting-f27ad2867908\"\u003Ehere\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\n\u003Cul\u003E\n\u003Cli\u003ETo create our authenticated container-based REST API, execute:\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight plaintext\"\u003E\u003Ccode\u003E    amplify add api\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" viewbox=\"0 0 448 512\" class=\"highlight-action highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath fill=\"#fff\" d=\"M0 180V56c0-13.3 10.7-24 24-24h124c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H64v84c0 6.6-5.4 12-12 12H12c-6.6 0-12-5.4-12-12zM288 44v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12V56c0-13.3-10.7-24-24-24H300c-6.6 0-12 5.4-12 12zm148 276h-40c-6.6 0-12 5.4-12 12v84h-84c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24V332c0-6.6-5.4-12-12-12zM160 468v-40c0-6.6-5.4-12-12-12H64v-84c0-6.6-5.4-12-12-12H12c-6.6 0-12 5.4-12 12v124c0 13.3 10.7 24 24 24h124c6.6 0 12-5.4 12-12z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" viewbox=\"0 0 448 512\" class=\"highlight-action highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath fill=\"#fff\" d=\"M436 192H312c-13.3 0-24-10.7-24-24V44c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v84h84c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm-276-24V44c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v84H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24zm0 300V344c0-13.3-10.7-24-24-24H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-84h84c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12H312c-13.3 0-24 10.7-24 24v124c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cul\u003E\n\u003Cli\u003EChoose the following options:\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight plaintext\"\u003E\u003Ccode\u003E? Please select from one of the below mentioned services: REST\n    ? Which service would you like to use API Gateway + AWS Fargate (Container-based)\n    ? Provide a friendly name for your resource to be used as a label for this category in the project: container622e561f\n    ? What image would you like to use ExpressJS - REST template\n    ? When do you want to build &amp; deploy the Fargate task On every \"amplify push\" (Fully managed container source)\n    ? Do you want to restrict API access Yes\n    Successfully added auth resource locally.\n    Successfully added resource container622e561f locally.\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" viewbox=\"0 0 448 512\" class=\"highlight-action highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath fill=\"#fff\" d=\"M0 180V56c0-13.3 10.7-24 24-24h124c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H64v84c0 6.6-5.4 12-12 12H12c-6.6 0-12-5.4-12-12zM288 44v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12V56c0-13.3-10.7-24-24-24H300c-6.6 0-12 5.4-12 12zm148 276h-40c-6.6 0-12 5.4-12 12v84h-84c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24V332c0-6.6-5.4-12-12-12zM160 468v-40c0-6.6-5.4-12-12-12H64v-84c0-6.6-5.4-12-12-12H12c-6.6 0-12 5.4-12 12v124c0 13.3 10.7 24 24 24h124c6.6 0 12-5.4 12-12z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" viewbox=\"0 0 448 512\" class=\"highlight-action highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath fill=\"#fff\" d=\"M436 192H312c-13.3 0-24-10.7-24-24V44c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v84h84c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm-276-24V44c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v84H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24zm0 300V344c0-13.3-10.7-24-24-24H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-84h84c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12H312c-13.3 0-24 10.7-24 24v124c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cul\u003E\n\u003Cli\u003EAfter a successful completion of the CLI workflow, we’ll see these new files added to the project folder structure.\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight plaintext\"\u003E\u003Ccode\u003E    amplify\u002Fbackend\u002Fapi\u002F&lt;your-api-name&gt;\n    ├── amplify.state\n    ├── containerb5734e35-cloudformation-template.json\n    ├── parameters.json\n    └── src\n        ├── Dockerfile\n        ├── DynamoDBActions.js\n        ├── buildspec.yml\n        ├── index.js\n        ├── package-lock.json\n        └── package.json\n\n    amplify\u002Fbackend\u002Fauth\u002F&lt;your-api-name&gt;\n    ├── cognitod17bb34c-cloudformation-template.yml\n    └── parameters.json\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" viewbox=\"0 0 448 512\" class=\"highlight-action highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath fill=\"#fff\" d=\"M0 180V56c0-13.3 10.7-24 24-24h124c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H64v84c0 6.6-5.4 12-12 12H12c-6.6 0-12-5.4-12-12zM288 44v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12V56c0-13.3-10.7-24-24-24H300c-6.6 0-12 5.4-12 12zm148 276h-40c-6.6 0-12 5.4-12 12v84h-84c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24V332c0-6.6-5.4-12-12-12zM160 468v-40c0-6.6-5.4-12-12-12H64v-84c0-6.6-5.4-12-12-12H12c-6.6 0-12 5.4-12 12v124c0 13.3 10.7 24 24 24h124c6.6 0 12-5.4 12-12z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" viewbox=\"0 0 448 512\" class=\"highlight-action highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath fill=\"#fff\" d=\"M436 192H312c-13.3 0-24-10.7-24-24V44c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v84h84c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm-276-24V44c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v84H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24zm0 300V344c0-13.3-10.7-24-24-24H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-84h84c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12H312c-13.3 0-24 10.7-24 24v124c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cul\u003E\n\u003Cli\u003E\u003Cp\u003EIn the \u003Cstrong\u003Esrc\u002Findex.js\u003C\u002Fstrong\u003E we will find a starter ExpressJS source code to interact with DynamoDB.\u003Cbr\u003E\nLet’s edit that to return a random number.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cp\u003EReplace the \u003Cstrong\u003Eindex.js\u003C\u002Fstrong\u003E file with the following code:\u003Cbr\u003E\n\u003C\u002Fp\u003E\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight plaintext\"\u003E\u003Ccode\u003E    const express = require(\"express\");\n    const bodyParser = require('body-parser');\n    const port = process.env.PORT || 3001;const app = express();\n    app.use(bodyParser.json());\n    app.use(bodyParser.urlencoded({ extended: true }));\u002F\u002F Enable CORS for all methods\n    app.use(function (req, res, next) {\n        res.header(\"Access-Control-Allow-Origin\", \"*\")\n        res.header(\"Access-Control-Allow-Headers\", \"Origin, X-Requested-With, Content-Type, Accept\")\n        next()\n    });app.get(\"\u002F\", async (req, res, next) =&gt; {    try {\n            res.contentType(\"application\u002Fjson\").send({ \n                \"randomNumber\": Math.floor(Math.random() * 101) \n            })\n        } catch (err) {\n            next(err);\n        }\n    });app.listen(port, () =&gt; {\n        console.log('Example app listening at [http:\u002F\u002Flocalhost:'](http:\u002F\u002Flocalhost:') + port);\n    });\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" viewbox=\"0 0 448 512\" class=\"highlight-action highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath fill=\"#fff\" d=\"M0 180V56c0-13.3 10.7-24 24-24h124c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H64v84c0 6.6-5.4 12-12 12H12c-6.6 0-12-5.4-12-12zM288 44v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12V56c0-13.3-10.7-24-24-24H300c-6.6 0-12 5.4-12 12zm148 276h-40c-6.6 0-12 5.4-12 12v84h-84c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24V332c0-6.6-5.4-12-12-12zM160 468v-40c0-6.6-5.4-12-12-12H64v-84c0-6.6-5.4-12-12-12H12c-6.6 0-12 5.4-12 12v124c0 13.3 10.7 24 24 24h124c6.6 0 12-5.4 12-12z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" viewbox=\"0 0 448 512\" class=\"highlight-action highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath fill=\"#fff\" d=\"M436 192H312c-13.3 0-24-10.7-24-24V44c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v84h84c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm-276-24V44c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v84H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24zm0 300V344c0-13.3-10.7-24-24-24H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-84h84c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12H312c-13.3 0-24 10.7-24 24v124c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Ch2\u003E\n  \u003Ca name=\"deploy\" href=\"#deploy\" class=\"anchor\"\u003E\n  \u003C\u002Fa\u003E\n  Deploy\n\u003C\u002Fh2\u003E\n\n\u003Cul\u003E\n\u003Cli\u003ENow let’s deploy our API:\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight plaintext\"\u003E\u003Ccode\u003E    amplify push\n    ✔ Successfully pulled backend environment dev from the cloud.\n\n    Current Environment: dev\n\n    | Category | Resource name     | Operation | Provider plugin   |\n    | -------- | ----------------- | --------- | ----------------- |\n    | Auth     | cognitod17bb34c   | Create    | awscloudformation |\n    | Api      | container622e561f | Create    | awscloudformation |\n    ? Are you sure you want to continue? Yes\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" viewbox=\"0 0 448 512\" class=\"highlight-action highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath fill=\"#fff\" d=\"M0 180V56c0-13.3 10.7-24 24-24h124c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H64v84c0 6.6-5.4 12-12 12H12c-6.6 0-12-5.4-12-12zM288 44v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12V56c0-13.3-10.7-24-24-24H300c-6.6 0-12 5.4-12 12zm148 276h-40c-6.6 0-12 5.4-12 12v84h-84c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24V332c0-6.6-5.4-12-12-12zM160 468v-40c0-6.6-5.4-12-12-12H64v-84c0-6.6-5.4-12-12-12H12c-6.6 0-12 5.4-12 12v124c0 13.3 10.7 24 24 24h124c6.6 0 12-5.4 12-12z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" viewbox=\"0 0 448 512\" class=\"highlight-action highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath fill=\"#fff\" d=\"M436 192H312c-13.3 0-24-10.7-24-24V44c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v84h84c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm-276-24V44c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v84H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24zm0 300V344c0-13.3-10.7-24-24-24H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-84h84c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12H312c-13.3 0-24 10.7-24 24v124c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cul\u003E\n\u003Cli\u003EAs we see amplify also deploys authentication related resources.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Ch2\u003E\n  \u003Ca name=\"whats-happening-under-the-hood-\" href=\"#whats-happening-under-the-hood-\" class=\"anchor\"\u003E\n  \u003C\u002Fa\u003E\n  What’s happening under the hood ?\n\u003C\u002Fh2\u003E\n\n\u003Cul\u003E\n\u003Cli\u003E\u003Cp\u003EWe are deploying an API just like the \u003Ca href=\"https:\u002F\u002Fcloudychetan.medium.com\u002Fusing-amplify-for-rest-apis-and-web-hosting-f27ad2867908\"\u003Efirst blog\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cp\u003EAdding authentication related resources like AWS Cognito User Pool, Identity Pool, User Pool Client, Client Role, Authorizer Lambda function\u003C\u002Fp\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cp\u003EAmplify uses a \u003Ca href=\"https:\u002F\u002Fdocs.aws.amazon.com\u002FAWSCloudFormation\u002Flatest\u002FUserGuide\u002Fusing-cfn-nested-stacks.html\"\u003ENested CloudFormation Stack\u003C\u002Fa\u003E to deploy each component from the App. In this example, it would deploy a network stack, a cognito resources stack and a containerized API stack.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Ch2\u003E\n  \u003Ca name=\"test-our-containerized-and-authenticated-expressjs-api\" href=\"#test-our-containerized-and-authenticated-expressjs-api\" class=\"anchor\"\u003E\n  \u003C\u002Fa\u003E\n  Test our containerized and authenticated ExpressJS API\n\u003C\u002Fh2\u003E\n\n\u003Cp\u003EThis is where we come to the tricky part.\u003C\u002Fp\u003E\n\n\u003Cp\u003EThere are several ways in which we can interact with AWS Cognito APIs to get the necessary authentication token for getting access to the API.\u003C\u002Fp\u003E\n\n\u003Cul\u003E\n\u003Cli\u003E\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fdocs.amplify.aws\u002Flib\u002Fauth\u002Fgetting-started\u002Fq\u002Fplatform\u002Fjs#create-authentication-service\"\u003E\u003Cstrong\u003EAWS SDK for JavaScript\u003C\u002Fstrong\u003E\u003C\u002Fa\u003E to include components in your code to obtain token using pre-built UI components in React.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cp\u003E\u003Cstrong\u003EAWS CLI\u003C\u002Fstrong\u003E commands to perform sign-up for a user, confirm the user registration and request for generating a token for authentication.\u003C\u002Fp\u003E\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cp\u003EFor quick testing, we would use the \u003Cstrong\u003EAWS CLI\u003C\u002Fstrong\u003E generated token for authenticating our request to the API.\u003C\u002Fp\u003E\n\n\u003Ch3\u003E\n  \u003Ca name=\"prerequisites-to-generate-token\" href=\"#prerequisites-to-generate-token\" class=\"anchor\"\u003E\n  \u003C\u002Fa\u003E\n  Pre-requisites to generate Token\n\u003C\u002Fh3\u003E\n\n\u003Cp\u003EYou would need the following information before you start the process\u003C\u002Fp\u003E\n\n\u003Cul\u003E\n\u003Cli\u003E\u003Cp\u003EThe \u003Cstrong\u003EAppClient-ID\u003C\u002Fstrong\u003E for the AWS Cognito User Pool — This can be obtained from AWS Console for AWS Cognito or from the CloudFormation Stack Resources Details Tab\u003C\u002Fp\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cp\u003EThe \u003Cstrong\u003EUserPool-ID\u003C\u002Fstrong\u003E for the AWS Cognito User Pool — This can be obtained from AWS Console for AWS Cognito or from the CloudFormation Stack Resources Details Tab\u003C\u002Fp\u003E\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Ch3\u003E\n  \u003Ca name=\"how-to-generate-the-token-\" href=\"#how-to-generate-the-token-\" class=\"anchor\"\u003E\n  \u003C\u002Fa\u003E\n  How to generate the token ?\n\u003C\u002Fh3\u003E\n\n\u003Cul\u003E\n\u003Cli\u003ECreate a Sign-up request for the required User\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight plaintext\"\u003E\u003Ccode\u003E    aws cognito-idp sign-up --region &lt;region&gt; --client-id &lt;client_id&gt; --username xyz.abc --password xxxx --user-\n    attributes Name=\"email\",Value=\"xyz.abc@efg.com\"\n\n    Response :\n    {\n        \"UserConfirmed\": false,\n        \"CodeDeliveryDetails\": {\n            \"Destination\": \"xxx@xxx.com\",\n            \"DeliveryMedium\": \"EMAIL\",\n            \"AttributeName\": \"email\"\n        },\n        \"UserSub\": \"0bf218e6-65ab-4160-8ae9-48bb4e9f22cd\"\n    }\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" viewbox=\"0 0 448 512\" class=\"highlight-action highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath fill=\"#fff\" d=\"M0 180V56c0-13.3 10.7-24 24-24h124c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H64v84c0 6.6-5.4 12-12 12H12c-6.6 0-12-5.4-12-12zM288 44v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12V56c0-13.3-10.7-24-24-24H300c-6.6 0-12 5.4-12 12zm148 276h-40c-6.6 0-12 5.4-12 12v84h-84c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24V332c0-6.6-5.4-12-12-12zM160 468v-40c0-6.6-5.4-12-12-12H64v-84c0-6.6-5.4-12-12-12H12c-6.6 0-12 5.4-12 12v124c0 13.3 10.7 24 24 24h124c6.6 0 12-5.4 12-12z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" viewbox=\"0 0 448 512\" class=\"highlight-action highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath fill=\"#fff\" d=\"M436 192H312c-13.3 0-24-10.7-24-24V44c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v84h84c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm-276-24V44c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v84H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24zm0 300V344c0-13.3-10.7-24-24-24H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-84h84c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12H312c-13.3 0-24 10.7-24 24v124c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cul\u003E\n\u003Cli\u003EConfirm the registration of the User\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight plaintext\"\u003E\u003Ccode\u003E    aws cognito-idp admin-confirm-sign-up --region &lt;region&gt; --user-pool-id &lt;user_pool_id&gt; --username xyz.abc\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" viewbox=\"0 0 448 512\" class=\"highlight-action highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath fill=\"#fff\" d=\"M0 180V56c0-13.3 10.7-24 24-24h124c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H64v84c0 6.6-5.4 12-12 12H12c-6.6 0-12-5.4-12-12zM288 44v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12V56c0-13.3-10.7-24-24-24H300c-6.6 0-12 5.4-12 12zm148 276h-40c-6.6 0-12 5.4-12 12v84h-84c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24V332c0-6.6-5.4-12-12-12zM160 468v-40c0-6.6-5.4-12-12-12H64v-84c0-6.6-5.4-12-12-12H12c-6.6 0-12 5.4-12 12v124c0 13.3 10.7 24 24 24h124c6.6 0 12-5.4 12-12z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" viewbox=\"0 0 448 512\" class=\"highlight-action highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath fill=\"#fff\" d=\"M436 192H312c-13.3 0-24-10.7-24-24V44c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v84h84c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm-276-24V44c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v84H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24zm0 300V344c0-13.3-10.7-24-24-24H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-84h84c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12H312c-13.3 0-24 10.7-24 24v124c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cul\u003E\n\u003Cli\u003EThe password set for the new user in Step 1 is temporary and it needs to be changed before generating the authentication request\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight plaintext\"\u003E\u003Ccode\u003E    aws cognito-idp initiate-auth \\\n            --client-id &lt;client_id&gt; \\\n            --auth-flow USER_PASSWORD_AUTH \\\n            --auth-parameters \"USERNAME=xyz.abc,PASSWORD=xxxxxxxx\"\n\n    Response:\n\n    {\n        \"ChallengeName\": 'NEW_PASSWORD_REQUIRED',\n        'ClientId' =&gt; '&lt;client_id&gt;',\n        'Session' =&gt; &lt;session_token&gt;,\n    }\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" viewbox=\"0 0 448 512\" class=\"highlight-action highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath fill=\"#fff\" d=\"M0 180V56c0-13.3 10.7-24 24-24h124c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H64v84c0 6.6-5.4 12-12 12H12c-6.6 0-12-5.4-12-12zM288 44v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12V56c0-13.3-10.7-24-24-24H300c-6.6 0-12 5.4-12 12zm148 276h-40c-6.6 0-12 5.4-12 12v84h-84c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24V332c0-6.6-5.4-12-12-12zM160 468v-40c0-6.6-5.4-12-12-12H64v-84c0-6.6-5.4-12-12-12H12c-6.6 0-12 5.4-12 12v124c0 13.3 10.7 24 24 24h124c6.6 0 12-5.4 12-12z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" viewbox=\"0 0 448 512\" class=\"highlight-action highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath fill=\"#fff\" d=\"M436 192H312c-13.3 0-24-10.7-24-24V44c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v84h84c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm-276-24V44c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v84H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24zm0 300V344c0-13.3-10.7-24-24-24H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-84h84c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12H312c-13.3 0-24 10.7-24 24v124c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cul\u003E\n\u003Cli\u003EUse the \u003Cstrong\u003Esession_token\u003C\u002Fstrong\u003E from the above response to set the new password\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight plaintext\"\u003E\u003Ccode\u003E    aws cognito-idp respond-to-auth-challenge --client-id &lt;client_id&gt; --challenge-name NEW_PASSWORD_REQUIRED --challenge-responses USERNAME=xyz.abc,NEW_PASSWORD=\"xxxxxxxx\" --session \"&lt;session_token&gt;\"\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" viewbox=\"0 0 448 512\" class=\"highlight-action highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath fill=\"#fff\" d=\"M0 180V56c0-13.3 10.7-24 24-24h124c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H64v84c0 6.6-5.4 12-12 12H12c-6.6 0-12-5.4-12-12zM288 44v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12V56c0-13.3-10.7-24-24-24H300c-6.6 0-12 5.4-12 12zm148 276h-40c-6.6 0-12 5.4-12 12v84h-84c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24V332c0-6.6-5.4-12-12-12zM160 468v-40c0-6.6-5.4-12-12-12H64v-84c0-6.6-5.4-12-12-12H12c-6.6 0-12 5.4-12 12v124c0 13.3 10.7 24 24 24h124c6.6 0 12-5.4 12-12z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" viewbox=\"0 0 448 512\" class=\"highlight-action highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath fill=\"#fff\" d=\"M436 192H312c-13.3 0-24-10.7-24-24V44c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v84h84c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm-276-24V44c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v84H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24zm0 300V344c0-13.3-10.7-24-24-24H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-84h84c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12H312c-13.3 0-24 10.7-24 24v124c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cul\u003E\n\u003Cli\u003EThe above request responds with the Tokens generated after successful authentication with AWS Cognito\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight plaintext\"\u003E\u003Ccode\u003E    {\n        \"ChallengeParameters\": {},\n        \"AuthenticationResult\": {\n            \"AccessToken\": \"xxxxxxxxxxxxxxxxxxx\",\n            \"ExpiresIn\": 3600,\n            \"TokenType\": \"Bearer\",\n            \"RefreshToken\": \"xxxxxxxxxxxxxxxxxxx\",\n            \"IdToken\": \"xxxxxxxxxxxxxxxxxxx\"\n        }\n    }\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" viewbox=\"0 0 448 512\" class=\"highlight-action highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath fill=\"#fff\" d=\"M0 180V56c0-13.3 10.7-24 24-24h124c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H64v84c0 6.6-5.4 12-12 12H12c-6.6 0-12-5.4-12-12zM288 44v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12V56c0-13.3-10.7-24-24-24H300c-6.6 0-12 5.4-12 12zm148 276h-40c-6.6 0-12 5.4-12 12v84h-84c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24V332c0-6.6-5.4-12-12-12zM160 468v-40c0-6.6-5.4-12-12-12H64v-84c0-6.6-5.4-12-12-12H12c-6.6 0-12 5.4-12 12v124c0 13.3 10.7 24 24 24h124c6.6 0 12-5.4 12-12z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" viewbox=\"0 0 448 512\" class=\"highlight-action highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath fill=\"#fff\" d=\"M436 192H312c-13.3 0-24-10.7-24-24V44c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v84h84c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm-276-24V44c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v84H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24zm0 300V344c0-13.3-10.7-24-24-24H12c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-84h84c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12H312c-13.3 0-24 10.7-24 24v124c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cul\u003E\n\u003Cli\u003EFinally we can use the \u003Cstrong\u003EAccessToken\u003C\u002Fstrong\u003E to test our API\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Ch3\u003E\n  \u003Ca name=\"testing-the-api\" href=\"#testing-the-api\" class=\"anchor\"\u003E\n  \u003C\u002Fa\u003E\n  Testing the API\n\u003C\u002Fh3\u003E\n\n\u003Cp\u003EThe best way to demonstrate the authenticated API is from the Postman App using Authentication.\u003C\u002Fp\u003E\n\n\u003Cul\u003E\n\u003Cli\u003ESetup authentication parameters in Postman App — Enter the AccessToken in the Token section.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--RiwXbKI---\u002Fc_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\u002Fhttps:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F5128\u002F1%2Arpl7-n0RCiZsSCEX27XS8g.png\" class=\"article-body-image-wrapper\"\u003E\u003Cimg src=\"https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--RiwXbKI---\u002Fc_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\u002Fhttps:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F5128\u002F1%2Arpl7-n0RCiZsSCEX27XS8g.png\" alt=\"\" loading=\"lazy\"\u003E\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\n\u003Cul\u003E\n\u003Cli\u003EExecute the request to the API\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--LHKAyy2---\u002Fc_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\u002Fhttps:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F5128\u002F1%2AmnzHgZY_oD7UPvQsAaQmbA.png\" class=\"article-body-image-wrapper\"\u003E\u003Cimg src=\"https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--LHKAyy2---\u002Fc_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\u002Fhttps:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F5128\u002F1%2AmnzHgZY_oD7UPvQsAaQmbA.png\" alt=\"\" loading=\"lazy\"\u003E\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\n\u003Cp\u003EThe API endpoint is printed at the end of the “\u003Cstrong\u003Eamplify push\u003C\u002Fstrong\u003E” command or when you execute “\u003Cstrong\u003Eamplify status\u003C\u002Fstrong\u003E”.\u003C\u002Fp\u003E\n\n\u003Cp\u003E\u003Cstrong\u003ENote\u003C\u002Fstrong\u003E: This is a simple use case just to showcase the workflow. \u003Cbr\u003E\nWe used the AWS CLI to quickly demonstrate the authentication flow. However, actual authentication for your app should be done seamlessly using the appropriate AWS SDK for your code.\u003Cbr\u003E\nReview Amplify documentation if you’re interested in any other scenario.\u003C\u002Fp\u003E\n\n\u003Ch2\u003E\n  \u003Ca name=\"what-did-we-learn-\" href=\"#what-did-we-learn-\" class=\"anchor\"\u003E\n  \u003C\u002Fa\u003E\n  What did we learn ?\n\u003C\u002Fh2\u003E\n\n\u003Cp\u003EThis blog post gives a quick way to deploy an authenticated API using Amplify CLI.\u003C\u002Fp\u003E\n\n\u003Cul\u003E\n\u003Cli\u003E\u003Cp\u003EQuickly setup and authenticated API using AWS Amplify\u003C\u002Fp\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cp\u003EHow to authenticate the requests to the authenticated API using AWS CLI\u003C\u002Fp\u003E\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cp\u003EThere is so much more to explore.\u003C\u002Fp\u003E\n\n\u003Cp\u003EKeep building…\u003C\u002Fp\u003E\n\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fepilot.cloud\u002Fen\u002Fcareer-engineering\u002F\"\u003E\u003Cimg src=\"https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--dSwHqH7P--\u002Fc_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\u002Fhttps:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fi\u002Ffnbppwjezekl7t56nfxz.png\" alt=\"We are hiring!\" loading=\"lazy\"\u003E\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\n",body_markdown:"# Securing APIs with AWS Amplify and Cognito\n\n[![We are hiring!](https:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fi\u002Ffnbppwjezekl7t56nfxz.png)](https:\u002F\u002Fepilot.cloud\u002Fen\u002Fcareer-engineering\u002F)\n\n## Overview\n\nAWS Amplify is one of the fastest ways to help front-end web and mobile developers build full stack applications, hosted in AWS.\n\nIn the [first part](https:\u002F\u002Fcloudychetan.medium.com\u002Fusing-amplify-for-rest-apis-and-web-hosting-f27ad2867908) of this blog series, [Using Amplify for REST APIs and Web hosting](https:\u002F\u002Fcloudychetan.medium.com\u002Fusing-amplify-for-rest-apis-and-web-hosting-f27ad2867908) we built an API using AWS Amplify to quickly setup and host an API with minimal coding.\n\nIn this part we build an authentication system for the API using [Amazon Cognito](https:\u002F\u002Faws.amazon.com\u002Fcognito\u002F).\n\nAmazon Cognito lets us add user sign-up, sign-in, and access control to our web and mobile apps quickly and easily. It is highly scaleable and supports sign-in with social identity providers, such as Facebook, Google, and Amazon, and enterprise identity providers via SAML 2.0.\n\n## Advantages\n\n* Secure and scalable user directory\n\n* Standards-based authentication\n\n* Security for your apps and users\n\n* Easy integration with our App\n\n\n## What to Build ?\n\nIn this Blog we quickly build an authentication system for a simple REST API using AWS Amplify CLI.\n\nWe will build\n\n* An authenticated ExpressJS server that returns a random number\n\n## Pre-requisites\n\n* Amplify CLI — Open terminal and run npm install -g @aws-amplify\u002Fclito update to the latest Amplify CLI.\n\n* Amplify CLI configured — If you have not configured the Amplify CLI yet, follow [this guide](https:\u002F\u002Fdocs.amplify.aws\u002Fcli\u002Fstart\u002Finstall#configure-the-amplify-cli) in the documentation.\n\n## Setup a new Amplify project\n\n* Run the following command to create a new Amplify project called “amplify-rest-containerized” or if you already have an existing Amplify project skip to the next section.\n\n```    \nmkdir amplify-rest-containerized\ncd amplify-rest-containerized\n```\n\n* Initialize an Amplify project by running:\n\n```\n    amplify init\n```\n\nFor a quick implementation, we can just accept the default values in the amplify init workflow console.\n\n## Enable container based deployments\n\n* Container-based deployments need to be explicitly enabled. Run **amplify configure project** to review your project configuration:\n\n```\n    amplify configure project\n```\n\n* Accept the defaults and answer **Yes** when asked if you want to enable container-based deployments:\n\n```\n    ...\n    ? Do you want to enable container-based deployments? Yes\n```\n\n## Add an authenticated container-based ExpressJS API\n\nFor the demo, let’s quickly create a REST API. More detailed explanation can be found [here](https:\u002F\u002Fcloudychetan.medium.com\u002Fusing-amplify-for-rest-apis-and-web-hosting-f27ad2867908)\n\n* To create our authenticated container-based REST API, execute:\n\n```\n    amplify add api\n```\n\n* Choose the following options:\n\n```\n? Please select from one of the below mentioned services: REST\n    ? Which service would you like to use API Gateway + AWS Fargate (Container-based)\n    ? Provide a friendly name for your resource to be used as a label for this category in the project: container622e561f\n    ? What image would you like to use ExpressJS - REST template\n    ? When do you want to build & deploy the Fargate task On every \"amplify push\" (Fully managed container source)\n    ? Do you want to restrict API access Yes\n    Successfully added auth resource locally.\n    Successfully added resource container622e561f locally.\n```\n\n* After a successful completion of the CLI workflow, we’ll see these new files added to the project folder structure.\n\n```\n    amplify\u002Fbackend\u002Fapi\u002F\u003Cyour-api-name\u003E\n    ├── amplify.state\n    ├── containerb5734e35-cloudformation-template.json\n    ├── parameters.json\n    └── src\n        ├── Dockerfile\n        ├── DynamoDBActions.js\n        ├── buildspec.yml\n        ├── index.js\n        ├── package-lock.json\n        └── package.json\n\n    amplify\u002Fbackend\u002Fauth\u002F\u003Cyour-api-name\u003E\n    ├── cognitod17bb34c-cloudformation-template.yml\n    └── parameters.json\n```\n\n* In the **src\u002Findex.js** we will find a starter ExpressJS source code to interact with DynamoDB.\nLet’s edit that to return a random number.\n\n* Replace the **index.js** file with the following code:\n\n```\n    const express = require(\"express\");\n    const bodyParser = require('body-parser');\n    const port = process.env.PORT || 3001;const app = express();\n    app.use(bodyParser.json());\n    app.use(bodyParser.urlencoded({ extended: true }));\u002F\u002F Enable CORS for all methods\n    app.use(function (req, res, next) {\n        res.header(\"Access-Control-Allow-Origin\", \"*\")\n        res.header(\"Access-Control-Allow-Headers\", \"Origin, X-Requested-With, Content-Type, Accept\")\n        next()\n    });app.get(\"\u002F\", async (req, res, next) =\u003E {    try {\n            res.contentType(\"application\u002Fjson\").send({ \n                \"randomNumber\": Math.floor(Math.random() * 101) \n            })\n        } catch (err) {\n            next(err);\n        }\n    });app.listen(port, () =\u003E {\n        console.log('Example app listening at [http:\u002F\u002Flocalhost:'](http:\u002F\u002Flocalhost:') + port);\n    });\n```\n\n## Deploy\n\n* Now let’s deploy our API:\n\n```\n    amplify push\n    ✔ Successfully pulled backend environment dev from the cloud.\n\n    Current Environment: dev\n\n    | Category | Resource name     | Operation | Provider plugin   |\n    | -------- | ----------------- | --------- | ----------------- |\n    | Auth     | cognitod17bb34c   | Create    | awscloudformation |\n    | Api      | container622e561f | Create    | awscloudformation |\n    ? Are you sure you want to continue? Yes\n```\n\n* As we see amplify also deploys authentication related resources.\n\n## What’s happening under the hood ?\n\n* We are deploying an API just like the [first blog](https:\u002F\u002Fcloudychetan.medium.com\u002Fusing-amplify-for-rest-apis-and-web-hosting-f27ad2867908)\n\n* Adding authentication related resources like AWS Cognito User Pool, Identity Pool, User Pool Client, Client Role, Authorizer Lambda function\n\n* Amplify uses a [Nested CloudFormation Stack](https:\u002F\u002Fdocs.aws.amazon.com\u002FAWSCloudFormation\u002Flatest\u002FUserGuide\u002Fusing-cfn-nested-stacks.html) to deploy each component from the App. In this example, it would deploy a network stack, a cognito resources stack and a containerized API stack.\n\n## Test our containerized and authenticated ExpressJS API\n\nThis is where we come to the tricky part.\n\nThere are several ways in which we can interact with AWS Cognito APIs to get the necessary authentication token for getting access to the API.\n\n* [**AWS SDK for JavaScript**](https:\u002F\u002Fdocs.amplify.aws\u002Flib\u002Fauth\u002Fgetting-started\u002Fq\u002Fplatform\u002Fjs#create-authentication-service) to include components in your code to obtain token using pre-built UI components in React.\n\n* **AWS CLI** commands to perform sign-up for a user, confirm the user registration and request for generating a token for authentication.\n\nFor quick testing, we would use the **AWS CLI** generated token for authenticating our request to the API.\n\n### Pre-requisites to generate Token\n\nYou would need the following information before you start the process\n\n* The **AppClient-ID** for the AWS Cognito User Pool — This can be obtained from AWS Console for AWS Cognito or from the CloudFormation Stack Resources Details Tab\n\n* The **UserPool-ID** for the AWS Cognito User Pool — This can be obtained from AWS Console for AWS Cognito or from the CloudFormation Stack Resources Details Tab\n\n### How to generate the token ?\n\n* Create a Sign-up request for the required User\n\n```\n    aws cognito-idp sign-up --region \u003Cregion\u003E --client-id \u003Cclient_id\u003E --username xyz.abc --password xxxx --user-\n    attributes Name=\"email\",Value=\"xyz.abc@efg.com\"\n\n    Response :\n    {\n        \"UserConfirmed\": false,\n        \"CodeDeliveryDetails\": {\n            \"Destination\": \"xxx@xxx.com\",\n            \"DeliveryMedium\": \"EMAIL\",\n            \"AttributeName\": \"email\"\n        },\n        \"UserSub\": \"0bf218e6-65ab-4160-8ae9-48bb4e9f22cd\"\n    }\n```\n\n* Confirm the registration of the User\n\n```\n    aws cognito-idp admin-confirm-sign-up --region \u003Cregion\u003E --user-pool-id \u003Cuser_pool_id\u003E --username xyz.abc\n```\n\n* The password set for the new user in Step 1 is temporary and it needs to be changed before generating the authentication request\n```\n    aws cognito-idp initiate-auth \\\n            --client-id \u003Cclient_id\u003E \\\n            --auth-flow USER_PASSWORD_AUTH \\\n            --auth-parameters \"USERNAME=xyz.abc,PASSWORD=xxxxxxxx\"\n\n    Response:\n    \n    {\n        \"ChallengeName\": 'NEW_PASSWORD_REQUIRED',\n        'ClientId' =\u003E '\u003Cclient_id\u003E',\n        'Session' =\u003E \u003Csession_token\u003E,\n    }\n```\n\n* Use the **session_token** from the above response to set the new password\n\n```\n    aws cognito-idp respond-to-auth-challenge --client-id \u003Cclient_id\u003E --challenge-name NEW_PASSWORD_REQUIRED --challenge-responses USERNAME=xyz.abc,NEW_PASSWORD=\"xxxxxxxx\" --session \"\u003Csession_token\u003E\"\n```\n\n* The above request responds with the Tokens generated after successful authentication with AWS Cognito\n\n```\n    {\n        \"ChallengeParameters\": {},\n        \"AuthenticationResult\": {\n            \"AccessToken\": \"xxxxxxxxxxxxxxxxxxx\",\n            \"ExpiresIn\": 3600,\n            \"TokenType\": \"Bearer\",\n            \"RefreshToken\": \"xxxxxxxxxxxxxxxxxxx\",\n            \"IdToken\": \"xxxxxxxxxxxxxxxxxxx\"\n        }\n    }\n```\n\n* Finally we can use the **AccessToken** to test our API\n\n### Testing the API\n\nThe best way to demonstrate the authenticated API is from the Postman App using Authentication.\n\n* Setup authentication parameters in Postman App — Enter the AccessToken in the Token section.\n\n![](https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F5128\u002F1*rpl7-n0RCiZsSCEX27XS8g.png)\n\n* Execute the request to the API\n\n![](https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F5128\u002F1*mnzHgZY_oD7UPvQsAaQmbA.png)\n\nThe API endpoint is printed at the end of the “**amplify push**” command or when you execute “**amplify status**”.\n\n**Note**: This is a simple use case just to showcase the workflow. \nWe used the AWS CLI to quickly demonstrate the authentication flow. However, actual authentication for your app should be done seamlessly using the appropriate AWS SDK for your code.\nReview Amplify documentation if you’re interested in any other scenario.\n\n## What did we learn ?\n\nThis blog post gives a quick way to deploy an authenticated API using Amplify CLI.\n\n* Quickly setup and authenticated API using AWS Amplify\n\n* How to authenticate the requests to the authenticated API using AWS CLI\n\nThere is so much more to explore.\n\nKeep building…\n\n[![We are hiring!](https:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fi\u002Ffnbppwjezekl7t56nfxz.png)](https:\u002F\u002Fepilot.cloud\u002Fen\u002Fcareer-engineering\u002F)",user:{name:"Chetan Pawar",username:e,twitter_username:"icrp08",github_username:e,website_url:a,profile_image:"https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--MHIFUzHx--\u002Fc_fill,f_auto,fl_progressive,h_640,q_auto,w_640\u002Fhttps:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fuploads\u002Fuser\u002Fprofile_image\u002F434230\u002Fb7ce2384-5757-434e-b9a7-0917c8af52d4.jpeg",profile_image_90:"https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--WyLRD0SS--\u002Fc_fill,f_auto,fl_progressive,h_90,q_auto,w_90\u002Fhttps:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fuploads\u002Fuser\u002Fprofile_image\u002F434230\u002Fb7ce2384-5757-434e-b9a7-0917c8af52d4.jpeg"}}},serverRendered:true,routePath:"\u002Farticles\u002Fpawarrchetan\u002F563046",config:{_app:{basePath:"\u002F",assetsPath:"\u002F_nuxt\u002F",cdnURL:a}}}}(null,"2021-01-06T09:37:36Z","https:\u002F\u002Fdev.to\u002Fpawarrchetan\u002Fsecuring-apis-with-aws-amplify-and-cognito-27g2",19,"pawarrchetan"));