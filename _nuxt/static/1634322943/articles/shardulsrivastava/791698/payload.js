__NUXT_JSONP__("/articles/shardulsrivastava/791698", (function(a,b,c,d,e,f){c.type_of="article";c.id=791698;c.title="Canary Deployment with Istio on EKS";c.description="Canary deployment is a way of deploying the application in a phased manner. In this pattern, we...";c.readable_publish_date="Aug 14";c.slug="canary-deployment-with-istio-on-eks-2m98";c.path="\u002Faws-builders\u002Fcanary-deployment-with-istio-on-eks-2m98";c.url="https:\u002F\u002Fdev.to\u002Faws-builders\u002Fcanary-deployment-with-istio-on-eks-2m98";c.comments_count=2;c.public_reactions_count=d;c.collection_id=a;c.published_timestamp=b;c.positive_reactions_count=d;c.cover_image="https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--dX1xKD40--\u002Fc_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000\u002Fhttps:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fuploads\u002Farticles\u002F99lh1ib21u95j25dt19m.png";c.social_image="https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--cigPQnTk--\u002Fc_imagga_scale,f_auto,fl_progressive,h_500,q_auto,w_1000\u002Fhttps:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fuploads\u002Farticles\u002F99lh1ib21u95j25dt19m.png";c.canonical_url="https:\u002F\u002Fshardul.dev\u002Fcanary-deployments-with-istio-on-eks\u002F";c.created_at=b;c.edited_at="2021-08-14T16:45:34Z";c.crossposted_at=a;c.published_at=b;c.last_comment_at="2021-08-26T17:17:39Z";c.reading_time_minutes=7;c.tag_list="kubernetes, canarydeployments, istio, eks";c.tags=["kubernetes","canarydeployments","istio","eks"];c.body_html="\u003Cp\u003ECanary deployment is a way of deploying the application in a phased manner. In this pattern, we deploy a new version of the application alongside the production version, then rollout the change to a small subset of servers. \u003Cbr\u003E\nOnce new version of the application is tested by the real users, then rollout the change out to the rest of the servers.\u003C\u002Fp\u003E\n\n\u003Cp\u003ECanary deployments can be complex and involve testing in production and manual verification.\u003C\u002Fp\u003E\n\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--t_EsX2TF--\u002Fc_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\u002Fhttps:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fuploads\u002Farticles\u002Fqlo7w0fwc5iwyza1e36d.png\" class=\"article-body-image-wrapper\"\u003E\u003Cimg src=\"https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--t_EsX2TF--\u002Fc_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\u002Fhttps:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fuploads\u002Farticles\u002Fqlo7w0fwc5iwyza1e36d.png\" alt=\"canary-release\" loading=\"lazy\"\u003E\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\n\u003Cp\u003ETo demonstrate Canary deployments, we will setup an EKS cluster, install Istio, deploy sample application and setup canary release of new version of application.\u003C\u002Fp\u003E\n\n\u003Cp\u003Eyou can follow the steps below or use the script \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fshardulsrivastava\u002Feks-istio-canary\u002Fblob\u002Fmain\u002Fauto\u002Fsetup-cluster\"\u003Ehere\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003Ch2\u003E\n  \u003Ca name=\"setup-eks-cluster\" href=\"#setup-eks-cluster\"\u003E\n  \u003C\u002Fa\u003E\n  Setup EKS Cluster\n\u003C\u002Fh2\u003E\n\n\u003Cp\u003ESetup an EKS cluster of version \u003Ccode\u003E1.21\u003C\u002Fcode\u003E in \u003Ccode\u003Eus-east-1\u003C\u002Fcode\u003E region with a managed node group \u003Ccode\u003Edefault-pool\u003C\u002Fcode\u003E of machine type \u003Ccode\u003Et3a-medium\u003C\u002Fcode\u003E. \u003C\u002Fp\u003E\n\n\u003Cul\u003E\n\u003Cli\u003EDownload and install the latest version of \u003Ccode\u003Eeksctl\u003C\u002Fcode\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight shell\"\u003E\u003Ccode\u003E   curl \u003Cspan class=\"nt\"\u003E--silent\u003C\u002Fspan\u003E \u003Cspan class=\"nt\"\u003E--location\u003C\u002Fspan\u003E \u003Cspan class=\"s2\"\u003E\"https:\u002F\u002Fgithub.com\u002Fweaveworks\u002Feksctl\u002Freleases\u002Flatest\u002Fdownload\u002Feksctl_\u003C\u002Fspan\u003E\u003Cspan class=\"si\"\u003E$(\u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Euname\u003C\u002Fspan\u003E \u003Cspan class=\"nt\"\u003E-s\u003C\u002Fspan\u003E\u003Cspan class=\"si\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E_amd64.tar.gz\"\u003C\u002Fspan\u003E | \u003Cspan class=\"nb\"\u003Etar \u003C\u002Fspan\u003Exz \u003Cspan class=\"nt\"\u003E-C\u003C\u002Fspan\u003E \u002Ftmp\n   \u003Cspan class=\"nb\"\u003Esudo mv\u003C\u002Fspan\u003E \u002Ftmp\u002Feksctl \u002Fusr\u002Flocal\u002Fbin\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\u003Cp\u003Efor Mac and other operating systems, follow the steps \u003Ca href=\"https:\u002F\u002Feksctl.io\u002Fintroduction\u002F#installation\"\u003Ehere\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\n\u003Cul\u003E\n\u003Cli\u003ECreate EKS cluster\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight shell\"\u003E\u003Ccode\u003E   eksctl create cluster \u003Cspan class=\"nt\"\u003E--name\u003C\u002Fspan\u003E canary-cluster \u003Cspan class=\"se\"\u003E\\\u003C\u002Fspan\u003E\n          \u003Cspan class=\"nt\"\u003E--version\u003C\u002Fspan\u003E 1.21 \u003Cspan class=\"se\"\u003E\\\u003C\u002Fspan\u003E\n          \u003Cspan class=\"nt\"\u003E--region\u003C\u002Fspan\u003E us-east-1 \u003Cspan class=\"se\"\u003E\\\u003C\u002Fspan\u003E\n          \u003Cspan class=\"nt\"\u003E--nodegroup-name\u003C\u002Fspan\u003E default-pool \u003Cspan class=\"se\"\u003E\\\u003C\u002Fspan\u003E\n          \u003Cspan class=\"nt\"\u003E--node-type\u003C\u002Fspan\u003E t3a.medium \u003Cspan class=\"se\"\u003E\\\u003C\u002Fspan\u003E\n          \u003Cspan class=\"nt\"\u003E--nodes\u003C\u002Fspan\u003E 3 \u003Cspan class=\"se\"\u003E\\\u003C\u002Fspan\u003E\n          \u003Cspan class=\"nt\"\u003E--nodes-min\u003C\u002Fspan\u003E 0 \u003Cspan class=\"se\"\u003E\\\u003C\u002Fspan\u003E\n          \u003Cspan class=\"nt\"\u003E--nodes-max\u003C\u002Fspan\u003E 4 \u003Cspan class=\"se\"\u003E\\\u003C\u002Fspan\u003E\n          \u003Cspan class=\"nt\"\u003E--managed\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\u003Cp\u003EOnce the Control plane is ready, you should see the output like this\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight shell\"\u003E\u003Ccode\u003E   2021-08-13 23:59:52 \u003Cspan class=\"o\"\u003E[\u003C\u002Fspan\u003Eℹ]  waiting \u003Cspan class=\"k\"\u003Efor \u003C\u002Fspan\u003Ethe control plane availability...\n   2021-08-13 23:59:52 \u003Cspan class=\"o\"\u003E[\u003C\u002Fspan\u003E✔]  saved kubeconfig as \u003Cspan class=\"s2\"\u003E\"\u002FUsers\u002Fshardulsrivastava\u002F.kube\u002Fconfig\"\u003C\u002Fspan\u003E\n   2021-08-13 23:59:52 \u003Cspan class=\"o\"\u003E[\u003C\u002Fspan\u003Eℹ]  no tasks\n   2021-08-13 23:59:52 \u003Cspan class=\"o\"\u003E[\u003C\u002Fspan\u003E✔]  all EKS cluster resources \u003Cspan class=\"k\"\u003Efor\u003C\u002Fspan\u003E \u003Cspan class=\"s2\"\u003E\"canary-cluster\"\u003C\u002Fspan\u003E have been created\n   2021-08-14 00:01:57 \u003Cspan class=\"o\"\u003E[\u003C\u002Fspan\u003Eℹ]  kubectl \u003Cspan class=\"nb\"\u003Ecommand \u003C\u002Fspan\u003Eshould work with \u003Cspan class=\"s2\"\u003E\"\u002FUsers\u002Fshardulsrivastava\u002F.kube\u002Fconfig\"\u003C\u002Fspan\u003E, try \u003Cspan class=\"s1\"\u003E'kubectl get nodes'\u003C\u002Fspan\u003E\n   2021-08-14 00:01:57 \u003Cspan class=\"o\"\u003E[\u003C\u002Fspan\u003E✔]  EKS cluster \u003Cspan class=\"s2\"\u003E\"canary-cluster\"\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Ein\u003C\u002Fspan\u003E \u003Cspan class=\"s2\"\u003E\"us-east-1\"\u003C\u002Fspan\u003E region is ready\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003ENote: You would need a minimum of \u003Ca href=\"https:\u002F\u002Feksctl.io\u002Fusage\u002Fminimum-iam-policies\u002F\"\u003Ethese permissions\u003C\u002Fa\u003E to run the eksctl commands above.\u003C\u002Fp\u003E\n\n\u003Cul\u003E\n\u003Cli\u003EDownload and install \u003Ccode\u003Ekubectl\u003C\u002Fcode\u003E\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight shell\"\u003E\u003Ccode\u003E   curl \u003Cspan class=\"nt\"\u003E-LO\u003C\u002Fspan\u003E \u003Cspan class=\"s2\"\u003E\"https:\u002F\u002Fdl.k8s.io\u002Frelease\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"si\"\u003E$(\u003C\u002Fspan\u003Ecurl \u003Cspan class=\"nt\"\u003E-L\u003C\u002Fspan\u003E \u003Cspan class=\"nt\"\u003E-s\u003C\u002Fspan\u003E https:\u002F\u002Fdl.k8s.io\u002Frelease\u002Fstable.txt\u003Cspan class=\"si\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\u002Fbin\u002Flinux\u002Famd64\u002Fkubectl\"\u003C\u002Fspan\u003E\n   \u003Cspan class=\"nb\"\u003Esudo install\u003C\u002Fspan\u003E \u003Cspan class=\"nt\"\u003E-o\u003C\u002Fspan\u003E root \u003Cspan class=\"nt\"\u003E-g\u003C\u002Fspan\u003E root \u003Cspan class=\"nt\"\u003E-m\u003C\u002Fspan\u003E 0755 kubectl \u002Fusr\u002Flocal\u002Fbin\u002Fkubectl\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cul\u003E\n\u003Cli\u003ECheck the pods running in cluster:\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight shell\"\u003E\u003Ccode\u003E   kubectl get pods \u003Cspan class=\"nt\"\u003E-A\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003EAt this point, your cluster would have only the \u003Ccode\u003Ecore-dns\u003C\u002Fcode\u003E, \u003Ccode\u003Ekube-proxy\u003C\u002Fcode\u003E, and \u003Ccode\u003Eamazon-vpc-cni\u003C\u002Fcode\u003E plugins.\u003C\u002Fp\u003E\n\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--m6mOq68F--\u002Fc_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\u002Fhttps:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fuploads\u002Farticles\u002F4pb71izuokju0bvtyt5p.png\" class=\"article-body-image-wrapper\"\u003E\u003Cimg src=\"https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--m6mOq68F--\u002Fc_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\u002Fhttps:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fuploads\u002Farticles\u002F4pb71izuokju0bvtyt5p.png\" alt=\"eks-cluster\" loading=\"lazy\"\u003E\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\n\u003Ch2\u003E\n  \u003Ca name=\"setup-istio\" href=\"#setup-istio\"\u003E\n  \u003C\u002Fa\u003E\n  Setup Istio\n\u003C\u002Fh2\u003E\n\n\u003Cp\u003EIstio provides a convenient binary \u003Ccode\u003Eistioctl\u003C\u002Fcode\u003E to set up and interact with Istio components.\u003C\u002Fp\u003E\n\n\u003Cul\u003E\n\u003Cli\u003EInstall \u003Ccode\u003Eistioctl\u003C\u002Fcode\u003E and if you're running these commands from an ec2 instance, add the installation directory to system path:\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight shell\"\u003E\u003Ccode\u003E   curl \u003Cspan class=\"nt\"\u003E-L\u003C\u002Fspan\u003E https:\u002F\u002Fistio.io\u002FdownloadIstio | sh -\n   \u003Cspan class=\"nb\"\u003Eexport \u003C\u002Fspan\u003E\u003Cspan class=\"nv\"\u003EPATH\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"\u003C\u002Fspan\u003E\u003Cspan class=\"nv\"\u003E$PATH\u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E:\u002Fhome\u002Fec2-user\u002Fistio-1.11.0\u002Fbin\"\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cul\u003E\n\u003Cli\u003EIstio has multiple configuration \u003Ca href=\"https:\u002F\u002Fistio.io\u002Flatest\u002Fdocs\u002Fsetup\u002Fadditional-setup\u002Fconfig-profiles\u002F\"\u003Eprofiles\u003C\u002Fa\u003E, these profiles provide customization of the Istio control plane and of the sidecars for the Istio data plane.\n\u003Ccode\u003Edefault\u003C\u002Fcode\u003E profile is recommended for production deployments.\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight shell\"\u003E\u003Ccode\u003E   istioctl \u003Cspan class=\"nb\"\u003Einstall\u003C\u002Fspan\u003E \u003Cspan class=\"nt\"\u003E--set\u003C\u002Fspan\u003E \u003Cspan class=\"nv\"\u003Eprofile\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003Edefault \u003Cspan class=\"nt\"\u003E-y\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003Ealternatively, you can also take the dump of the manifests and apply using kubectl:\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight shell\"\u003E\u003Ccode\u003E    istioctl manifest generate \u003Cspan class=\"nt\"\u003E--set\u003C\u002Fspan\u003E \u003Cspan class=\"nv\"\u003Eprofile\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003Edefault \u003Cspan class=\"o\"\u003E&gt;\u003C\u002Fspan\u003E generated-manifest.yaml\n    kubectl apply \u003Cspan class=\"nt\"\u003E-f\u003C\u002Fspan\u003E generated-manifest.yaml\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003EOnce installed, you should see the output like this for a successful installation.\u003C\u002Fp\u003E\n\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--xZNc10b8--\u002Fc_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\u002Fhttps:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fuploads\u002Farticles\u002F4wc5pk2vn1ura373qt5r.png\" class=\"article-body-image-wrapper\"\u003E\u003Cimg src=\"https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--xZNc10b8--\u002Fc_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\u002Fhttps:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fuploads\u002Farticles\u002F4wc5pk2vn1ura373qt5r.png\" alt=\"istioctl-output\" loading=\"lazy\"\u003E\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\n\u003Cp\u003ENote: If you get the below error, you should check the instance type you are using as there is a limit to the number of pods that can be scheduled on the node based on the node's instance type. See \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fawslabs\u002Famazon-eks-ami\u002Fblob\u002Fmaster\u002Ffiles\u002Feni-max-pods.txt\"\u003Ehere\u003C\u002Fa\u003E for the list of instance types and the max pods.\u003C\u002Fp\u003E\n\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--mIDjiUvh--\u002Fc_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\u002Fhttps:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fuploads\u002Farticles\u002F8xqhm7lhc7fsb8bzrkr7.png\" class=\"article-body-image-wrapper\"\u003E\u003Cimg src=\"https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--mIDjiUvh--\u002Fc_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\u002Fhttps:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fuploads\u002Farticles\u002F8xqhm7lhc7fsb8bzrkr7.png\" alt=\"istioctl-error\" loading=\"lazy\"\u003E\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\n\u003Cul\u003E\n\u003Cli\u003EIstio injects a \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fenvoyproxy\u002Fenvoy\"\u003Eenvoy proxy\u003C\u002Fa\u003E side-car container to the pods to intercept traffic from pods, this behavior is enabled using label \u003Ccode\u003Eistio-injection=enabled\u003C\u002Fcode\u003E on the namespace level and \u003Ccode\u003Esidecar.istio.io\u002Finject=true\u003C\u002Fcode\u003E on the pod level.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cp\u003EAdd this label to the \u003Ccode\u003Edefault\u003C\u002Fcode\u003E namespace to instruct Istio to automatically inject Envoy sidecar proxies.\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight shell\"\u003E\u003Ccode\u003E   kubectl label namespace default istio-injection\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003Eenabled\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003ERead more about Istio side-car injection \u003Ca href=\"https:\u002F\u002Fistio.io\u002Flatest\u002Fdocs\u002Fsetup\u002Fadditional-setup\u002Fsidecar-injection\u002F\"\u003Ehere\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\n\u003Cul\u003E\n\u003Cli\u003EInstall \u003Ccode\u003EKiali\u003C\u002Fcode\u003E, \u003Ccode\u003EPrometheus\u003C\u002Fcode\u003E and \u003Ccode\u003EGrafana\u003C\u002Fcode\u003E to monitor and visualize mesh\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight shell\"\u003E\u003Ccode\u003E   kubectl apply \u003Cspan class=\"nt\"\u003E-f\u003C\u002Fspan\u003E https:\u002F\u002Fraw.githubusercontent.com\u002Fistio\u002Fistio\u002F1.10.3\u002Fsamples\u002Faddons\u002Fprometheus.yaml\n   kubectl apply \u003Cspan class=\"nt\"\u003E-f\u003C\u002Fspan\u003E https:\u002F\u002Fraw.githubusercontent.com\u002Fistio\u002Fistio\u002F1.10.3\u002Fsamples\u002Faddons\u002Fgrafana.yaml\n   kubectl apply \u003Cspan class=\"nt\"\u003E-f\u003C\u002Fspan\u003E https:\u002F\u002Fraw.githubusercontent.com\u002Fistio\u002Fistio\u002F1.10.3\u002Fsamples\u002Faddons\u002Fkiali.yaml\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003ENote: If you get an error like this \u003Ccode\u003Eunable to recognize \"https:\u002F\u002Fraw.githubusercontent.com\u002Fistio\u002Fistio\u002F1.10.3\u002Fsamples\u002Faddons\u002Fkiali.yaml\": no matches for kind \"MonitoringDashboard\" in version \"monitoring.kiali.io\u002Fv1alpha1\"\u003C\u002Fcode\u003E, then re-run the command:\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight shell\"\u003E\u003Ccode\u003E   kubectl apply \u003Cspan class=\"nt\"\u003E-f\u003C\u002Fspan\u003E https:\u002F\u002Fraw.githubusercontent.com\u002Fistio\u002Fistio\u002F1.10.3\u002Fsamples\u002Faddons\u002Fkiali.yaml\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Ch2\u003E\n  \u003Ca name=\"setup-sample-application\" href=\"#setup-sample-application\"\u003E\n  \u003C\u002Fa\u003E\n  Setup Sample Application\n\u003C\u002Fh2\u003E\n\n\u003Cp\u003ETo demonstrate how canary deployment works, let's set up version \u003Ccode\u003Ev1\u003C\u002Fcode\u003E of an Nginx-based sample application and set up a service to expose it at port \u003Ccode\u003E80\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\n\u003Cul\u003E\n\u003Cli\u003EDeploy \u003Ccode\u003Ev1\u003C\u002Fcode\u003E vesion of sample application :\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight yaml\"\u003E\u003Ccode\u003E   \u003Cspan class=\"na\"\u003EapiVersion\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Eapps\u002Fv1\u003C\u002Fspan\u003E\n   \u003Cspan class=\"na\"\u003Ekind\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003EDeployment\u003C\u002Fspan\u003E\n   \u003Cspan class=\"na\"\u003Emetadata\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n     \u003Cspan class=\"na\"\u003Elabels\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n       \u003Cspan class=\"na\"\u003Eapp\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Enginx\u003C\u002Fspan\u003E\n     \u003Cspan class=\"na\"\u003Ename\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Enginx-v1\u003C\u002Fspan\u003E\n   \u003Cspan class=\"na\"\u003Espec\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n     \u003Cspan class=\"na\"\u003Ereplicas\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E1\u003C\u002Fspan\u003E\n     \u003Cspan class=\"na\"\u003Eselector\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n       \u003Cspan class=\"na\"\u003EmatchLabels\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n         \u003Cspan class=\"na\"\u003Eapp\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Enginx\u003C\u002Fspan\u003E\n         \u003Cspan class=\"na\"\u003Eversion\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Ev1\u003C\u002Fspan\u003E\n     \u003Cspan class=\"na\"\u003Etemplate\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n       \u003Cspan class=\"na\"\u003Emetadata\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n         \u003Cspan class=\"na\"\u003Elabels\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n           \u003Cspan class=\"na\"\u003Eapp\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Enginx\u003C\u002Fspan\u003E\n           \u003Cspan class=\"na\"\u003Eversion\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Ev1\u003C\u002Fspan\u003E\n       \u003Cspan class=\"na\"\u003Espec\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n         \u003Cspan class=\"na\"\u003Econtainers\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n         \u003Cspan class=\"pi\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"na\"\u003Eimage\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Equay.io\u002Fshardul\u002Fnginx:v1\u003C\u002Fspan\u003E\n           \u003Cspan class=\"na\"\u003Ename\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Enginx-v1\u003C\u002Fspan\u003E\n           \u003Cspan class=\"na\"\u003EimagePullPolicy\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003EAlways\u003C\u002Fspan\u003E\n           \u003Cspan class=\"na\"\u003Eports\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n           \u003Cspan class=\"pi\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"na\"\u003Ename\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Ehttp\u003C\u002Fspan\u003E\n             \u003Cspan class=\"na\"\u003EcontainerPort\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E80\u003C\u002Fspan\u003E\n           \u003Cspan class=\"na\"\u003ElivenessProbe\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n             \u003Cspan class=\"na\"\u003EhttpGet\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n               \u003Cspan class=\"na\"\u003Epath\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E\u002Fhealth\u003C\u002Fspan\u003E\n               \u003Cspan class=\"na\"\u003Eport\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E80\u003C\u002Fspan\u003E\n           \u003Cspan class=\"na\"\u003EreadinessProbe\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n             \u003Cspan class=\"na\"\u003EhttpGet\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n               \u003Cspan class=\"na\"\u003Epath\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E\u002Fhealth\u003C\u002Fspan\u003E\n               \u003Cspan class=\"na\"\u003Eport\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E80\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cul\u003E\n\u003Cli\u003EExpose the application as a service:\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight yaml\"\u003E\u003Ccode\u003E   \u003Cspan class=\"na\"\u003EapiVersion\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Ev1\u003C\u002Fspan\u003E\n   \u003Cspan class=\"na\"\u003Ekind\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003EService\u003C\u002Fspan\u003E\n   \u003Cspan class=\"na\"\u003Emetadata\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n     \u003Cspan class=\"na\"\u003Elabels\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n       \u003Cspan class=\"na\"\u003Eapp\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Enginx\u003C\u002Fspan\u003E\n     \u003Cspan class=\"na\"\u003Ename\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Enginx\u003C\u002Fspan\u003E\n   \u003Cspan class=\"na\"\u003Espec\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n     \u003Cspan class=\"na\"\u003Eports\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n     \u003Cspan class=\"pi\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"na\"\u003Ename\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Ehttp\u003C\u002Fspan\u003E\n       \u003Cspan class=\"na\"\u003Eport\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E80\u003C\u002Fspan\u003E\n     \u003Cspan class=\"na\"\u003Eselector\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n       \u003Cspan class=\"na\"\u003Eapp\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Enginx\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cul\u003E\n\u003Cli\u003ESetup a test pod to test the connectivity to the nginx service :\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight shell\"\u003E\u003Ccode\u003E   kubectl run \u003Cspan class=\"nt\"\u003E-it\u003C\u002Fspan\u003E test-connection \u003Cspan class=\"nt\"\u003E--image\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003Eradial\u002Fbusyboxplus:curl \u003Cspan class=\"nt\"\u003E--\u003C\u002Fspan\u003E sh\n   \u003Cspan class=\"o\"\u003E[\u003C\u002Fspan\u003E root@test-connection:\u002F \u003Cspan class=\"o\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"nv\"\u003E$ \u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Ewhile \u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Etrue\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Edo \u003C\u002Fspan\u003Ecurl nginx \u003Cspan class=\"o\"\u003E&amp;&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Eecho\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Edone\n   \u003C\u002Fspan\u003EYou\u003Cspan class=\"s1\"\u003E're at the root of nginx server v1\n   You'\u003C\u002Fspan\u003Ere at the root of nginx server v1\n   You\u003Cspan class=\"s1\"\u003E're at the root of nginx server v1\n   You'\u003C\u002Fspan\u003Ere at the root of nginx server v1\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Ch2\u003E\n  \u003Ca name=\"canary-deployment-with-istio\" href=\"#canary-deployment-with-istio\"\u003E\n  \u003C\u002Fa\u003E\n  Canary Deployment with Istio\n\u003C\u002Fh2\u003E\n\n\u003Cp\u003EWith Istio, traffic routing and replica deployment are totally independent of each other. Istio \u003Ca href=\"https:\u002F\u002Fistio.io\u002Flatest\u002Fdocs\u002Fconcepts\u002Ftraffic-management\u002F#routing-rules\"\u003Erouting rules\u003C\u002Fa\u003E provide fine-grained control over how to route traffic based on \u003Ccode\u003Ehost\u003C\u002Fcode\u003E, \u003Ccode\u003Eport\u003C\u002Fcode\u003E, \u003Ccode\u003Eheaders\u003C\u002Fcode\u003E, \u003Ccode\u003Euri\u003C\u002Fcode\u003E, \u003Ccode\u003Emethod\u003C\u002Fcode\u003E, \u003Ccode\u003Esource labels\u003C\u002Fcode\u003E and control the distribution of traffic.\u003C\u002Fp\u003E\n\n\u003Cul\u003E\n\u003Cli\u003EDeploy another version \u003Ccode\u003Ev2\u003C\u002Fcode\u003E of the same application that uses image \u003Ccode\u003Equay.io\u002Fshardul\u002Fnginx:v2\u003C\u002Fcode\u003E.\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight yaml\"\u003E\u003Ccode\u003E   \u003Cspan class=\"na\"\u003EapiVersion\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Eapps\u002Fv1\u003C\u002Fspan\u003E\n   \u003Cspan class=\"na\"\u003Ekind\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003EDeployment\u003C\u002Fspan\u003E\n   \u003Cspan class=\"na\"\u003Emetadata\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n     \u003Cspan class=\"na\"\u003Elabels\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n       \u003Cspan class=\"na\"\u003Eapp\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Enginx\u003C\u002Fspan\u003E\n     \u003Cspan class=\"na\"\u003Ename\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Enginx-v2\u003C\u002Fspan\u003E\n   \u003Cspan class=\"na\"\u003Espec\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n     \u003Cspan class=\"na\"\u003Ereplicas\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E1\u003C\u002Fspan\u003E\n     \u003Cspan class=\"na\"\u003Eselector\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n       \u003Cspan class=\"na\"\u003EmatchLabels\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n         \u003Cspan class=\"na\"\u003Eapp\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Enginx\u003C\u002Fspan\u003E\n         \u003Cspan class=\"na\"\u003Eversion\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Ev2\u003C\u002Fspan\u003E\n     \u003Cspan class=\"na\"\u003Etemplate\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n       \u003Cspan class=\"na\"\u003Emetadata\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n         \u003Cspan class=\"na\"\u003Elabels\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n           \u003Cspan class=\"na\"\u003Eapp\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Enginx\u003C\u002Fspan\u003E\n           \u003Cspan class=\"na\"\u003Eversion\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Ev2\u003C\u002Fspan\u003E\n       \u003Cspan class=\"na\"\u003Espec\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n         \u003Cspan class=\"na\"\u003Econtainers\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n         \u003Cspan class=\"pi\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"na\"\u003Eimage\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Equay.io\u002Fshardul\u002Fnginx:v2\u003C\u002Fspan\u003E\n           \u003Cspan class=\"na\"\u003Ename\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Enginx-v2\u003C\u002Fspan\u003E\n           \u003Cspan class=\"na\"\u003EimagePullPolicy\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003EAlways\u003C\u002Fspan\u003E\n           \u003Cspan class=\"na\"\u003Eports\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n           \u003Cspan class=\"pi\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"na\"\u003Ename\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Ehttp\u003C\u002Fspan\u003E\n             \u003Cspan class=\"na\"\u003EcontainerPort\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E80\u003C\u002Fspan\u003E\n           \u003Cspan class=\"na\"\u003ElivenessProbe\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n             \u003Cspan class=\"na\"\u003EhttpGet\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n               \u003Cspan class=\"na\"\u003Epath\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E\u002Fhealth\u003C\u002Fspan\u003E\n               \u003Cspan class=\"na\"\u003Eport\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E80\u003C\u002Fspan\u003E\n           \u003Cspan class=\"na\"\u003EreadinessProbe\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n             \u003Cspan class=\"na\"\u003EhttpGet\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n               \u003Cspan class=\"na\"\u003Epath\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E\u002Fhealth\u003C\u002Fspan\u003E\n               \u003Cspan class=\"na\"\u003Eport\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E80\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003EOnce the \u003Ccode\u003Ev2\u003C\u002Fcode\u003E version is deployed, when we hit the service again, we would get the below output :\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight shell\"\u003E\u003Ccode\u003E   kubectl \u003Cspan class=\"nb\"\u003Eexec\u003C\u002Fspan\u003E \u003Cspan class=\"nt\"\u003E-it\u003C\u002Fspan\u003E test-connection \u003Cspan class=\"nt\"\u003E--\u003C\u002Fspan\u003E sh\n   \u003Cspan class=\"o\"\u003E[\u003C\u002Fspan\u003E root@test-connection:\u002F \u003Cspan class=\"o\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"nv\"\u003E$ \u003C\u002Fspan\u003E\u003Cspan class=\"k\"\u003Ewhile \u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Etrue\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Edo \u003C\u002Fspan\u003Ecurl nginx \u003Cspan class=\"o\"\u003E&amp;&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Eecho\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Edone\n   \u003C\u002Fspan\u003EYou\u003Cspan class=\"s1\"\u003E're at the root of nginx server v2\n   You'\u003C\u002Fspan\u003Ere at the root of nginx server v2\n   You\u003Cspan class=\"s1\"\u003E're at the root of nginx server v1\n   You'\u003C\u002Fspan\u003Ere at the root of nginx server v1\n   You\u003Cspan class=\"s1\"\u003E're at the root of nginx server v2\n   You'\u003C\u002Fspan\u003Ere at the root of nginx server v1\n   You\u003Cspan class=\"s1\"\u003E're at the root of nginx server v1\n   You'\u003C\u002Fspan\u003Ere at the root of nginx server v2\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003ESince there are two deployments with different versions exposed from the same service, whenever you hit the service, it will hit the different versions of the application in a round-robin manner and hence this output.\u003C\u002Fp\u003E\n\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Ca href=\"https:\u002F\u002Fistio.io\u002Flatest\u002Fdocs\u002Freference\u002Fconfig\u002Fnetworking\u002Fgateway\u002F\"\u003EIstio Gateway\u003C\u002Fa\u003E acts as a load balancer receiving incoming and outgoing HTTP\u002FTCP connections and it's bound to the \u003Ccode\u003Eistio-ingressgateway\u003C\u002Fcode\u003E resource created during installation as a \u003Ccode\u003ELoadBalancer\u003C\u002Fcode\u003E service.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cp\u003ESetup a \u003Ccode\u003Edefault-gateway\u003C\u002Fcode\u003E for all the incoming traffic on port \u003Ccode\u003E80\u003C\u002Fcode\u003E :\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight yaml\"\u003E\u003Ccode\u003E   \u003Cspan class=\"na\"\u003EapiVersion\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Enetworking.istio.io\u002Fv1alpha3\u003C\u002Fspan\u003E\n   \u003Cspan class=\"na\"\u003Ekind\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003EGateway\u003C\u002Fspan\u003E\n   \u003Cspan class=\"na\"\u003Emetadata\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n     \u003Cspan class=\"na\"\u003Ename\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Edefault-gateway\u003C\u002Fspan\u003E\n     \u003Cspan class=\"na\"\u003Enamespace\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Eistio-system\u003C\u002Fspan\u003E\n   \u003Cspan class=\"na\"\u003Espec\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n     \u003Cspan class=\"na\"\u003Eselector\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n       \u003Cspan class=\"na\"\u003Eistio\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Eingressgateway\u003C\u002Fspan\u003E\n     \u003Cspan class=\"na\"\u003Eservers\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n     \u003Cspan class=\"pi\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"na\"\u003Ehosts\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n       \u003Cspan class=\"pi\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"s1\"\u003E'\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E*'\u003C\u002Fspan\u003E\n       \u003Cspan class=\"na\"\u003Eport\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n         \u003Cspan class=\"na\"\u003Ename\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Ehttp\u003C\u002Fspan\u003E\n         \u003Cspan class=\"na\"\u003Enumber\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E80\u003C\u002Fspan\u003E\n         \u003Cspan class=\"na\"\u003Eprotocol\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003EHTTP\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--hXO71oiE--\u002Fc_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\u002Fhttps:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fuploads\u002Farticles\u002F3ek9snqayacgiz0s5w14.png\" class=\"article-body-image-wrapper\"\u003E\u003Cimg src=\"https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--hXO71oiE--\u002Fc_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\u002Fhttps:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fuploads\u002Farticles\u002F3ek9snqayacgiz0s5w14.png\" alt=\"istio-ingressgateway\" loading=\"lazy\"\u003E\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Ca href=\"https:\u002F\u002Fistio.io\u002Flatest\u002Fdocs\u002Freference\u002Fconfig\u002Fnetworking\u002Fdestination-rule\u002F\"\u003EDestination Rule\u003C\u002Fa\u003E allows you to define \u003Ca href=\"https:\u002F\u002Fistio.io\u002Flatest\u002Fdocs\u002Freference\u002Fconfig\u002Fnetworking\u002Fdestination-rule\u002F#Subset\"\u003Esubsets\u003C\u002Fa\u003E of an application based on a set of labels. For example, we have deployed two subsets \u003Ccode\u003Ev1\u003C\u002Fcode\u003E and \u003Ccode\u003Ev2\u003C\u002Fcode\u003E of an application, and they are identified by the label \u003Ccode\u003Eversion\u003C\u002Fcode\u003E.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cp\u003ESetup a DestinationRule \u003Ccode\u003Enginx-dest-rule\u003C\u002Fcode\u003E to define two subsets \u003Ccode\u003Ev1\u003C\u002Fcode\u003E and \u003Ccode\u003Ev2\u003C\u002Fcode\u003E:\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight yaml\"\u003E\u003Ccode\u003E   \u003Cspan class=\"na\"\u003EapiVersion\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Enetworking.istio.io\u002Fv1alpha3\u003C\u002Fspan\u003E\n   \u003Cspan class=\"na\"\u003Ekind\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003EDestinationRule\u003C\u002Fspan\u003E\n   \u003Cspan class=\"na\"\u003Emetadata\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n     \u003Cspan class=\"na\"\u003Ename\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Enginx-dest-rule\u003C\u002Fspan\u003E\n   \u003Cspan class=\"na\"\u003Espec\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n     \u003Cspan class=\"na\"\u003Ehost\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Enginx\u003C\u002Fspan\u003E\n     \u003Cspan class=\"na\"\u003Esubsets\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n     \u003Cspan class=\"pi\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"na\"\u003Ename\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Ev1\u003C\u002Fspan\u003E\n       \u003Cspan class=\"na\"\u003Elabels\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n         \u003Cspan class=\"na\"\u003Eversion\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Ev1\u003C\u002Fspan\u003E\n     \u003Cspan class=\"pi\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"na\"\u003Ename\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Ev2\u003C\u002Fspan\u003E\n       \u003Cspan class=\"na\"\u003Elabels\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n         \u003Cspan class=\"na\"\u003Eversion\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Ev2\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cul\u003E\n\u003Cli\u003E\n\u003Ca href=\"https:\u002F\u002Fistio.io\u002Flatest\u002Fdocs\u002Freference\u002Fconfig\u002Fnetworking\u002Fvirtual-service\u002F\"\u003EVirtual Service\u003C\u002Fa\u003E acts just like an Ingress resource and matches traffic and directs it to a service based on the HTTP routing rules.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cp\u003EIt can operate on internal as well as external service and can match traffic based on HTTP host, path (with full regular expression support), method, headers, ports, query parameters.\u003C\u002Fp\u003E\n\n\u003Cp\u003ESetup a VirtualService \u003Ccode\u003Enginx-virtual-svc\u003C\u002Fcode\u003E for host \u003Ccode\u003Enginx\u003C\u002Fcode\u003E that receives the incoming traffic on \u003Ccode\u003Edefault-gateway\u003C\u002Fcode\u003E and routes 90% of the traffic to the subset \u003Ccode\u003Ev1\u003C\u002Fcode\u003E and 10% to subset \u003Ccode\u003Ev2\u003C\u002Fcode\u003E defined in \u003Ccode\u003Enginx-dest-rule\u003C\u002Fcode\u003E.\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight yaml\"\u003E\u003Ccode\u003E   \u003Cspan class=\"na\"\u003EapiVersion\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Enetworking.istio.io\u002Fv1alpha3\u003C\u002Fspan\u003E\n   \u003Cspan class=\"na\"\u003Ekind\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003EVirtualService\u003C\u002Fspan\u003E\n   \u003Cspan class=\"na\"\u003Emetadata\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n     \u003Cspan class=\"na\"\u003Ename\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Enginx-virtual-svc\u003C\u002Fspan\u003E\n   \u003Cspan class=\"na\"\u003Espec\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n     \u003Cspan class=\"na\"\u003Ehosts\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n     \u003Cspan class=\"pi\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Enginx\u003C\u002Fspan\u003E\n     \u003Cspan class=\"na\"\u003Egateways\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n     \u003Cspan class=\"pi\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Eistio-system\u002Fdefault-gateway\u003C\u002Fspan\u003E\n     \u003Cspan class=\"na\"\u003Ehttp\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n     \u003Cspan class=\"pi\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"na\"\u003Eroute\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n       \u003Cspan class=\"pi\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"na\"\u003Edestination\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n           \u003Cspan class=\"na\"\u003Ehost\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Enginx\u003C\u002Fspan\u003E\n           \u003Cspan class=\"na\"\u003Esubset\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Ev1\u003C\u002Fspan\u003E\n         \u003Cspan class=\"na\"\u003Eweight\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E90\u003C\u002Fspan\u003E\n       \u003Cspan class=\"pi\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"na\"\u003Edestination\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E\n           \u003Cspan class=\"na\"\u003Ehost\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Enginx\u003C\u002Fspan\u003E\n           \u003Cspan class=\"na\"\u003Esubset\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003Ev2\u003C\u002Fspan\u003E\n         \u003Cspan class=\"na\"\u003Eweight\u003C\u002Fspan\u003E\u003Cspan class=\"pi\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"m\"\u003E10\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003EAfter applying, \u003Ccode\u003E90%\u003C\u002Fcode\u003E of the traffic will be routed to version \u003Ccode\u003Ev1\u003C\u002Fcode\u003E and \u003Ccode\u003E10%\u003C\u002Fcode\u003E to \u003Ccode\u003Ev2\u003C\u002Fcode\u003E of the \u003Ccode\u003Enginx\u003C\u002Fcode\u003E service. Access the nginx service via \u003Ccode\u003Eistio-ingressgateway\u003C\u002Fcode\u003E.\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight shell\"\u003E\u003Ccode\u003Ekubectl \u003Cspan class=\"nb\"\u003Eexec\u003C\u002Fspan\u003E \u003Cspan class=\"nt\"\u003E-it\u003C\u002Fspan\u003E test-connection \u003Cspan class=\"nt\"\u003E--\u003C\u002Fspan\u003E sh\n\u003Cspan class=\"k\"\u003Ewhile \u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Etrue\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Edo \u003C\u002Fspan\u003Ecurl \u003Cspan class=\"nt\"\u003E-H\u003C\u002Fspan\u003E \u003Cspan class=\"s2\"\u003E\"Host: nginx\"\u003C\u002Fspan\u003E istio-ingressgateway.istio-system \u003Cspan class=\"o\"\u003E&amp;&amp;\u003C\u002Fspan\u003E \u003Cspan class=\"nb\"\u003Eecho\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Edone\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003EWe can visualize the traffic flow using the Kiali dashboard:\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight shell\"\u003E\u003Ccode\u003Eistioctl dashboard kiali\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--rGW66QUk--\u002Fc_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\u002Fhttps:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fuploads\u002Farticles\u002F7yjm6y5gbcoyonzplrps.png\" class=\"article-body-image-wrapper\"\u003E\u003Cimg src=\"https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--rGW66QUk--\u002Fc_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880\u002Fhttps:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fuploads\u002Farticles\u002F7yjm6y5gbcoyonzplrps.png\" alt=\"istio-canary-routing\" loading=\"lazy\"\u003E\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\n\u003Cp\u003EIn production, after testing the \u003Ccode\u003Ecanary version\u003C\u002Fcode\u003E to ensure that it's working fine, we can update the VirtualService to route 100% of the traffic to this version and rollout the newer version for all the users.\u003C\u002Fp\u003E\n\n";c.body_markdown="Canary deployment is a way of deploying the application in a phased manner. In this pattern, we deploy a new version of the application alongside the production version, then rollout the change to a small subset of servers. \nOnce new version of the application is tested by the real users, then rollout the change out to the rest of the servers.\n\nCanary deployments can be complex and involve testing in production and manual verification.\n\n![canary-release](https:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fuploads\u002Farticles\u002Fqlo7w0fwc5iwyza1e36d.png)\n\nTo demonstrate Canary deployments, we will setup an EKS cluster, install Istio, deploy sample application and setup canary release of new version of application.\n\nyou can follow the steps below or use the script [here](https:\u002F\u002Fgithub.com\u002Fshardulsrivastava\u002Feks-istio-canary\u002Fblob\u002Fmain\u002Fauto\u002Fsetup-cluster).\n\n## Setup EKS Cluster\n\nSetup an EKS cluster of version `1.21` in `us-east-1` region with a managed node group `default-pool` of machine type `t3a-medium`. \n\n* Download and install the latest version of `eksctl`\n\n   ```bash\n   curl --silent --location \"https:\u002F\u002Fgithub.com\u002Fweaveworks\u002Feksctl\u002Freleases\u002Flatest\u002Fdownload\u002Feksctl_$(uname -s)_amd64.tar.gz\" | tar xz -C \u002Ftmp\n   sudo mv \u002Ftmp\u002Feksctl \u002Fusr\u002Flocal\u002Fbin\n   ```\n   for Mac and other operating systems, follow the steps [here](https:\u002F\u002Feksctl.io\u002Fintroduction\u002F#installation).\n\n* Create EKS cluster\n   ```bash\n   eksctl create cluster --name canary-cluster \\\n          --version 1.21 \\\n          --region us-east-1 \\\n          --nodegroup-name default-pool \\\n          --node-type t3a.medium \\\n          --nodes 3 \\\n          --nodes-min 0 \\\n          --nodes-max 4 \\\n          --managed\n   ```\n   Once the Control plane is ready, you should see the output like this \n\n   ```bash\n   2021-08-13 23:59:52 [ℹ]  waiting for the control plane availability...\n   2021-08-13 23:59:52 [✔]  saved kubeconfig as \"\u002FUsers\u002Fshardulsrivastava\u002F.kube\u002Fconfig\"\n   2021-08-13 23:59:52 [ℹ]  no tasks\n   2021-08-13 23:59:52 [✔]  all EKS cluster resources for \"canary-cluster\" have been created\n   2021-08-14 00:01:57 [ℹ]  kubectl command should work with \"\u002FUsers\u002Fshardulsrivastava\u002F.kube\u002Fconfig\", try 'kubectl get nodes'\n   2021-08-14 00:01:57 [✔]  EKS cluster \"canary-cluster\" in \"us-east-1\" region is ready\n  ```\n   Note: You would need a minimum of [these permissions](https:\u002F\u002Feksctl.io\u002Fusage\u002Fminimum-iam-policies\u002F) to run the eksctl commands above.\n\n* Download and install `kubectl`\n\n   ```bash\n   curl -LO \"https:\u002F\u002Fdl.k8s.io\u002Frelease\u002F$(curl -L -s https:\u002F\u002Fdl.k8s.io\u002Frelease\u002Fstable.txt)\u002Fbin\u002Flinux\u002Famd64\u002Fkubectl\"\n   sudo install -o root -g root -m 0755 kubectl \u002Fusr\u002Flocal\u002Fbin\u002Fkubectl\n   ```\n\n* Check the pods running in cluster:\n   \n   ```bash\n   kubectl get pods -A\n   ```\n\n   At this point, your cluster would have only the `core-dns`, `kube-proxy`, and `amazon-vpc-cni` plugins.\n\n   ![eks-cluster](https:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fuploads\u002Farticles\u002F4pb71izuokju0bvtyt5p.png)\n\n\n## Setup Istio\n\nIstio provides a convenient binary `istioctl` to set up and interact with Istio components.\n\n* Install `istioctl` and if you're running these commands from an ec2 instance, add the installation directory to system path:\n\n   ```bash\n   curl -L https:\u002F\u002Fistio.io\u002FdownloadIstio | sh -\n   export PATH=\"$PATH:\u002Fhome\u002Fec2-user\u002Fistio-1.11.0\u002Fbin\"\n   ```\n\n* Istio has multiple configuration [profiles](https:\u002F\u002Fistio.io\u002Flatest\u002Fdocs\u002Fsetup\u002Fadditional-setup\u002Fconfig-profiles\u002F), these profiles provide customization of the Istio control plane and of the sidecars for the Istio data plane.\n   `default` profile is recommended for production deployments.\n\n   ```bash\n   istioctl install --set profile=default -y\n   ```\n\n   alternatively, you can also take the dump of the manifests and apply using kubectl:\n\n   ```bash\n    istioctl manifest generate --set profile=default \u003E generated-manifest.yaml\n    kubectl apply -f generated-manifest.yaml\n   ```\n\n   Once installed, you should see the output like this for a successful installation.\n\n   ![istioctl-output](https:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fuploads\u002Farticles\u002F4wc5pk2vn1ura373qt5r.png)\n\n\n   Note: If you get the below error, you should check the instance type you are using as there is a limit to the number of pods that can be scheduled on the node based on the node's instance type. See [here](https:\u002F\u002Fgithub.com\u002Fawslabs\u002Famazon-eks-ami\u002Fblob\u002Fmaster\u002Ffiles\u002Feni-max-pods.txt) for the list of instance types and the max pods.\n\n   ![istioctl-error](https:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fuploads\u002Farticles\u002F8xqhm7lhc7fsb8bzrkr7.png)\n\n* Istio injects a [envoy proxy](https:\u002F\u002Fgithub.com\u002Fenvoyproxy\u002Fenvoy) side-car container to the pods to intercept traffic from pods, this behavior is enabled using label `istio-injection=enabled` on the namespace level and `sidecar.istio.io\u002Finject=true` on the pod level.\n\n   Add this label to the `default` namespace to instruct Istio to automatically inject Envoy sidecar proxies.\n\n   ```bash\n   kubectl label namespace default istio-injection=enabled\n   ```\n\n   Read more about Istio side-car injection [here](https:\u002F\u002Fistio.io\u002Flatest\u002Fdocs\u002Fsetup\u002Fadditional-setup\u002Fsidecar-injection\u002F).\n\n* Install `Kiali`, `Prometheus` and `Grafana` to monitor and visualize mesh\n   \n   ```bash\n   kubectl apply -f https:\u002F\u002Fraw.githubusercontent.com\u002Fistio\u002Fistio\u002F1.10.3\u002Fsamples\u002Faddons\u002Fprometheus.yaml\n   kubectl apply -f https:\u002F\u002Fraw.githubusercontent.com\u002Fistio\u002Fistio\u002F1.10.3\u002Fsamples\u002Faddons\u002Fgrafana.yaml\n   kubectl apply -f https:\u002F\u002Fraw.githubusercontent.com\u002Fistio\u002Fistio\u002F1.10.3\u002Fsamples\u002Faddons\u002Fkiali.yaml\n   ```\n\n   Note: If you get an error like this `unable to recognize \"https:\u002F\u002Fraw.githubusercontent.com\u002Fistio\u002Fistio\u002F1.10.3\u002Fsamples\u002Faddons\u002Fkiali.yaml\": no matches for kind \"MonitoringDashboard\" in version \"monitoring.kiali.io\u002Fv1alpha1\"`, then re-run the command:\n\n   ```bash\n   kubectl apply -f https:\u002F\u002Fraw.githubusercontent.com\u002Fistio\u002Fistio\u002F1.10.3\u002Fsamples\u002Faddons\u002Fkiali.yaml\n   ```\n\n## Setup Sample Application\n\nTo demonstrate how canary deployment works, let's set up version `v1` of an Nginx-based sample application and set up a service to expose it at port `80`.\n\n* Deploy `v1` vesion of sample application :\n\n   ```yaml\n   apiVersion: apps\u002Fv1\n   kind: Deployment\n   metadata:\n     labels:\n       app: nginx\n     name: nginx-v1\n   spec:\n     replicas: 1\n     selector:\n       matchLabels:\n         app: nginx\n         version: v1\n     template:\n       metadata:\n         labels:\n           app: nginx\n           version: v1\n       spec:\n         containers:\n         - image: quay.io\u002Fshardul\u002Fnginx:v1\n           name: nginx-v1\n           imagePullPolicy: Always\n           ports:\n           - name: http\n             containerPort: 80\n           livenessProbe:\n             httpGet:\n               path: \u002Fhealth\n               port: 80\n           readinessProbe:\n             httpGet:\n               path: \u002Fhealth\n               port: 80\n   ```\n\n* Expose the application as a service:\n\n   ```yaml\n   apiVersion: v1\n   kind: Service\n   metadata:\n     labels:\n       app: nginx\n     name: nginx\n   spec:\n     ports:\n     - name: http\n       port: 80\n     selector:\n       app: nginx\n   ```\n\n* Setup a test pod to test the connectivity to the nginx service :\n\n   ```bash\n   kubectl run -it test-connection --image=radial\u002Fbusyboxplus:curl -- sh\n   [ root@test-connection:\u002F ]$ while true; do curl nginx && echo ; done\n   You're at the root of nginx server v1\n   You're at the root of nginx server v1\n   You're at the root of nginx server v1\n   You're at the root of nginx server v1\n   ```\n\n## Canary Deployment with Istio\n\nWith Istio, traffic routing and replica deployment are totally independent of each other. Istio [routing rules](https:\u002F\u002Fistio.io\u002Flatest\u002Fdocs\u002Fconcepts\u002Ftraffic-management\u002F#routing-rules) provide fine-grained control over how to route traffic based on `host`, `port`, `headers`, `uri`, `method`, `source labels` and control the distribution of traffic.\n\n* Deploy another version `v2` of the same application that uses image `quay.io\u002Fshardul\u002Fnginx:v2`.\n\n   ```yaml\n   apiVersion: apps\u002Fv1\n   kind: Deployment\n   metadata:\n     labels:\n       app: nginx\n     name: nginx-v2\n   spec:\n     replicas: 1\n     selector:\n       matchLabels:\n         app: nginx\n         version: v2\n     template:\n       metadata:\n         labels:\n           app: nginx\n           version: v2\n       spec:\n         containers:\n         - image: quay.io\u002Fshardul\u002Fnginx:v2\n           name: nginx-v2\n           imagePullPolicy: Always\n           ports:\n           - name: http\n             containerPort: 80\n           livenessProbe:\n             httpGet:\n               path: \u002Fhealth\n               port: 80\n           readinessProbe:\n             httpGet:\n               path: \u002Fhealth\n               port: 80\n   ```\n\n   Once the `v2` version is deployed, when we hit the service again, we would get the below output :\n\n   ```bash\n   kubectl exec -it test-connection -- sh\n   [ root@test-connection:\u002F ]$ while true; do curl nginx && echo ; done\n   You're at the root of nginx server v2\n   You're at the root of nginx server v2\n   You're at the root of nginx server v1\n   You're at the root of nginx server v1\n   You're at the root of nginx server v2\n   You're at the root of nginx server v1\n   You're at the root of nginx server v1\n   You're at the root of nginx server v2\n   ```\n\n   Since there are two deployments with different versions exposed from the same service, whenever you hit the service, it will hit the different versions of the application in a round-robin manner and hence this output.\n\n\n* [Istio Gateway](https:\u002F\u002Fistio.io\u002Flatest\u002Fdocs\u002Freference\u002Fconfig\u002Fnetworking\u002Fgateway\u002F) acts as a load balancer receiving incoming and outgoing HTTP\u002FTCP connections and it's bound to the `istio-ingressgateway` resource created during installation as a `LoadBalancer` service.\n\n   Setup a `default-gateway` for all the incoming traffic on port `80` :\n\n   ```yaml\n   apiVersion: networking.istio.io\u002Fv1alpha3\n   kind: Gateway\n   metadata:\n     name: default-gateway\n     namespace: istio-system\n   spec:\n     selector:\n       istio: ingressgateway\n     servers:\n     - hosts:\n       - '*'\n       port:\n         name: http\n         number: 80\n         protocol: HTTP\n   ```\n\n   ![istio-ingressgateway](https:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fuploads\u002Farticles\u002F3ek9snqayacgiz0s5w14.png)\n\n* [Destination Rule](https:\u002F\u002Fistio.io\u002Flatest\u002Fdocs\u002Freference\u002Fconfig\u002Fnetworking\u002Fdestination-rule\u002F) allows you to define [subsets](https:\u002F\u002Fistio.io\u002Flatest\u002Fdocs\u002Freference\u002Fconfig\u002Fnetworking\u002Fdestination-rule\u002F#Subset) of an application based on a set of labels. For example, we have deployed two subsets `v1` and `v2` of an application, and they are identified by the label `version`.\n\n   Setup a DestinationRule `nginx-dest-rule` to define two subsets `v1` and `v2`:\n\n   ```yaml\n   apiVersion: networking.istio.io\u002Fv1alpha3\n   kind: DestinationRule\n   metadata:\n     name: nginx-dest-rule\n   spec:\n     host: nginx\n     subsets:\n     - name: v1\n       labels:\n         version: v1\n     - name: v2\n       labels:\n         version: v2\n   ```\n\n* [Virtual Service](https:\u002F\u002Fistio.io\u002Flatest\u002Fdocs\u002Freference\u002Fconfig\u002Fnetworking\u002Fvirtual-service\u002F) acts just like an Ingress resource and matches traffic and directs it to a service based on the HTTP routing rules.\n   \n   It can operate on internal as well as external service and can match traffic based on HTTP host, path (with full regular expression support), method, headers, ports, query parameters.\n\n   Setup a VirtualService `nginx-virtual-svc` for host `nginx` that receives the incoming traffic on `default-gateway` and routes 90% of the traffic to the subset `v1` and 10% to subset `v2` defined in `nginx-dest-rule`.\n\n   ```yaml\n   apiVersion: networking.istio.io\u002Fv1alpha3\n   kind: VirtualService\n   metadata:\n     name: nginx-virtual-svc\n   spec:\n     hosts:\n     - nginx\n     gateways:\n     - istio-system\u002Fdefault-gateway\n     http:\n     - route:\n       - destination:\n           host: nginx\n           subset: v1\n         weight: 90\n       - destination:\n           host: nginx\n           subset: v2\n         weight: 10\n   ```\n\nAfter applying, `90%` of the traffic will be routed to version `v1` and `10%` to `v2` of the `nginx` service. Access the nginx service via `istio-ingressgateway`.\n\n```bash\nkubectl exec -it test-connection -- sh\nwhile true; do curl -H \"Host: nginx\" istio-ingressgateway.istio-system && echo ; done\n```\nWe can visualize the traffic flow using the Kiali dashboard:\n\n```bash\nistioctl dashboard kiali\n```\n\n![istio-canary-routing](https:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fuploads\u002Farticles\u002F7yjm6y5gbcoyonzplrps.png)\n\nIn production, after testing the `canary version` to ensure that it's working fine, we can update the VirtualService to route 100% of the traffic to this version and rollout the newer version for all the users.\n\n";c.user={name:"Shardul Srivastava",username:e,twitter_username:a,github_username:e,website_url:a,profile_image:"https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--RdY5vBNI--\u002Fc_fill,f_auto,fl_progressive,h_640,q_auto,w_640\u002Fhttps:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fuploads\u002Fuser\u002Fprofile_image\u002F497827\u002F8abb9931-172a-456f-8fa3-525618ac5c2d.jpeg",profile_image_90:"https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--hOoqRh06--\u002Fc_fill,f_auto,fl_progressive,h_90,q_auto,w_90\u002Fhttps:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fuploads\u002Fuser\u002Fprofile_image\u002F497827\u002F8abb9931-172a-456f-8fa3-525618ac5c2d.jpeg"};c.organization={name:"AWS Community Builders ",username:f,slug:f,profile_image:"https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--zmOZQNzv--\u002Fc_fill,f_auto,fl_progressive,h_640,q_auto,w_640\u002Fhttps:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fuploads\u002Forganization\u002Fprofile_image\u002F2794\u002F88da75b6-aadd-4ea1-8083-ae2dfca8be94.png",profile_image_90:"https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--vWmcJ-ty--\u002Fc_fill,f_auto,fl_progressive,h_90,q_auto,w_90\u002Fhttps:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fuploads\u002Forganization\u002Fprofile_image\u002F2794\u002F88da75b6-aadd-4ea1-8083-ae2dfca8be94.png"};return {data:[{}],fetch:{"data-v-25febe66:0":{article:c}},mutations:[["SET_CURRENT_ARTICLE",c]]}}(null,"2021-08-14T12:27:03Z",{},17,"shardulsrivastava","aws-builders")));