__NUXT_JSONP__("/articles/nabbisen/757852", (function(a,b,c,d,e,f){c.type_of="article";c.id=757852;c.title="Rspamd installation and OpenSMTPD configuration on it on OpenBSD";c.description="Summary   Thanks to poolpOrg's filter-rspamd, Rspamd filter in OpenSMTPD is provided as...";c.readable_publish_date="Jul 17";c.slug="rspamd-installation-and-opensmtpd-configuration-on-it-on-openbsd-1p6i";c.path="\u002Fnabbisen\u002Frspamd-installation-and-opensmtpd-configuration-on-it-on-openbsd-1p6i";c.url=d;c.comments_count=0;c.public_reactions_count=e;c.collection_id=1265;c.published_timestamp=a;c.positive_reactions_count=e;c.cover_image=f;c.social_image="https:\u002F\u002Fdev.to\u002Fsocial_previews\u002Farticle\u002F757852.png";c.canonical_url=d;c.created_at="2021-07-13T07:18:31Z";c.edited_at="2021-07-19T03:05:42Z";c.crossposted_at=f;c.published_at=a;c.last_comment_at=a;c.reading_time_minutes=3;c.tag_list="rspamd, opensmtpd, openbsd, mailserver";c.tags=["rspamd","opensmtpd","openbsd","mailserver"];c.body_html="\u003Ch2\u003E\n  \u003Ca name=\"summary\" href=\"#summary\"\u003E\n  \u003C\u002Fa\u003E\n  Summary\n\u003C\u002Fh2\u003E\n\n\u003Cp\u003EThanks to \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FpoolpOrg\"\u003EpoolpOrg\u003C\u002Fa\u003E's \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FpoolpOrg\u002Ffilter-rspamd\"\u003Efilter-rspamd\u003C\u002Fa\u003E, \u003Ca href=\"https:\u002F\u002Frspamd.com\u002F\"\u003ERspamd\u003C\u002Fa\u003E filter in \u003Ca href=\"https:\u002F\u002Fwww.opensmtpd.org\u002F\"\u003EOpenSMTPD\u003C\u002Fa\u003E is provided as \u003Ca href=\"https:\u002F\u002Fwww.openbsd.org\u002Ffaq\u002Fports\u002Fports.html\"\u003EPorts\u003C\u002Fa\u003E package whose name is \u003Cbr\u003E\n\u003Ccode\u003Eopensmtpd-filter-rspamd\u003C\u002Fcode\u003E in OpenSMTPD 6.6.0 or higher. It means it has not been necessary any longer to use \u003Ca href=\"https:\u002F\u002Frspamd.com\u002Fdoc\u002Fquickstart.html#using-rspamc-console-routine#using-rspamc-console-routine\"\u003E\u003Ccode\u003Erspamc\u003C\u002Fcode\u003E\u003C\u002Fa\u003E in \u003Ca href=\"https:\u002F\u002Fman.openbsd.org\u002Fsmtpd.conf\"\u003Esmtpd.conf\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\n\u003Cp\u003EThis post shows how to install Rspamd and configure it on \u003Ca href=\"https:\u002F\u002Fwww.openbsd.org\u002F\"\u003EOpenBSD\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003Ch3\u003E\n  \u003Ca name=\"environment\" href=\"#environment\"\u003E\n  \u003C\u002Fa\u003E\n  Environment\n\u003C\u002Fh3\u003E\n\n\u003Cul\u003E\n\u003Cli\u003EServer OS: OpenBSD \u003Ca href=\"https:\u002F\u002Fwww.openbsd.org\u002F69.html\"\u003E6.9\u003C\u002Fa\u003E\n\u003C\u002Fli\u003E\n\u003Cli\u003EMTA (Mail transfer agent): OpenSMTPD 6.9\u003C\u002Fli\u003E\n\u003Cli\u003ESpam filtering system: Rspamd 2.7\u003C\u002Fli\u003E\n\u003Cli\u003ECommand line shell: \u003Ca href=\"https:\u002F\u002Ffishshell.com\u002F\"\u003EFish\u003C\u002Fa\u003E 3.2\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Ch2\u003E\n  \u003Ca name=\"tutorial\" href=\"#tutorial\"\u003E\n  \u003C\u002Fa\u003E\n  Tutorial\n\u003C\u002Fh2\u003E\n\n\u003Cp\u003EHere shows packages related to OpenSMTPD:\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight console\"\u003E\u003Ccode\u003E\u003Cspan class=\"gp\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003Edoas pkg_info \u003Cspan class=\"nt\"\u003E-Q\u003C\u002Fspan\u003E opensmtpd\n\u003Cspan class=\"go\"\u003Elibopensmtpd-0.6\nopensmtpd-extras-6.7.1v0\nopensmtpd-extras-mysql-6.7.1p0v0\nopensmtpd-extras-pgsql-6.7.1p0v0\nopensmtpd-extras-python-6.7.1v0\nopensmtpd-extras-redis-6.7.1v0\nopensmtpd-filter-admdscrub-0.1\nopensmtpd-filter-dkimsign-0.4\nopensmtpd-filter-dnsbl-0.2\nopensmtpd-filter-rspamd-0.1.7p0\nopensmtpd-filter-senderscore-0.1.1p0\nopensmtpd-filter-spamassassin-0.7p0\n\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003ESeveral extras and also several filters :)\u003C\u002Fp\u003E\n\n\n\u003Chr\u003E\n\n\u003Cp\u003EFirst, let's install Rspamd and also required packages, its OpenSMTPD filter and \u003Ca href=\"https:\u002F\u002Fredis.io\u002F\"\u003ERedis\u003C\u002Fa\u003E. Rspamd in OpenBSD is highly configured and ready to use Redis as database by default.\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight console\"\u003E\u003Ccode\u003E\u003Cspan class=\"gp\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003Edoas pkg_add rspamd redis opensmtpd-filter-rspamd\n\u003Cspan class=\"go\"\u003Equirks-3.633 signed on 2021-07-03T10:19:35Z\nAmbiguous: choose package for rspamd\n\u003C\u002Fspan\u003E\u003Cspan class=\"gp\"\u003E    0: &lt;None&gt;\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n\u003C\u002Fspan\u003E\u003Cspan class=\"go\"\u003E    1: rspamd-2.7p0\n    2: rspamd-2.7p0-hyperscan\nYour choice: 2\nrspamd-2.7p0-hyperscan:luajit-2.0.5p2: ok\nrspamd-2.7p0-hyperscan:gcc-libs-8.4.0p6: ok\nrspamd-2.7p0-hyperscan:blas-3.8.0p0: ok\nrspamd-2.7p0-hyperscan:cblas-1.0p7: ok\nrspamd-2.7p0-hyperscan:hyperscan-5.4.0-ssse3: ok\nuseradd: Warning: home directory `\u002Fvar\u002Fredis' doesn't exist, and -m was not specified\nrspamd-2.7p0-hyperscan:redis-6.2.1p0: ok\nrspamd-2.7p0-hyperscan: ok\nopensmtpd-filter-rspamd-0.1.7p0: ok\nThe following new rcscripts were installed: \u002Fetc\u002Frc.d\u002Fredis \u002Fetc\u002Frc.d\u002Frspamd\nSee rcctl(8) for details.\nNew and changed readme(s):\n    \u002Fusr\u002Flocal\u002Fshare\u002Fdoc\u002Fpkg-readmes\u002Fopensmtpd-filter-rspamd\n    \u002Fusr\u002Flocal\u002Fshare\u002Fdoc\u002Fpkg-readmes\u002Frspamd\n\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003EBesides, \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fintel\u002Fhyperscan\"\u003Ehyperscan\u003C\u002Fa\u003E is used as an option of \u003Ca href=\"https:\u002F\u002Frspamd.com\u002Fperformance.html#local-optimizations\"\u003Elocal optimizations\u003Cbr\u003E\n\u003C\u002Fa\u003E on Rspamd performance, which is developed by \u003Ca href=\"https:\u002F\u002Fwww.intel.com\u002F\"\u003EIntel\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\n\u003Cp\u003ENext, enable daemons.\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight console\"\u003E\u003Ccode\u003E\u003Cspan class=\"gp\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003Edoas rcctl \u003Cspan class=\"nb\"\u003Eenable\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E{\u003C\u002Fspan\u003Eredis, rspamd\u003Cspan class=\"o\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003EAnd run them.\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight console\"\u003E\u003Ccode\u003E\u003Cspan class=\"gp\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003Edoas rcctl start \u003Cspan class=\"o\"\u003E{\u003C\u002Fspan\u003Eredis, rspamd\u003Cspan class=\"o\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"go\"\u003Eredis(ok)\nrspamd(ok)\n\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\n\u003Chr\u003E\n\n\u003Cp\u003EIf you want to add custom configuration to Rspamd, it's available with \".conf\" files.\u003Cbr\u003E\nIn my case, I edited actions.conf to mitigate rejection by the filter.\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight console\"\u003E\u003Ccode\u003E\u003Cspan class=\"gp\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Ecd\u003C\u002Fspan\u003E \u002Fetc\u002Frspamd\u002Flocal.d\n\u003Cspan class=\"go\"\u003E\n\u003C\u002Fspan\u003E\u003Cspan class=\"gp\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Ecat\u003C\u002Fspan\u003E ..\u002Factions.conf\n\u003Cspan class=\"go\"\u003E(...)\nactions {\n\u003C\u002Fspan\u003E\u003Cspan class=\"gp\"\u003E    reject = 15;\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"c\"\u003E# Reject when reaching this score\u003C\u002Fspan\u003E\n\u003Cspan class=\"gp\"\u003E    add_header = 6;\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"c\"\u003E# Add header when reaching this score\u003C\u002Fspan\u003E\n\u003Cspan class=\"gp\"\u003E    greylist = 4;\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"c\"\u003E# Apply greylisting when reaching this score (will emit `soft reject action`)\u003C\u002Fspan\u003E\n\u003Cspan class=\"go\"\u003E(...)\n\u003C\u002Fspan\u003E\u003Cspan class=\"gp\"\u003E    .include(try=true;\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"nv\"\u003Epriority\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E1\u003Cspan class=\"p\"\u003E;\u003C\u002Fspan\u003E \u003Cspan class=\"nv\"\u003Eduplicate\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003Emerge\u003Cspan class=\"o\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"s2\"\u003E\"\u003C\u002Fspan\u003E\u003Cspan class=\"nv\"\u003E$LOCAL_CONFDIR\u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\u002Flocal.d\u002Factions.conf\"\u003C\u002Fspan\u003E\n\u003Cspan class=\"gp\"\u003E    .include(try=true;\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"nv\"\u003Epriority\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E10\u003Cspan class=\"o\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"s2\"\u003E\"\u003C\u002Fspan\u003E\u003Cspan class=\"nv\"\u003E$LOCAL_CONFDIR\u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\u002Foverride.d\u002Factions.conf\"\u003C\u002Fspan\u003E\n\u003Cspan class=\"go\"\u003E}\n\n\u003C\u002Fspan\u003E\u003Cspan class=\"gp\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003Edoas nvim actions.conf\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003EMy actions.conf in local.d is like this:\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight conf\"\u003E\u003Ccode\u003E\u003Cspan class=\"n\"\u003Ereject\u003C\u002Fspan\u003E = \u003Cspan class=\"m\"\u003E27\u003C\u002Fspan\u003E.\u003Cspan class=\"m\"\u003E0\u003C\u002Fspan\u003E;\n\u003Cspan class=\"n\"\u003Egreylist\u003C\u002Fspan\u003E = \u003Cspan class=\"m\"\u003E19\u003C\u002Fspan\u003E.\u003Cspan class=\"m\"\u003E0\u003C\u002Fspan\u003E;\n\u003Cspan class=\"n\"\u003Esubject\u003C\u002Fspan\u003E = \u003Cspan class=\"s2\"\u003E\"** Suspicious ** %s\"\u003C\u002Fspan\u003E\n\u003Cspan class=\"n\"\u003Erewrite_subject\u003C\u002Fspan\u003E = \u003Cspan class=\"m\"\u003E12\u003C\u002Fspan\u003E.\u003Cspan class=\"m\"\u003E0\u003C\u002Fspan\u003E;\n\u003Cspan class=\"n\"\u003Eadd_header\u003C\u002Fspan\u003E = \u003Cspan class=\"m\"\u003E7\u003C\u002Fspan\u003E.\u003Cspan class=\"m\"\u003E0\u003C\u002Fspan\u003E;\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003EWhen changing Rspamd configuration, it is necessary to restart the daemon:\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight console\"\u003E\u003Ccode\u003E\u003Cspan class=\"gp\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003Edoas rcctl restart rspamd\n\u003Cspan class=\"go\"\u003Erspamd(ok)\nrspamd(ok)\n\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\n\u003Chr\u003E\n\n\u003Cp\u003EThen, modify smtpd.conf in \u002Fetc\u002Fmail to \u003Ca href=\"https:\u002F\u002Fman.openbsd.org\u002Fsmtpd.conf#opensmtpd-filter-rspamd\"\u003Eexecute (\u003Ccode\u003Eproc-exec\u003C\u002Fcode\u003E) the filter\u003C\u002Fa\u003E.\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight console\"\u003E\u003Ccode\u003E\u003Cspan class=\"gp\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"nb\"\u003Ecd\u003C\u002Fspan\u003E \u002Fetc\u002Fmail\n\u003Cspan class=\"go\"\u003E\n\u003C\u002Fspan\u003E\u003Cspan class=\"gp\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"c\"\u003E# create a backup if necessary:\u003C\u002Fspan\u003E\n\u003Cspan class=\"gp\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003Edoas \u003Cspan class=\"nb\"\u003Ecp\u003C\u002Fspan\u003E \u003Cspan class=\"nt\"\u003E-p\u003C\u002Fspan\u003E smtpd.conf smtpd.conf.bak\n\u003Cspan class=\"go\"\u003E\n\u003C\u002Fspan\u003E\u003Cspan class=\"gp\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003Edoas nvim smtpd.conf\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003EAdd these lines:\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight diff\"\u003E\u003Ccode\u003E  (...)\n\u003Cspan class=\"gi\"\u003E+ filter \"rspamd\" \\\n+   proc-exec \"filter-rspamd\"\n\u003C\u002Fspan\u003E  (...)\n  listen on egress \\\n    tls \\\n    pki (...) \\\n    auth-optional \\\n\u003Cspan class=\"gi\"\u003E+   filter { \"rspamd\" } \\\n\u003C\u002Fspan\u003E    tag MTA\n  (...)\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003EJust 3 lines :)\u003Cbr\u003E\nWell, here, I actually added more lines:\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight diff\"\u003E\u003Ccode\u003E\u003Cspan class=\"gi\"\u003E+ filter \"check_dyndns\" \\\n+   phase connect match rdns regex { '.*\\.dyn\\..*', '.*\\.dsl\\..*' } \\\n+   disconnect \"550 no residential connections\"\n+ filter \"check_rdns\" \\\n+   phase connect match !rdns \\\n+   disconnect \"550 no rDNS\"\n+ filter \"check_fcrdns\" \\\n+   phase connect match !fcrdns \\\n+   disconnect \"550 no FCrDNS\"\n\u003C\u002Fspan\u003E  filter \"rspamd\" \\\n    proc-exec \"filter-rspamd\"\n  (...)\n\u003Cspan class=\"gd\"\u003E-   filter { \"rspamd\" } \\\n\u003C\u002Fspan\u003E\u003Cspan class=\"gi\"\u003E+   filter { \"check_dyndns\", \"check_rdns\", \"check_fcrdns\", \"rspamd\" } \\\n\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003EThe 3 filters are builtin ones in OpenSMTPD.\u003C\u002Fp\u003E\n\n\u003Cp\u003EFinally, restart the smtpd daemon:\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight console\"\u003E\u003Ccode\u003E\u003Cspan class=\"gp\"\u003E$\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003Edoas rcctl restart smtpd\n\u003Cspan class=\"go\"\u003Esmtpd(ok)\nsmtpd(ok)\n\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003ENow OpenSMTPD calls Rspamd while transfering messages and the filter results are being stored in Redis.\u003Cbr\u003E\nHope your trouble on spams and scams will get remarkably less.\u003C\u002Fp\u003E\n\n\u003Ch2\u003E\n  \u003Ca name=\"acknowledgments\" href=\"#acknowledgments\"\u003E\n  \u003C\u002Fa\u003E\n  Acknowledgments\n\u003C\u002Fh2\u003E\n\n\u003Cp\u003EI appeciate the \u003Ca href=\"https:\u002F\u002Ftwitter.com\u002Fpoolporg\"\u003EGilles\u003C\u002Fa\u003E (poolp) 's great article:\u003C\u002Fp\u003E\n\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fpoolp.org\u002Fposts\u002F2019-09-14\u002Fsetting-up-a-mail-server-with-opensmtpd-dovecot-and-rspamd\u002F\"\u003Ehttps:\u002F\u002Fpoolp.org\u002Fposts\u002F2019-09-14\u002Fsetting-up-a-mail-server-with-opensmtpd-dovecot-and-rspamd\u002F\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\n\u003Cp\u003EIt enabled me to set up Rspamd working well with OpenSMTPD at last.\u003C\u002Fp\u003E\n\n";c.body_markdown="## Summary\n\nThanks to [poolpOrg](https:\u002F\u002Fgithub.com\u002FpoolpOrg)'s [filter-rspamd](https:\u002F\u002Fgithub.com\u002FpoolpOrg\u002Ffilter-rspamd), [Rspamd](https:\u002F\u002Frspamd.com\u002F) filter in [OpenSMTPD](https:\u002F\u002Fwww.opensmtpd.org\u002F) is provided as [Ports](https:\u002F\u002Fwww.openbsd.org\u002Ffaq\u002Fports\u002Fports.html) package whose name is \n`opensmtpd-filter-rspamd` in OpenSMTPD 6.6.0 or higher. It means it has not been necessary any longer to use [`rspamc`](https:\u002F\u002Frspamd.com\u002Fdoc\u002Fquickstart.html#using-rspamc-console-routine#using-rspamc-console-routine) in [smtpd.conf](https:\u002F\u002Fman.openbsd.org\u002Fsmtpd.conf).\n\nThis post shows how to install Rspamd and configure it on [OpenBSD](https:\u002F\u002Fwww.openbsd.org\u002F).\n\n### Environment\n\n- Server OS: OpenBSD [6.9](https:\u002F\u002Fwww.openbsd.org\u002F69.html)\n- MTA (Mail transfer agent): OpenSMTPD 6.9\n- Spam filtering system: Rspamd 2.7\n- Command line shell: [Fish](https:\u002F\u002Ffishshell.com\u002F) 3.2\n\n## Tutorial\n\nHere shows packages related to OpenSMTPD:\n\n```console\n$ doas pkg_info -Q opensmtpd\nlibopensmtpd-0.6\nopensmtpd-extras-6.7.1v0\nopensmtpd-extras-mysql-6.7.1p0v0\nopensmtpd-extras-pgsql-6.7.1p0v0\nopensmtpd-extras-python-6.7.1v0\nopensmtpd-extras-redis-6.7.1v0\nopensmtpd-filter-admdscrub-0.1\nopensmtpd-filter-dkimsign-0.4\nopensmtpd-filter-dnsbl-0.2\nopensmtpd-filter-rspamd-0.1.7p0\nopensmtpd-filter-senderscore-0.1.1p0\nopensmtpd-filter-spamassassin-0.7p0\n```\n\nSeveral extras and also several filters :)\n\n---\n\nFirst, let's install Rspamd and also required packages, its OpenSMTPD filter and [Redis](https:\u002F\u002Fredis.io\u002F). Rspamd in OpenBSD is highly configured and ready to use Redis as database by default.\n\n```console\n$ doas pkg_add rspamd redis opensmtpd-filter-rspamd\nquirks-3.633 signed on 2021-07-03T10:19:35Z\nAmbiguous: choose package for rspamd\n \t0: \u003CNone\u003E\n\t1: rspamd-2.7p0\n\t2: rspamd-2.7p0-hyperscan\nYour choice: 2\nrspamd-2.7p0-hyperscan:luajit-2.0.5p2: ok\nrspamd-2.7p0-hyperscan:gcc-libs-8.4.0p6: ok\nrspamd-2.7p0-hyperscan:blas-3.8.0p0: ok\nrspamd-2.7p0-hyperscan:cblas-1.0p7: ok\nrspamd-2.7p0-hyperscan:hyperscan-5.4.0-ssse3: ok\nuseradd: Warning: home directory `\u002Fvar\u002Fredis' doesn't exist, and -m was not specified\nrspamd-2.7p0-hyperscan:redis-6.2.1p0: ok\nrspamd-2.7p0-hyperscan: ok\nopensmtpd-filter-rspamd-0.1.7p0: ok\nThe following new rcscripts were installed: \u002Fetc\u002Frc.d\u002Fredis \u002Fetc\u002Frc.d\u002Frspamd\nSee rcctl(8) for details.\nNew and changed readme(s):\n\t\u002Fusr\u002Flocal\u002Fshare\u002Fdoc\u002Fpkg-readmes\u002Fopensmtpd-filter-rspamd\n\t\u002Fusr\u002Flocal\u002Fshare\u002Fdoc\u002Fpkg-readmes\u002Frspamd\n```\n\nBesides, [hyperscan](https:\u002F\u002Fgithub.com\u002Fintel\u002Fhyperscan) is used as an option of [local optimizations\n](https:\u002F\u002Frspamd.com\u002Fperformance.html#local-optimizations) on Rspamd performance, which is developed by [Intel](https:\u002F\u002Fwww.intel.com\u002F).\n\nNext, enable daemons.\n\n```console\n$ doas rcctl enable {redis, rspamd}\n```\n\nAnd run them.\n\n```console\n$ doas rcctl start {redis, rspamd}\nredis(ok)\nrspamd(ok)\n```\n\n---\n\nIf you want to add custom configuration to Rspamd, it's available with \".conf\" files.\nIn my case, I edited actions.conf to mitigate rejection by the filter.\n\n```console\n$ cd \u002Fetc\u002Frspamd\u002Flocal.d\n\n$ cat ..\u002Factions.conf\n(...)\nactions {\n    reject = 15; # Reject when reaching this score\n    add_header = 6; # Add header when reaching this score\n    greylist = 4; # Apply greylisting when reaching this score (will emit `soft reject action`)\n(...)\n    .include(try=true; priority=1; duplicate=merge) \"$LOCAL_CONFDIR\u002Flocal.d\u002Factions.conf\"\n    .include(try=true; priority=10) \"$LOCAL_CONFDIR\u002Foverride.d\u002Factions.conf\"\n}\n\n$ doas nvim actions.conf\n```\n\nMy actions.conf in local.d is like this:\n\n```config\nreject = 27.0;\ngreylist = 19.0;\nsubject = \"** Suspicious ** %s\"\nrewrite_subject = 12.0;\nadd_header = 7.0;\n```\n\nWhen changing Rspamd configuration, it is necessary to restart the daemon:\n\n```console\n$ doas rcctl restart rspamd\nrspamd(ok)\nrspamd(ok)\n```\n\n---\n\nThen, modify smtpd.conf in \u002Fetc\u002Fmail to [execute (`proc-exec`) the filter](https:\u002F\u002Fman.openbsd.org\u002Fsmtpd.conf#opensmtpd-filter-rspamd).\n\n```console\n$ cd \u002Fetc\u002Fmail\n\n$ # create a backup if necessary:\n$ doas cp -p smtpd.conf smtpd.conf.bak\n\n$ doas nvim smtpd.conf\n```\n\nAdd these lines:\n\n```diff\n  (...)\n+ filter \"rspamd\" \\\n+ \tproc-exec \"filter-rspamd\"\n  (...)\n  listen on egress \\\n  \ttls \\\n  \tpki (...) \\\n  \tauth-optional \\\n+ \tfilter { \"rspamd\" } \\\n  \ttag MTA\n  (...)\n```\n\nJust 3 lines :)\nWell, here, I actually added more lines:\n\n```diff\n+ filter \"check_dyndns\" \\\n+ \tphase connect match rdns regex { '.*\\.dyn\\..*', '.*\\.dsl\\..*' } \\\n+ \tdisconnect \"550 no residential connections\"\n+ filter \"check_rdns\" \\\n+ \tphase connect match !rdns \\\n+ \tdisconnect \"550 no rDNS\"\n+ filter \"check_fcrdns\" \\\n+ \tphase connect match !fcrdns \\\n+ \tdisconnect \"550 no FCrDNS\"\n  filter \"rspamd\" \\\n  \tproc-exec \"filter-rspamd\"\n  (...)\n- \tfilter { \"rspamd\" } \\\n+ \tfilter { \"check_dyndns\", \"check_rdns\", \"check_fcrdns\", \"rspamd\" } \\\n```\n\nThe 3 filters are builtin ones in OpenSMTPD.\n\nFinally, restart the smtpd daemon:\n\n```console\n$ doas rcctl restart smtpd\nsmtpd(ok)\nsmtpd(ok)\n```\n\nNow OpenSMTPD calls Rspamd while transfering messages and the filter results are being stored in Redis.\nHope your trouble on spams and scams will get remarkably less.\n\n## Acknowledgments\n\nI appeciate the [Gilles](https:\u002F\u002Ftwitter.com\u002Fpoolporg) (poolp) 's great article:\n\nhttps:\u002F\u002Fpoolp.org\u002Fposts\u002F2019-09-14\u002Fsetting-up-a-mail-server-with-opensmtpd-dovecot-and-rspamd\u002F\n\nIt enabled me to set up Rspamd working well with OpenSMTPD at last.";c.user={name:"Heddi Nabbisen",username:b,twitter_username:b,github_username:b,website_url:"https:\u002F\u002Fwww.scqr.net\u002F",profile_image:"https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--nPL1JIPv--\u002Fc_fill,f_auto,fl_progressive,h_640,q_auto,w_640\u002Fhttps:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fuploads\u002Fuser\u002Fprofile_image\u002F87972\u002Fa3543f5f-7054-4b0b-a2cd-7dea7ec97a2a.jpeg",profile_image_90:"https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--p1iewG1e--\u002Fc_fill,f_auto,fl_progressive,h_90,q_auto,w_90\u002Fhttps:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fuploads\u002Fuser\u002Fprofile_image\u002F87972\u002Fa3543f5f-7054-4b0b-a2cd-7dea7ec97a2a.jpeg"};return {data:[{}],fetch:{"data-v-25febe66:0":{article:c}},mutations:[["SET_CURRENT_ARTICLE",c]]}}("2021-07-17T02:59:48Z","nabbisen",{},"https:\u002F\u002Fdev.to\u002Fnabbisen\u002Frspamd-installation-and-opensmtpd-configuration-on-it-on-openbsd-1p6i",1,null)));