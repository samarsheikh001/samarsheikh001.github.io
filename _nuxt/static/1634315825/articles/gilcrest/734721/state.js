window.__NUXT__=(function(a,b,c,d){return {staticAssetsBase:"\u002F_nuxt\u002Fstatic\u002F1634315825",layout:"default",error:a,state:{currentArticle:{type_of:"article",id:734721,title:"REST API Error Handling in Go",description:"Handling errors is really important in Go. Errors are first class citizens and there are many...",readable_publish_date:"Jun 21",slug:"rest-api-error-handling-in-go-14hn",path:"\u002Fgilcrest\u002Frest-api-error-handling-in-go-14hn",url:"https:\u002F\u002Fdev.to\u002Fgilcrest\u002Frest-api-error-handling-in-go-14hn",comments_count:0,public_reactions_count:c,collection_id:13627,published_timestamp:b,positive_reactions_count:c,cover_image:"https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--yI8fL9hS--\u002Fc_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000\u002Fhttps:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fuploads\u002Farticles\u002F3nqjuhzmu3ypitmd8o10.png",social_image:"https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--L68iAAS8--\u002Fc_imagga_scale,f_auto,fl_progressive,h_500,q_auto,w_1000\u002Fhttps:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fuploads\u002Farticles\u002F3nqjuhzmu3ypitmd8o10.png",canonical_url:"https:\u002F\u002Fdangillis.dev\u002Fposts\u002Ferrors\u002F",created_at:b,edited_at:"2021-08-27T20:19:11Z",crossposted_at:a,published_at:b,last_comment_at:b,reading_time_minutes:9,tag_list:"go, errors, restapi",tags:["go","errors","restapi"],body_html:"\u003Cp\u003EHandling errors is really important in Go. Errors are first class citizens and there are many different approaches for handling them. Initially I started off basing my error handling almost entirely on a \u003Ca href=\"https:\u002F\u002Fcommandcenter.blogspot.com\u002F2017\u002F12\u002Ferror-handling-in-upspin.html\"\u003Eblog post from Rob Pike\u003C\u002Fa\u003E and created a carve-out from his code to meet my needs. It served me well for a long time, but found over time I wanted a way to easily get a stacktrace of the error, which led me to Dave Cheney's \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fpkg\u002Ferrors\"\u003Ehttps:\u002F\u002Fgithub.com\u002Fpkg\u002Ferrors\u003C\u002Fa\u003E package. I now use a combination of the two. The implementation below is sourced from my \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fgilcrest\u002Fgo-api-basic\"\u003Ego-api-basic\u003C\u002Fa\u003E repo, indeed, this post will be folded into its \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fgilcrest\u002Fgo-api-basic#errors\"\u003EREADME\u003C\u002Fa\u003E as well.\u003C\u002Fp\u003E\n\n\u003Ch2\u003E\n  \u003Ca name=\"requirements\" href=\"#requirements\"\u003E\n  \u003C\u002Fa\u003E\n  Requirements\n\u003C\u002Fh2\u003E\n\n\u003Cp\u003EMy requirements for REST API error handling are the following:\u003C\u002Fp\u003E\n\n\u003Cul\u003E\n\u003Cli\u003ERequests for users who are \u003Cem\u003Enot\u003C\u002Fem\u003E properly \u003Cstrong\u003E\u003Cem\u003Eauthenticated\u003C\u002Fem\u003E\u003C\u002Fstrong\u003E should return a \u003Ccode\u003E401 Unauthorized\u003C\u002Fcode\u003E error with a \u003Ccode\u003EWWW-Authenticate\u003C\u002Fcode\u003E response header and an empty response body.\u003C\u002Fli\u003E\n\u003Cli\u003ERequests for users who are authenticated, but do not have permission to access the resource, should return a \u003Ccode\u003E403 Forbidden\u003C\u002Fcode\u003E error with an empty response body.\u003C\u002Fli\u003E\n\u003Cli\u003EAll requests which are due to a client error (invalid data, malformed JSON, etc.) should return a \u003Ccode\u003E400 Bad Request\u003C\u002Fcode\u003E and a response body which looks similar to the following:\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight json\"\u003E\u003Ccode\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n    \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"error\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n        \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"kind\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"input_validation_error\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n        \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"param\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"director\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n        \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"message\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"director is required\"\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n    \u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cul\u003E\n\u003Cli\u003EAll requests which incur errors as a result of an internal server or database error should return a \u003Ccode\u003E500 Internal Server Error\u003C\u002Fcode\u003E and not leak any information about the database or internal systems to the client. These errors should return a response body which looks like the following:\n\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight json\"\u003E\u003Ccode\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n    \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"error\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n        \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"kind\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"internal_error\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n        \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"message\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"internal server error - please contact support\"\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n    \u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003EAll errors should return a \u003Ccode\u003ERequest-Id\u003C\u002Fcode\u003E response header with a unique request id that can be used for debugging to find the corresponding error in logs.\u003C\u002Fp\u003E\n\n\u003Ch2\u003E\n  \u003Ca name=\"implementation\" href=\"#implementation\"\u003E\n  \u003C\u002Fa\u003E\n  Implementation\n\u003C\u002Fh2\u003E\n\n\u003Cp\u003EAll errors should be raised using custom errors from the \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fgilcrest\u002Fgo-api-basic\u002Ftree\u002Fmain\u002Fdomain\u002Ferrs\"\u003Edomain\u002Ferrs\u003C\u002Fa\u003E package. The three custom errors correspond directly to the requirements above.\u003C\u002Fp\u003E\n\n\u003Ch3\u003E\n  \u003Ca name=\"typical-errors\" href=\"#typical-errors\"\u003E\n  \u003C\u002Fa\u003E\n  Typical Errors\n\u003C\u002Fh3\u003E\n\n\u003Cp\u003ETypically, errors raised throughout \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fgilcrest\u002Fgo-api-basic\"\u003Ego-api-basic\u003C\u002Fa\u003E are the custom \u003Ccode\u003Eerrs.Error\u003C\u002Fcode\u003E, which looks like:\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight go\"\u003E\u003Ccode\u003E\u003Cspan class=\"k\"\u003Etype\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EError\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"c\"\u003E\u002F\u002F User is the username of the user attempting the operation.\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EUser\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EUserName\u003C\u002Fspan\u003E\n    \u003Cspan class=\"c\"\u003E\u002F\u002F Kind is the class of error, such as permission failure,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"c\"\u003E\u002F\u002F or \"Other\" if its class is unknown or irrelevant.\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EKind\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EKind\u003C\u002Fspan\u003E\n    \u003Cspan class=\"c\"\u003E\u002F\u002F Param represents the parameter related to the error.\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EParam\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EParameter\u003C\u002Fspan\u003E\n    \u003Cspan class=\"c\"\u003E\u002F\u002F Code is a human-readable, short representation of the error\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003ECode\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ECode\u003C\u002Fspan\u003E\n    \u003Cspan class=\"c\"\u003E\u002F\u002F The underlying error that triggered this one, if any.\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EErr\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eerror\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003EThese errors are raised using the \u003Ccode\u003EE\u003C\u002Fcode\u003E function from the \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fgilcrest\u002Fgo-api-basic\u002Ftree\u002Fmain\u002Fdomain\u002Ferrs\"\u003Edomain\u002Ferrs\u003C\u002Fa\u003E package. \u003Ccode\u003Eerrs.E\u003C\u002Fcode\u003E is taken from Rob Pike's \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fupspin\u002Fupspin\u002Ftree\u002Fmaster\u002Ferrors\"\u003Eupspin errors package\u003C\u002Fa\u003E (but has been changed based on my requirements). The \u003Ccode\u003Eerrs.E\u003C\u002Fcode\u003E function call is \u003Ca href=\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FVariadic\"\u003Evariadic\u003C\u002Fa\u003E and can take several different types to form the custom \u003Ccode\u003Eerrs.Error\u003C\u002Fcode\u003E struct.\u003C\u002Fp\u003E\n\n\u003Cp\u003EHere is a simple example of creating an \u003Ccode\u003Eerror\u003C\u002Fcode\u003E using \u003Ccode\u003Eerrs.E\u003C\u002Fcode\u003E:\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight go\"\u003E\u003Ccode\u003E\u003Cspan class=\"n\"\u003Eerr\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E:=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eerrs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EE\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E\"seems we have an error here\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003EWhen a string is sent, an error will be created using the \u003Ccode\u003Eerrors.New\u003C\u002Fcode\u003E function from \u003Ccode\u003Egithub.com\u002Fpkg\u002Ferrors\u003C\u002Fcode\u003E and added to the \u003Ccode\u003EErr\u003C\u002Fcode\u003E element of the struct, which allows retrieval of the error stacktrace later on. In the above example, \u003Ccode\u003EUser\u003C\u002Fcode\u003E, \u003Ccode\u003EKind\u003C\u002Fcode\u003E, \u003Ccode\u003EParam\u003C\u002Fcode\u003E and \u003Ccode\u003ECode\u003C\u002Fcode\u003E would all remain unset.\u003C\u002Fp\u003E\n\n\u003Cp\u003EYou can set any of these custom \u003Ccode\u003Eerrs.Error\u003C\u002Fcode\u003E fields that you like, for example:\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight go\"\u003E\u003Ccode\u003E\u003Cspan class=\"k\"\u003Efunc\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Em\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EMovie\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ESetReleased\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Er\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EMovie\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eerror\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Et\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eerr\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E:=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Etime\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EParse\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Etime\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ERFC3339\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Er\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eerr\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E!=\u003C\u002Fspan\u003E \u003Cspan class=\"no\"\u003Enil\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"no\"\u003Enil\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eerrs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EE\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eerrs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EValidation\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\n            \u003Cspan class=\"n\"\u003Eerrs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECode\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E\"invalid_date_format\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E\n            \u003Cspan class=\"n\"\u003Eerrs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EParameter\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E\"release_date\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E\n            \u003Cspan class=\"n\"\u003Eerr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Em\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EReleased\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Et\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Em\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"no\"\u003Enil\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003EAbove, we used \u003Ccode\u003Eerrs.Validation\u003C\u002Fcode\u003E to set the \u003Ccode\u003Eerrs.Kind\u003C\u002Fcode\u003E as \u003Ccode\u003EValidation\u003C\u002Fcode\u003E. Valid error \u003Ccode\u003EKind\u003C\u002Fcode\u003E are:\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight go\"\u003E\u003Ccode\u003E\u003Cspan class=\"k\"\u003Econst\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EOther\u003C\u002Fspan\u003E           \u003Cspan class=\"n\"\u003EKind\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"no\"\u003Eiota\u003C\u002Fspan\u003E \u003Cspan class=\"c\"\u003E\u002F\u002F Unclassified error. This value is not printed in the error message.\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EInvalid\u003C\u002Fspan\u003E                     \u003Cspan class=\"c\"\u003E\u002F\u002F Invalid operation for this type of item.\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EIO\u003C\u002Fspan\u003E                          \u003Cspan class=\"c\"\u003E\u002F\u002F External I\u002FO error such as network failure.\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EExist\u003C\u002Fspan\u003E                       \u003Cspan class=\"c\"\u003E\u002F\u002F Item already exists.\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003ENotExist\u003C\u002Fspan\u003E                    \u003Cspan class=\"c\"\u003E\u002F\u002F Item does not exist.\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EPrivate\u003C\u002Fspan\u003E                     \u003Cspan class=\"c\"\u003E\u002F\u002F Information withheld.\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EInternal\u003C\u002Fspan\u003E                    \u003Cspan class=\"c\"\u003E\u002F\u002F Internal error or inconsistency.\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EBrokenLink\u003C\u002Fspan\u003E                  \u003Cspan class=\"c\"\u003E\u002F\u002F Link target does not exist.\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EDatabase\u003C\u002Fspan\u003E                    \u003Cspan class=\"c\"\u003E\u002F\u002F Error from database.\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EValidation\u003C\u002Fspan\u003E                  \u003Cspan class=\"c\"\u003E\u002F\u002F Input validation error.\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EUnanticipated\u003C\u002Fspan\u003E               \u003Cspan class=\"c\"\u003E\u002F\u002F Unanticipated error.\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EInvalidRequest\u003C\u002Fspan\u003E              \u003Cspan class=\"c\"\u003E\u002F\u002F Invalid Request\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003E\u003Ccode\u003Eerrs.Code\u003C\u002Fcode\u003E represents a short code to respond to the client with for error handling based on codes (if you choose to do this) and is any string you want to pass.\u003C\u002Fp\u003E\n\n\u003Cp\u003E\u003Ccode\u003Eerrs.Parameter\u003C\u002Fcode\u003E represents the parameter that is being validated or has problems, etc.\u003C\u002Fp\u003E\n\n\u003Cblockquote\u003E\n\u003Cp\u003ENote in the above example, instead of passing a string and creating a new error inside the \u003Ccode\u003Eerrs.E\u003C\u002Fcode\u003E function, I am directly passing the error returned by the \u003Ccode\u003Etime.Parse\u003C\u002Fcode\u003E function to \u003Ccode\u003Eerrs.E\u003C\u002Fcode\u003E. The error is then added to the \u003Ccode\u003EErr\u003C\u002Fcode\u003E field using \u003Ccode\u003Eerrors.WithStack\u003C\u002Fcode\u003E from the \u003Ccode\u003Egithub.com\u002Fpkg\u002Ferrors\u003C\u002Fcode\u003E package. This will enable stacktrace retrieval later as well.\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\n\u003Cp\u003EThere are a few helpers in the \u003Ccode\u003Eerrs\u003C\u002Fcode\u003E package as well, namely the \u003Ccode\u003Eerrs.MissingField\u003C\u002Fcode\u003E function which can be used when validating missing input on a field. This idea comes from \u003Ca href=\"https:\u002F\u002Fmedium.com\u002F@matryer\u002Fpatterns-for-decoding-and-validating-input-in-go-data-apis-152291ac7372\"\u003Ethis Mat Ryer post\u003C\u002Fa\u003E and is pretty handy.\u003C\u002Fp\u003E\n\n\u003Cp\u003EHere is an example in practice:\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight go\"\u003E\u003Ccode\u003E\u003Cspan class=\"c\"\u003E\u002F\u002F IsValid performs validation of the struct\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Efunc\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Em\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EMovie\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EIsValid\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eerror\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eswitch\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Ecase\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Em\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ETitle\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E\"\"\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eerrs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EE\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Eerrs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EValidation\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eerrs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EParameter\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E\"title\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eerrs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EMissingField\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E\"title\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E))\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003EThe error message for the above would read \u003Cstrong\u003Etitle is required\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\n\u003Cp\u003EThere is also \u003Ccode\u003Eerrs.InputUnwanted\u003C\u002Fcode\u003E which is meant to be used when a field is populated with a value when it is not supposed to be.\u003C\u002Fp\u003E\n\n\u003Ch3\u003E\n  \u003Ca name=\"typical-error-flow\" href=\"#typical-error-flow\"\u003E\n  \u003C\u002Fa\u003E\n  Typical Error Flow\n\u003C\u002Fh3\u003E\n\n\u003Cp\u003EAs errors created with \u003Ccode\u003Eerrs.E\u003C\u002Fcode\u003E move up the call stack, they can just be returned, like the following:\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight go\"\u003E\u003Ccode\u003E\u003Cspan class=\"k\"\u003Efunc\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Einner\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eerror\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eerrs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EE\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"s\"\u003E\"seems we have an error here\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"k\"\u003Efunc\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emiddle\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eerror\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eerr\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E:=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Einner\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eerr\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E!=\u003C\u002Fspan\u003E \u003Cspan class=\"no\"\u003Enil\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eerr\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"no\"\u003Enil\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"k\"\u003Efunc\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eouter\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eerror\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eerr\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E:=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Emiddle\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E()\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eerr\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E!=\u003C\u002Fspan\u003E \u003Cspan class=\"no\"\u003Enil\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n        \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eerr\u003C\u002Fspan\u003E\n    \u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"no\"\u003Enil\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cblockquote\u003E\n\u003Cp\u003EIn the above example, the error is created in the \u003Ccode\u003Einner\u003C\u002Fcode\u003E function - \u003Ccode\u003Emiddle\u003C\u002Fcode\u003E and \u003Ccode\u003Eouter\u003C\u002Fcode\u003E return the error as is typical in Go.\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\n\u003Cp\u003EYou can add additional context fields (\u003Ccode\u003Eerrs.Code\u003C\u002Fcode\u003E, \u003Ccode\u003Eerrs.Parameter\u003C\u002Fcode\u003E, \u003Ccode\u003Eerrs.Kind\u003C\u002Fcode\u003E) as the error moves up the stack, however, I try to add as much context as possible at the point of error origin and only do this in rare cases.\u003C\u002Fp\u003E\n\n\u003Ch3\u003E\n  \u003Ca name=\"handler-flow\" href=\"#handler-flow\"\u003E\n  \u003C\u002Fa\u003E\n  Handler Flow\n\u003C\u002Fh3\u003E\n\n\u003Cp\u003EAt the top of the program flow for each service is the app service handler (for example, \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fgilcrest\u002Fgo-api-basic\u002Fblob\u002Fmain\u002Fapp\u002Fhandlers.go\"\u003EServer.handleMovieCreate\u003C\u002Fa\u003E). In this handler, any error returned from any function or method is sent through the \u003Ccode\u003Eerrs.HTTPErrorResponse\u003C\u002Fcode\u003E function along with the \u003Ccode\u003Ehttp.ResponseWriter\u003C\u002Fcode\u003E and a \u003Ccode\u003Ezerolog.Logger\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\n\u003Cp\u003EFor example:\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight go\"\u003E\u003Ccode\u003E\u003Cspan class=\"n\"\u003Eresponse\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eerr\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E:=\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Es\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECreateMovieService\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003ECreate\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Er\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EContext\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(),\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Erb\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eu\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Eif\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eerr\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E!=\u003C\u002Fspan\u003E \u003Cspan class=\"no\"\u003Enil\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003Eerrs\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EHTTPErrorResponse\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Ew\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Elogger\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eerr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003E\u003Ccode\u003Eerrs.HTTPErrorResponse\u003C\u002Fcode\u003E takes the custom error (\u003Ccode\u003Eerrs.Error\u003C\u002Fcode\u003E, \u003Ccode\u003Eerrs.Unauthenticated\u003C\u002Fcode\u003E or \u003Ccode\u003Eerrs.UnauthorizedError\u003C\u002Fcode\u003E), writes the response to the given \u003Ccode\u003Ehttp.ResponseWriter\u003C\u002Fcode\u003E and logs the error using the given \u003Ccode\u003Ezerolog.Logger\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\n\u003Cblockquote\u003E\n\u003Cp\u003E\u003Ccode\u003Ereturn\u003C\u002Fcode\u003E must be called immediately after \u003Ccode\u003Eerrs.HTTPErrorResponse\u003C\u002Fcode\u003E to return the error to the client.\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\n\u003Ch4\u003E\n  \u003Ca name=\"typical-error-response\" href=\"#typical-error-response\"\u003E\n  \u003C\u002Fa\u003E\n  Typical Error Response\n\u003C\u002Fh4\u003E\n\n\u003Cp\u003EFor the \u003Ccode\u003Eerrs.Error\u003C\u002Fcode\u003E type, \u003Ccode\u003Eerrs.HTTPErrorResponse\u003C\u002Fcode\u003E writes the HTTP response body as JSON using the \u003Ccode\u003Eerrs.ErrResponse\u003C\u002Fcode\u003E struct.\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight go\"\u003E\u003Ccode\u003E\u003Cspan class=\"c\"\u003E\u002F\u002F ErrResponse is used as the Response Body\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Etype\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EErrResponse\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EError\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EServiceError\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E`json:\"error\"`\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"c\"\u003E\u002F\u002F ServiceError has fields for Service errors. All fields with no data will\u003C\u002Fspan\u003E\n\u003Cspan class=\"c\"\u003E\u002F\u002F be omitted\u003C\u002Fspan\u003E\n\u003Cspan class=\"k\"\u003Etype\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EServiceError\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EKind\u003C\u002Fspan\u003E    \u003Cspan class=\"kt\"\u003Estring\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E`json:\"kind,omitempty\"`\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003ECode\u003C\u002Fspan\u003E    \u003Cspan class=\"kt\"\u003Estring\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E`json:\"code,omitempty\"`\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EParam\u003C\u002Fspan\u003E   \u003Cspan class=\"kt\"\u003Estring\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E`json:\"param,omitempty\"`\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EMessage\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Estring\u003C\u002Fspan\u003E \u003Cspan class=\"s\"\u003E`json:\"message,omitempty\"`\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003EWhen the error is returned to the client, the response body JSON looks like the following:\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight json\"\u003E\u003Ccode\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n    \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"error\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n        \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"kind\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"input_validation_error\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n        \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"code\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"invalid_date_format\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n        \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"param\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"release_date\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n        \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"message\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"parsing time \u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\\"\u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E1984a-03-02T00:00:00Z\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\\"\u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E as \u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\\"\u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E2006-01-02T15:04:05Z07:00\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\\"\u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E: cannot parse \u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\\"\u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003Ea-03-02T00:00:00Z\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\\"\u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E as \u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\\"\u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\\"\u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n    \u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003EIn addition, the error is logged. If \u003Ccode\u003Ezerolog.ErrorStackMarshaler\u003C\u002Fcode\u003E is set to log error stacks (more about this in a later post), the logger will log the full error stack, which can be super helpful when trying to identify issues.\u003C\u002Fp\u003E\n\n\u003Cp\u003EThe error log will look like the following (\u003Cem\u003EI cut off parts of the stack for brevity\u003C\u002Fem\u003E):\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight json\"\u003E\u003Ccode\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n    \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"level\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"error\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n    \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"ip\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"127.0.0.1\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n    \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"user_agent\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"PostmanRuntime\u002F7.26.8\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n    \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"request_id\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"bvol0mtnf4q269hl3ra0\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n    \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"stack\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E[{\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n        \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"func\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"E\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n        \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"line\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"172\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n        \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"source\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"errs.go\"\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n    \u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E},\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n        \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"func\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"(*Movie).SetReleased\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n        \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"line\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"76\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n        \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"source\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"movie.go\"\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n    \u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E},\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n        \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"func\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"(*MovieController).CreateMovie\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n        \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"line\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"139\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n        \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"source\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"create.go\"\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n    \u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E},\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n    \u003C\u002Fspan\u003E\u003Cspan class=\"err\"\u003E...\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n    \u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}],\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n    \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"error\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"parsing time \u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\\"\u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E1984a-03-02T00:00:00Z\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\\"\u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E as \u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\\"\u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E2006-01-02T15:04:05Z07:00\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\\"\u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E: cannot parse \u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\\"\u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003Ea-03-02T00:00:00Z\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\\"\u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E as \u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\\"\u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E-\u003C\u002Fspan\u003E\u003Cspan class=\"se\"\u003E\\\"\u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n    \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"HTTPStatusCode\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E400\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n    \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"Kind\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"input_validation_error\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n    \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"Parameter\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"release_date\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n    \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"Code\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"invalid_date_format\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n    \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"time\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"mi\"\u003E1609650267\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n    \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"severity\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"ERROR\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n    \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"message\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"Response Error Sent\"\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cblockquote\u003E\n\u003Cp\u003ENote: \u003Ccode\u003EE\u003C\u002Fcode\u003E will usually be at the top of the stack as it is where the \u003Ccode\u003Eerrors.New\u003C\u002Fcode\u003E or \u003Ccode\u003Eerrors.WithStack\u003C\u002Fcode\u003E functions are being called.\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\n\u003Ch4\u003E\n  \u003Ca name=\"internal-or-database-error-response\" href=\"#internal-or-database-error-response\"\u003E\n  \u003C\u002Fa\u003E\n  Internal or Database Error Response\n\u003C\u002Fh4\u003E\n\n\u003Cp\u003EThere is logic within \u003Ccode\u003Eerrs.HTTPErrorResponse\u003C\u002Fcode\u003E to return a different response body if the \u003Ccode\u003Eerrs.Kind\u003C\u002Fcode\u003E is \u003Ccode\u003EInternal\u003C\u002Fcode\u003E or \u003Ccode\u003EDatabase\u003C\u002Fcode\u003E. As per the requirements, we should not leak the error message or any internal stack, etc. when an internal or database error occurs. If an error comes through and is an \u003Ccode\u003Eerrs.Error\u003C\u002Fcode\u003E with either of these error \u003Ccode\u003EKind\u003C\u002Fcode\u003E or is unknown error type in any way, the response will look like the following:\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight json\"\u003E\u003Ccode\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n    \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"error\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n        \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"kind\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"internal_error\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n        \u003C\u002Fspan\u003E\u003Cspan class=\"nl\"\u003E\"message\"\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E:\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E \u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"internal server error - please contact support\"\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n    \u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"w\"\u003E\n\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\n\u003Chr\u003E\n\n\u003Ch3\u003E\n  \u003Ca name=\"unauthenticated-errors\" href=\"#unauthenticated-errors\"\u003E\n  \u003C\u002Fa\u003E\n  Unauthenticated Errors\n\u003C\u002Fh3\u003E\n\n\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight go\"\u003E\u003Ccode\u003E\u003Cspan class=\"k\"\u003Etype\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EUnauthenticatedError\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"c\"\u003E\u002F\u002F WWWAuthenticateRealm is a description of the protected area.\u003C\u002Fspan\u003E\n    \u003Cspan class=\"c\"\u003E\u002F\u002F If no realm is specified, \"DefaultRealm\" will be used as realm\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EWWWAuthenticateRealm\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Estring\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"c\"\u003E\u002F\u002F The underlying error that triggered this one, if any.\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EErr\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eerror\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003EThe \u003Ca href=\"https:\u002F\u002Ftools.ietf.org\u002Fhtml\u002Frfc7235#section-3.1\"\u003Espec\u003C\u002Fa\u003E for \u003Ccode\u003E401 Unauthorized\u003C\u002Fcode\u003E calls for a \u003Ccode\u003EWWW-Authenticate\u003C\u002Fcode\u003E response header along with a \u003Ccode\u003Erealm\u003C\u002Fcode\u003E. The realm should be set when creating an Unauthenticated error. The \u003Ccode\u003Eerrs.NewUnauthenticatedError\u003C\u002Fcode\u003E function initializes an \u003Ccode\u003EUnauthenticatedError\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\n\u003Cblockquote\u003E\n\u003Cp\u003EI generally like to follow the Go idiom for brevity in all things as much as possible, but for \u003Ccode\u003EUnauthenticated\u003C\u002Fcode\u003E vs. \u003Ccode\u003EUnauthorized\u003C\u002Fcode\u003E errors, it's confusing enough as it is already, I don't take any shortcuts.\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight go\"\u003E\u003Ccode\u003E\u003Cspan class=\"k\"\u003Efunc\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003ENewUnauthenticatedError\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003Erealm\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Estring\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eerr\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eerror\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E*\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EUnauthenticatedError\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"k\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"o\"\u003E&amp;\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EUnauthenticatedError\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"n\"\u003EWWWAuthenticateRealm\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Erealm\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EErr\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003Eerr\u003C\u002Fspan\u003E\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Ch4\u003E\n  \u003Ca name=\"unauthenticated-error-flow\" href=\"#unauthenticated-error-flow\"\u003E\n  \u003C\u002Fa\u003E\n  Unauthenticated Error Flow\n\u003C\u002Fh4\u003E\n\n\u003Cp\u003EThe \u003Ccode\u003Eerrs.Unauthenticated\u003C\u002Fcode\u003E error should only be raised at points of authentication as part of a middleware handler. I will get into application flow in detail later, but authentication for \u003Ccode\u003Ego-api-basic\u003C\u002Fcode\u003E happens in middleware handlers prior to calling the app handler for the given route.\u003C\u002Fp\u003E\n\n\u003Cul\u003E\n\u003Cli\u003EThe \u003Ccode\u003EWWW-Authenticate\u003C\u002Fcode\u003E \u003Cem\u003Erealm\u003C\u002Fem\u003E is set to the request context using the \u003Ccode\u003EdefaultRealmHandler\u003C\u002Fcode\u003E middleware in the \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fgilcrest\u002Fgo-api-basic\u002Fblob\u002Fmain\u002Fapp\u002Fmiddleware.go\"\u003Eapp package\u003C\u002Fa\u003E prior to attempting authentication.\u003C\u002Fli\u003E\n\u003Cli\u003ENext, the Oauth2 access token is retrieved from the \u003Ccode\u003EAuthorization\u003C\u002Fcode\u003E http header using the \u003Ccode\u003EaccessTokenHandler\u003C\u002Fcode\u003E middleware. There are several access token validations in this middleware, if any are not successful, the \u003Ccode\u003Eerrs.Unauthenticated\u003C\u002Fcode\u003E error is returned using the realm set to the request context.\u003C\u002Fli\u003E\n\u003Cli\u003EFinally, if the access token is successfully retrieved, it is then converted to a \u003Ccode\u003EUser\u003C\u002Fcode\u003E via the \u003Ccode\u003EGoogleAccessTokenConverter.Convert\u003C\u002Fcode\u003E method in the \u003Ccode\u003Egateway\u002Fauthgateway\u003C\u002Fcode\u003E package. This method sends an outbound request to Google using their API; if any errors are returned, an \u003Ccode\u003Eerrs.Unauthenticated\u003C\u002Fcode\u003E error is returned.\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\n\u003Cblockquote\u003E\n\u003Cp\u003EIn general, I do not like to use \u003Ccode\u003Econtext.Context\u003C\u002Fcode\u003E, however, it is used in \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fgilcrest\u002Fgo-api-basic\"\u003Ego-api-basic\u003C\u002Fa\u003E to pass values between middlewares. The \u003Ccode\u003EWWW-Authenticate\u003C\u002Fcode\u003E \u003Cem\u003Erealm\u003C\u002Fem\u003E, the Oauth2 access token and the calling user after authentication, all of which are \u003Ccode\u003Erequest-scoped\u003C\u002Fcode\u003E values, are all set to the request \u003Ccode\u003Econtext.Context\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\n\u003Ch4\u003E\n  \u003Ca name=\"unauthenticated-error-response\" href=\"#unauthenticated-error-response\"\u003E\n  \u003C\u002Fa\u003E\n  Unauthenticated Error Response\n\u003C\u002Fh4\u003E\n\n\u003Cp\u003EPer requirements, \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fgilcrest\u002Fgo-api-basic\"\u003Ego-api-basic\u003C\u002Fa\u003E does not return a response body when returning an \u003Cstrong\u003EUnauthenticated\u003C\u002Fstrong\u003E error. The error response from \u003Ca href=\"https:\u002F\u002Fcurl.se\u002F\"\u003EcURL\u003C\u002Fa\u003E looks like the following:\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight shell\"\u003E\u003Ccode\u003EHTTP\u002F1.1 401 Unauthorized\nRequest-Id: c30hkvua0brkj8qhk3e0\nWww-Authenticate: Bearer \u003Cspan class=\"nv\"\u003Erealm\u003C\u002Fspan\u003E\u003Cspan class=\"o\"\u003E=\u003C\u002Fspan\u003E\u003Cspan class=\"s2\"\u003E\"go-api-basic\"\u003C\u002Fspan\u003E\nDate: Wed, 09 Jun 2021 19:46:07 GMT\nContent-Length: 0\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\n\u003Chr\u003E\n\n\u003Ch3\u003E\n  \u003Ca name=\"unauthorized-errors\" href=\"#unauthorized-errors\"\u003E\n  \u003C\u002Fa\u003E\n  Unauthorized Errors\n\u003C\u002Fh3\u003E\n\n\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight go\"\u003E\u003Ccode\u003E\u003Cspan class=\"k\"\u003Etype\u003C\u002Fspan\u003E \u003Cspan class=\"n\"\u003EUnauthorizedError\u003C\u002Fspan\u003E \u003Cspan class=\"k\"\u003Estruct\u003C\u002Fspan\u003E \u003Cspan class=\"p\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"c\"\u003E\u002F\u002F The underlying error that triggered this one, if any.\u003C\u002Fspan\u003E\n    \u003Cspan class=\"n\"\u003EErr\u003C\u002Fspan\u003E \u003Cspan class=\"kt\"\u003Eerror\u003C\u002Fspan\u003E\n\u003Cspan class=\"p\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\u003Cp\u003EThe \u003Ccode\u003Eerrs.NewUnauthorizedError\u003C\u002Fcode\u003E function initializes an \u003Ccode\u003EUnauthorizedError\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\n\u003Ch4\u003E\n  \u003Ca name=\"unauthorized-error-flow\" href=\"#unauthorized-error-flow\"\u003E\n  \u003C\u002Fa\u003E\n  Unauthorized Error Flow\n\u003C\u002Fh4\u003E\n\n\u003Cp\u003EThe \u003Ccode\u003Eerrs.Unauthorized\u003C\u002Fcode\u003E error is raised when there is a permission issue for a user when attempting to access a resource. Currently, \u003Ccode\u003Ego-api-basic\u003C\u002Fcode\u003E's placeholder authorization implementation \u003Ccode\u003EAuthorizer.Authorize\u003C\u002Fcode\u003E in the \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fgilcrest\u002Fgo-api-basic\u002Fblob\u002Fmain\u002Fdomain\u002Fauth\u002Fauth.go\"\u003Edomain\u002Fauth\u003C\u002Fa\u003E package performs rudimentary checks that a user has access to a resource. If the user does not have access, the \u003Ccode\u003Eerrs.Unauthorized\u003C\u002Fcode\u003E error is returned.\u003C\u002Fp\u003E\n\n\u003Cp\u003EPer requirements, \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fgilcrest\u002Fgo-api-basic\"\u003Ego-api-basic\u003C\u002Fa\u003E does not return a response body when returning an \u003Cstrong\u003EUnauthorized\u003C\u002Fstrong\u003E error. The error response from \u003Ca href=\"https:\u002F\u002Fcurl.se\u002F\"\u003EcURL\u003C\u002Fa\u003E looks like the following:\u003Cbr\u003E\n\u003C\u002Fp\u003E\n\n\u003Cdiv class=\"highlight js-code-highlight\"\u003E\n\u003Cpre class=\"highlight shell\"\u003E\u003Ccode\u003EHTTP\u002F1.1 403 Forbidden\nRequest-Id: c30hp2ma0brkj8qhk3f0\nDate: Wed, 09 Jun 2021 19:54:50 GMT\nContent-Length: 0\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cdiv class=\"highlight__panel js-actions-panel\"\u003E\n\u003Cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003E\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003E\u003Ctitle\u003EEnter fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n    \u003Csvg xmlns=\"http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003E\u003Ctitle\u003EExit fullscreen mode\u003C\u002Ftitle\u003E\n    \u003Cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003E\u003C\u002Fpath\u003E\n\u003C\u002Fsvg\u003E\n\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\u003C\u002Fdiv\u003E\n\n\n\n\n\u003Chr\u003E\n\n\u003Cp\u003E404 Error Illustration by \u003Ca href=\"https:\u002F\u002Ficons8.com\u002Fillustrations\u002Fauthor\u002F5ec7b0e101d0360016f3d1b3\"\u003EPixeltrue\u003C\u002Fa\u003E from \u003Ca href=\"https:\u002F\u002Ficons8.com\u002Fillustrations\"\u003EOuch!\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\n",body_markdown:"Handling errors is really important in Go. Errors are first class citizens and there are many different approaches for handling them. Initially I started off basing my error handling almost entirely on a [blog post from Rob Pike](https:\u002F\u002Fcommandcenter.blogspot.com\u002F2017\u002F12\u002Ferror-handling-in-upspin.html) and created a carve-out from his code to meet my needs. It served me well for a long time, but found over time I wanted a way to easily get a stacktrace of the error, which led me to Dave Cheney's [https:\u002F\u002Fgithub.com\u002Fpkg\u002Ferrors](https:\u002F\u002Fgithub.com\u002Fpkg\u002Ferrors) package. I now use a combination of the two. The implementation below is sourced from my [go-api-basic](https:\u002F\u002Fgithub.com\u002Fgilcrest\u002Fgo-api-basic) repo, indeed, this post will be folded into its [README](https:\u002F\u002Fgithub.com\u002Fgilcrest\u002Fgo-api-basic#errors) as well.\n\n## Requirements\n\nMy requirements for REST API error handling are the following:\n\n- Requests for users who are *not* properly ***authenticated*** should return a `401 Unauthorized` error with a `WWW-Authenticate` response header and an empty response body.\n- Requests for users who are authenticated, but do not have permission to access the resource, should return a `403 Forbidden` error with an empty response body.\n- All requests which are due to a client error (invalid data, malformed JSON, etc.) should return a `400 Bad Request` and a response body which looks similar to the following:\n\n```json\n{\n    \"error\": {\n        \"kind\": \"input_validation_error\",\n        \"param\": \"director\",\n        \"message\": \"director is required\"\n    }\n}\n```\n\n- All requests which incur errors as a result of an internal server or database error should return a `500 Internal Server Error` and not leak any information about the database or internal systems to the client. These errors should return a response body which looks like the following:\n\n```json\n{\n    \"error\": {\n        \"kind\": \"internal_error\",\n        \"message\": \"internal server error - please contact support\"\n    }\n}\n```\n\nAll errors should return a `Request-Id` response header with a unique request id that can be used for debugging to find the corresponding error in logs.\n\n## Implementation\n\nAll errors should be raised using custom errors from the [domain\u002Ferrs](https:\u002F\u002Fgithub.com\u002Fgilcrest\u002Fgo-api-basic\u002Ftree\u002Fmain\u002Fdomain\u002Ferrs) package. The three custom errors correspond directly to the requirements above.\n\n### Typical Errors\n\nTypically, errors raised throughout [go-api-basic](https:\u002F\u002Fgithub.com\u002Fgilcrest\u002Fgo-api-basic) are the custom `errs.Error`, which looks like:\n\n ```go\ntype Error struct {\n    \u002F\u002F User is the username of the user attempting the operation.\n    User UserName\n    \u002F\u002F Kind is the class of error, such as permission failure,\n    \u002F\u002F or \"Other\" if its class is unknown or irrelevant.\n    Kind Kind\n    \u002F\u002F Param represents the parameter related to the error.\n    Param Parameter\n    \u002F\u002F Code is a human-readable, short representation of the error\n    Code Code\n    \u002F\u002F The underlying error that triggered this one, if any.\n    Err error\n}\n```\n\nThese errors are raised using the `E` function from the [domain\u002Ferrs](https:\u002F\u002Fgithub.com\u002Fgilcrest\u002Fgo-api-basic\u002Ftree\u002Fmain\u002Fdomain\u002Ferrs) package. `errs.E` is taken from Rob Pike's [upspin errors package](https:\u002F\u002Fgithub.com\u002Fupspin\u002Fupspin\u002Ftree\u002Fmaster\u002Ferrors) (but has been changed based on my requirements). The `errs.E` function call is [variadic](https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FVariadic) and can take several different types to form the custom `errs.Error` struct.\n\nHere is a simple example of creating an `error` using `errs.E`:\n\n```go\nerr := errs.E(\"seems we have an error here\")\n```\n\nWhen a string is sent, an error will be created using the `errors.New` function from `github.com\u002Fpkg\u002Ferrors` and added to the `Err` element of the struct, which allows retrieval of the error stacktrace later on. In the above example, `User`, `Kind`, `Param` and `Code` would all remain unset.\n\nYou can set any of these custom `errs.Error` fields that you like, for example:\n\n```go\nfunc (m *Movie) SetReleased(r string) (*Movie, error) {\n    t, err := time.Parse(time.RFC3339, r)\n    if err != nil {\n        return nil, errs.E(errs.Validation,\n            errs.Code(\"invalid_date_format\"),\n            errs.Parameter(\"release_date\"),\n            err)\n    }\n    m.Released = t\n    return m, nil\n}\n```\n\nAbove, we used `errs.Validation` to set the `errs.Kind` as `Validation`. Valid error `Kind` are:\n\n```go\nconst (\n    Other           Kind = iota \u002F\u002F Unclassified error. This value is not printed in the error message.\n    Invalid                     \u002F\u002F Invalid operation for this type of item.\n    IO                          \u002F\u002F External I\u002FO error such as network failure.\n    Exist                       \u002F\u002F Item already exists.\n    NotExist                    \u002F\u002F Item does not exist.\n    Private                     \u002F\u002F Information withheld.\n    Internal                    \u002F\u002F Internal error or inconsistency.\n    BrokenLink                  \u002F\u002F Link target does not exist.\n    Database                    \u002F\u002F Error from database.\n    Validation                  \u002F\u002F Input validation error.\n    Unanticipated               \u002F\u002F Unanticipated error.\n    InvalidRequest              \u002F\u002F Invalid Request\n)\n```\n\n`errs.Code` represents a short code to respond to the client with for error handling based on codes (if you choose to do this) and is any string you want to pass.\n\n`errs.Parameter` represents the parameter that is being validated or has problems, etc.\n\n\u003E Note in the above example, instead of passing a string and creating a new error inside the `errs.E` function, I am directly passing the error returned by the `time.Parse` function to `errs.E`. The error is then added to the `Err` field using `errors.WithStack` from the `github.com\u002Fpkg\u002Ferrors` package. This will enable stacktrace retrieval later as well.\n\nThere are a few helpers in the `errs` package as well, namely the `errs.MissingField` function which can be used when validating missing input on a field. This idea comes from [this Mat Ryer post](https:\u002F\u002Fmedium.com\u002F@matryer\u002Fpatterns-for-decoding-and-validating-input-in-go-data-apis-152291ac7372) and is pretty handy.\n\nHere is an example in practice:\n\n```go\n\u002F\u002F IsValid performs validation of the struct\nfunc (m *Movie) IsValid() error {\n    switch {\n    case m.Title == \"\":\n        return errs.E(errs.Validation, errs.Parameter(\"title\"), errs.MissingField(\"title\"))\n```\n\nThe error message for the above would read **title is required**\n\nThere is also `errs.InputUnwanted` which is meant to be used when a field is populated with a value when it is not supposed to be.\n\n### Typical Error Flow\n\nAs errors created with `errs.E` move up the call stack, they can just be returned, like the following:\n\n```go\nfunc inner() error {\n    return errs.E(\"seems we have an error here\")\n}\n\nfunc middle() error {\n    err := inner()\n    if err != nil {\n        return err\n    }\n    return nil\n}\n\nfunc outer() error {\n    err := middle()\n    if err != nil {\n        return err\n    }\n    return nil\n}\n\n```\n\n\u003E In the above example, the error is created in the `inner` function - `middle` and `outer` return the error as is typical in Go.\n\nYou can add additional context fields (`errs.Code`, `errs.Parameter`, `errs.Kind`) as the error moves up the stack, however, I try to add as much context as possible at the point of error origin and only do this in rare cases.\n\n### Handler Flow\n\nAt the top of the program flow for each service is the app service handler (for example, [Server.handleMovieCreate](https:\u002F\u002Fgithub.com\u002Fgilcrest\u002Fgo-api-basic\u002Fblob\u002Fmain\u002Fapp\u002Fhandlers.go)). In this handler, any error returned from any function or method is sent through the `errs.HTTPErrorResponse` function along with the `http.ResponseWriter` and a `zerolog.Logger`.\n\nFor example:\n\n```go\nresponse, err := s.CreateMovieService.Create(r.Context(), rb, u)\nif err != nil {\n    errs.HTTPErrorResponse(w, logger, err)\n    return\n}\n```\n\n`errs.HTTPErrorResponse` takes the custom error (`errs.Error`, `errs.Unauthenticated` or `errs.UnauthorizedError`), writes the response to the given `http.ResponseWriter` and logs the error using the given `zerolog.Logger`.\n\n\u003E `return` must be called immediately after `errs.HTTPErrorResponse` to return the error to the client.\n\n#### Typical Error Response\n\nFor the `errs.Error` type, `errs.HTTPErrorResponse` writes the HTTP response body as JSON using the `errs.ErrResponse` struct.\n\n```go\n\u002F\u002F ErrResponse is used as the Response Body\ntype ErrResponse struct {\n    Error ServiceError `json:\"error\"`\n}\n\n\u002F\u002F ServiceError has fields for Service errors. All fields with no data will\n\u002F\u002F be omitted\ntype ServiceError struct {\n    Kind    string `json:\"kind,omitempty\"`\n    Code    string `json:\"code,omitempty\"`\n    Param   string `json:\"param,omitempty\"`\n    Message string `json:\"message,omitempty\"`\n}\n```\n\nWhen the error is returned to the client, the response body JSON looks like the following:\n\n```json\n{\n    \"error\": {\n        \"kind\": \"input_validation_error\",\n        \"code\": \"invalid_date_format\",\n        \"param\": \"release_date\",\n        \"message\": \"parsing time \\\"1984a-03-02T00:00:00Z\\\" as \\\"2006-01-02T15:04:05Z07:00\\\": cannot parse \\\"a-03-02T00:00:00Z\\\" as \\\"-\\\"\"\n    }\n}\n```\n\nIn addition, the error is logged. If `zerolog.ErrorStackMarshaler` is set to log error stacks (more about this in a later post), the logger will log the full error stack, which can be super helpful when trying to identify issues.\n\nThe error log will look like the following (*I cut off parts of the stack for brevity*):\n\n```json\n{\n    \"level\": \"error\",\n    \"ip\": \"127.0.0.1\",\n    \"user_agent\": \"PostmanRuntime\u002F7.26.8\",\n    \"request_id\": \"bvol0mtnf4q269hl3ra0\",\n    \"stack\": [{\n        \"func\": \"E\",\n        \"line\": \"172\",\n        \"source\": \"errs.go\"\n    }, {\n        \"func\": \"(*Movie).SetReleased\",\n        \"line\": \"76\",\n        \"source\": \"movie.go\"\n    }, {\n        \"func\": \"(*MovieController).CreateMovie\",\n        \"line\": \"139\",\n        \"source\": \"create.go\"\n    }, {\n    ...\n    }],\n    \"error\": \"parsing time \\\"1984a-03-02T00:00:00Z\\\" as \\\"2006-01-02T15:04:05Z07:00\\\": cannot parse \\\"a-03-02T00:00:00Z\\\" as \\\"-\\\"\",\n    \"HTTPStatusCode\": 400,\n    \"Kind\": \"input_validation_error\",\n    \"Parameter\": \"release_date\",\n    \"Code\": \"invalid_date_format\",\n    \"time\": 1609650267,\n    \"severity\": \"ERROR\",\n    \"message\": \"Response Error Sent\"\n}\n```\n\n\u003E Note: `E` will usually be at the top of the stack as it is where the `errors.New` or `errors.WithStack` functions are being called.\n\n#### Internal or Database Error Response\n\nThere is logic within `errs.HTTPErrorResponse` to return a different response body if the `errs.Kind` is `Internal` or `Database`. As per the requirements, we should not leak the error message or any internal stack, etc. when an internal or database error occurs. If an error comes through and is an `errs.Error` with either of these error `Kind` or is unknown error type in any way, the response will look like the following:\n\n```json\n{\n    \"error\": {\n        \"kind\": \"internal_error\",\n        \"message\": \"internal server error - please contact support\"\n    }\n}\n```\n\n---\n\n### Unauthenticated Errors\n\n```go\ntype UnauthenticatedError struct {\n    \u002F\u002F WWWAuthenticateRealm is a description of the protected area.\n    \u002F\u002F If no realm is specified, \"DefaultRealm\" will be used as realm\n    WWWAuthenticateRealm string\n\n    \u002F\u002F The underlying error that triggered this one, if any.\n    Err error\n}\n```\n\nThe [spec](https:\u002F\u002Ftools.ietf.org\u002Fhtml\u002Frfc7235#section-3.1) for `401 Unauthorized` calls for a `WWW-Authenticate` response header along with a `realm`. The realm should be set when creating an Unauthenticated error. The `errs.NewUnauthenticatedError` function initializes an `UnauthenticatedError`.\n\n\u003E I generally like to follow the Go idiom for brevity in all things as much as possible, but for `Unauthenticated` vs. `Unauthorized` errors, it's confusing enough as it is already, I don't take any shortcuts.\n\n```go\nfunc NewUnauthenticatedError(realm string, err error) *UnauthenticatedError {\n    return &UnauthenticatedError{WWWAuthenticateRealm: realm, Err: err}\n}\n```\n\n#### Unauthenticated Error Flow\n\nThe `errs.Unauthenticated` error should only be raised at points of authentication as part of a middleware handler. I will get into application flow in detail later, but authentication for `go-api-basic` happens in middleware handlers prior to calling the app handler for the given route.\n\n- The `WWW-Authenticate` *realm* is set to the request context using the `defaultRealmHandler` middleware in the [app package](https:\u002F\u002Fgithub.com\u002Fgilcrest\u002Fgo-api-basic\u002Fblob\u002Fmain\u002Fapp\u002Fmiddleware.go) prior to attempting authentication.\n- Next, the Oauth2 access token is retrieved from the `Authorization` http header using the `accessTokenHandler` middleware. There are several access token validations in this middleware, if any are not successful, the `errs.Unauthenticated` error is returned using the realm set to the request context.\n- Finally, if the access token is successfully retrieved, it is then converted to a `User` via the `GoogleAccessTokenConverter.Convert` method in the `gateway\u002Fauthgateway` package. This method sends an outbound request to Google using their API; if any errors are returned, an `errs.Unauthenticated` error is returned.\n\n\u003E In general, I do not like to use `context.Context`, however, it is used in [go-api-basic](https:\u002F\u002Fgithub.com\u002Fgilcrest\u002Fgo-api-basic) to pass values between middlewares. The `WWW-Authenticate` *realm*, the Oauth2 access token and the calling user after authentication, all of which are `request-scoped` values, are all set to the request `context.Context`.\n\n#### Unauthenticated Error Response\n\nPer requirements, [go-api-basic](https:\u002F\u002Fgithub.com\u002Fgilcrest\u002Fgo-api-basic) does not return a response body when returning an **Unauthenticated** error. The error response from [cURL](https:\u002F\u002Fcurl.se\u002F) looks like the following:\n\n```bash\nHTTP\u002F1.1 401 Unauthorized\nRequest-Id: c30hkvua0brkj8qhk3e0\nWww-Authenticate: Bearer realm=\"go-api-basic\"\nDate: Wed, 09 Jun 2021 19:46:07 GMT\nContent-Length: 0\n```\n\n---\n\n### Unauthorized Errors\n\n```go\ntype UnauthorizedError struct {\n    \u002F\u002F The underlying error that triggered this one, if any.\n    Err error\n}\n```\n\nThe `errs.NewUnauthorizedError` function initializes an `UnauthorizedError`.\n\n#### Unauthorized Error Flow\n\nThe `errs.Unauthorized` error is raised when there is a permission issue for a user when attempting to access a resource. Currently, `go-api-basic`'s placeholder authorization implementation `Authorizer.Authorize` in the [domain\u002Fauth](https:\u002F\u002Fgithub.com\u002Fgilcrest\u002Fgo-api-basic\u002Fblob\u002Fmain\u002Fdomain\u002Fauth\u002Fauth.go) package performs rudimentary checks that a user has access to a resource. If the user does not have access, the `errs.Unauthorized` error is returned.\n\nPer requirements, [go-api-basic](https:\u002F\u002Fgithub.com\u002Fgilcrest\u002Fgo-api-basic) does not return a response body when returning an **Unauthorized** error. The error response from [cURL](https:\u002F\u002Fcurl.se\u002F) looks like the following:\n\n```bash\nHTTP\u002F1.1 403 Forbidden\nRequest-Id: c30hp2ma0brkj8qhk3f0\nDate: Wed, 09 Jun 2021 19:54:50 GMT\nContent-Length: 0\n```\n\n---\n404 Error Illustration by [Pixeltrue](https:\u002F\u002Ficons8.com\u002Fillustrations\u002Fauthor\u002F5ec7b0e101d0360016f3d1b3) from [Ouch!](https:\u002F\u002Ficons8.com\u002Fillustrations)\n",user:{name:"Dan Gillis",username:d,twitter_username:"Gilcrestian",github_username:d,website_url:a,profile_image:"https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--2bpLsbF1--\u002Fc_fill,f_auto,fl_progressive,h_640,q_auto,w_640\u002Fhttps:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fuploads\u002Fuser\u002Fprofile_image\u002F473071\u002F85d2dbc3-c0e2-4b2f-ad2b-784c025c77ce.jpeg",profile_image_90:"https:\u002F\u002Fres.cloudinary.com\u002Fpracticaldev\u002Fimage\u002Ffetch\u002Fs--D_S-pzFI--\u002Fc_fill,f_auto,fl_progressive,h_90,q_auto,w_90\u002Fhttps:\u002F\u002Fdev-to-uploads.s3.amazonaws.com\u002Fuploads\u002Fuser\u002Fprofile_image\u002F473071\u002F85d2dbc3-c0e2-4b2f-ad2b-784c025c77ce.jpeg"}}},serverRendered:true,routePath:"\u002Farticles\u002Fgilcrest\u002F734721",config:{_app:{basePath:"\u002F",assetsPath:"\u002F_nuxt\u002F",cdnURL:a}}}}(null,"2021-06-21T14:48:56Z",14,"gilcrest"));